{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/GameCtrl.ts"],"names":["Component","find","Node","Vec3","_decorator","cocosUtil","msgac","eventManager","ccclass","property","GameCtrl","joystickNode","blockNode","radius","orignPosition","onLoad","node","getPosition","clone","start","on","EventType","TOUCH_START","touchStart","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","touchCancel","event","location","getUILocation","pos","x","y","convertToNodeSpace","setPosition","sendTouchEvent","dis","length","normalize","multiplyScalar","type","data","send","joystick"],"mappings":"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","sourcesContent":["import { Component, EventTouch, find, Node, Vec3, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { msgac } from '../../data/msgac';\r\nimport { eventManager } from '../../manager/eventManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface JoystickData {\r\n    type: string,\r\n    event: EventTouch,\r\n    pos: Vec3\r\n}\r\n\r\n@ccclass('GameCtrl')\r\nexport class GameCtrl extends Component {\r\n\r\n    // 摇杆节点\r\n    joystickNode: Node;\r\n\r\n    // 摇杆中间的小圆圈节点\r\n    blockNode: Node;\r\n    // 可移动的半径范围\r\n    radius: number = 70;\r\n\r\n    orignPosition: Vec3;\r\n\r\n    onLoad() {\r\n\r\n        this.joystickNode = find(\"joystick\", this.node);\r\n        this.blockNode = find(\"block\", this.joystickNode);\r\n\r\n        this.orignPosition = this.joystickNode.getPosition().clone();\r\n    }\r\n\r\n    start() {\r\n        this.node.on(Node.EventType.TOUCH_START, this.touchStart, this);\r\n        this.node.on(Node.EventType.TOUCH_MOVE, this.touchMove, this);\r\n        this.node.on(Node.EventType.TOUCH_END, this.touchEnd, this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.touchCancel, this);\r\n    }\r\n\r\n    touchStart(event: EventTouch) {\r\n        let location = event.getUILocation();\r\n        let pos = new Vec3(location.x, location.y, 0);\r\n        pos = cocosUtil.convertToNodeSpace(this.joystickNode, pos);\r\n        this.joystickNode.setPosition(pos);\r\n        this.blockNode.setPosition(0, 0);\r\n        this.sendTouchEvent(\"start\", event);\r\n    }\r\n\r\n    touchMove(event: EventTouch) {\r\n        let location = event.getUILocation();\r\n        let pos = new Vec3(location.x, location.y, 0);\r\n        pos = cocosUtil.convertToNodeSpace(this.blockNode, pos);\r\n        let dis = pos.length();\r\n        if (dis > this.radius) {\r\n            pos.normalize().multiplyScalar(this.radius);\r\n        }\r\n        this.blockNode.setPosition(pos);\r\n        this.sendTouchEvent(\"move\", event, pos);\r\n    }\r\n\r\n    touchEnd(event: EventTouch) {\r\n        this.joystickNode.setPosition(this.orignPosition);\r\n        this.blockNode.setPosition(0, 0);\r\n        this.sendTouchEvent(\"end\", event);\r\n    }\r\n    touchCancel(event: EventTouch) {\r\n        this.joystickNode.setPosition(this.orignPosition);\r\n        this.blockNode.setPosition(0, 0);\r\n        this.sendTouchEvent(\"end\", event);\r\n    }\r\n\r\n    sendTouchEvent(type: string, event: EventTouch, pos?: Vec3) {\r\n        if (pos) {\r\n            pos = pos.normalize().clone();\r\n        }\r\n        let data: JoystickData = {\r\n            type,\r\n            event,\r\n            pos\r\n        };\r\n        eventManager.send(msgac.joystick, data);\r\n    }\r\n\r\n}\r\n\r\n"]}