{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/TopUILayer.ts"],"names":["Label","Node","ProgressBar","tween","v3","Vec3","view","_decorator","CountTimeUtil","constants","msgac","audioManager","designManager","eventManager","UserData","BaseUILayer","ccclass","property","TopUILayer","type","tooltip","onLoad","initLayout","onEnable","on","commonResRefresh","updateData","clearBtn","active","screen1","getVisibleSize","scale","getScreenScale","height","width","node","position","x","z","start","showUseAnimal","num","showNode","getChildByName","getComponent","string","show","set","to","hide","onDisable","off","onDestroy","powerLabel","getInstance","power","config","energyMax","baoshiLabel","baoshi","coinLabel","coin","lvLabel","roleLv","expBar","progress","Math","min","roleExp","getNextLevelExp","tiliLabel","setTime","getCountTime","checkPowerTime","send","saveData","clearData","remove","showRewardItem","event","data","playEffect","openLayer","layers","RewardItemLayer","propId","adenergy","adDiamond","adCoin"],"mappings":"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","sourcesContent":["import { Label, Node, ProgressBar, tween, v3, Vec3, view, _decorator } from 'cc';\r\nimport { CountTimeUtil } from '../../../utils/CountTimeUtil';\r\nimport { constants } from '../../data/constants';\r\nimport { msgac } from '../../data/msgac';\r\nimport { audioManager } from '../../manager/audioManager';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { eventManager } from '../../manager/eventManager';\r\nimport { UserData } from '../../model/UserData';\r\nimport { BaseUILayer } from './BaseUILayer';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('TopUILayer')\r\nexport class TopUILayer extends BaseUILayer {\r\n\r\n    @property({ type: Label, tooltip: \"体力标签\" }) powerLabel: Label = null;\r\n    @property({ type: Label, tooltip: \"宝石标签\" }) baoshiLabel: Label = null;\r\n    @property({ type: Label, tooltip: \"金币标签\" }) coinLabel: Label = null;\r\n    @property({ type: Label, tooltip: \"玩家等级\" }) lvLabel: Label = null;\r\n    @property({ type: Node, tooltip: \"使用展示\" }) showNode: Node = null;\r\n    @property({ type: ProgressBar, tooltip: \"经验进度条\" }) expBar: ProgressBar = null;\r\n\r\n    @property({ type: Label, tooltip: \"体力时间\" }) tiliLabel: Label = null;\r\n    @property({ type: Node }) clearBtn: Node = null;\r\n\r\n\r\n    onLoad() {\r\n        super.onLoad();\r\n        this.initLayout()\r\n    }\r\n\r\n    onEnable() {\r\n        eventManager.on(msgac.commonResRefresh, this.updateData, this);\r\n        this.clearBtn.active = false//playerModel.isInDevelopmentEnvironment()  //cocosUtil.isDesktopBrowser();\r\n    }\r\n\r\n    initLayout() {\r\n        let screen1 = view.getVisibleSize()\r\n        let scale = this.getScreenScale()\r\n        if (screen1.height / screen1.width > 2) {\r\n            this.node.position = new Vec3(this.node.position.x, screen1.height / scale / 2 - 220, this.node.position.z)\r\n        } else {\r\n            this.node.position = new Vec3(this.node.position.x, screen1.height / scale / 2 - 160, this.node.position.z)\r\n        }\r\n    }\r\n\r\n    start() {\r\n        this.updateData()\r\n    }\r\n\r\n    showUseAnimal(type, num) {\r\n        this.showNode.active = true\r\n        this.showNode.getChildByName(\"numLabel\").getComponent(Label).string = \"\" + num\r\n        tween(this.showNode).show().set({ position: v3(-88, -9, 0) }).to(0.5, { position: v3(-88, -39, 0) }).hide().start()\r\n        this.updateData()\r\n    }\r\n\r\n    onDisable() {\r\n        eventManager.off(msgac.commonResRefresh, this.updateData, this);\r\n    }\r\n\r\n    onDestroy() {\r\n\r\n    }\r\n\r\n    updateData() {\r\n        this.powerLabel.string = UserData.getInstance().power + \"/\" + designManager.config.energyMax\r\n        this.baoshiLabel.string = UserData.getInstance().baoshi + \"\"\r\n        this.coinLabel.string = UserData.getInstance().coin + \"\"\r\n        this.lvLabel.string = UserData.getInstance().roleLv + \"\"\r\n        this.expBar.progress = Math.min(1, UserData.getInstance().roleExp / UserData.getInstance().getNextLevelExp())\r\n        if (this.tiliLabel.node.getComponent(CountTimeUtil)) {\r\n            this.tiliLabel.node.getComponent(CountTimeUtil).setTime(UserData.getInstance().getCountTime(), function () {\r\n                UserData.getInstance().checkPowerTime()\r\n                eventManager.send(msgac.commonResRefresh);\r\n            })\r\n        }\r\n\r\n        UserData.getInstance().saveData()\r\n    }\r\n\r\n    clearData() {\r\n        UserData.getInstance().remove()\r\n    }\r\n\r\n    showRewardItem(event, data) {\r\n        audioManager.playEffect(\"btnClick\")\r\n\r\n        if (data == 1) {\r\n            if (UserData.getInstance().power < designManager.config.energyMax) {\r\n                this.openLayer(constants.layers.RewardItemLayer, { propId: 105, num: Math.min(designManager.config.adenergy, designManager.config.energyMax - UserData.getInstance().power) })\r\n            }\r\n        } else if (data == 2) {\r\n            this.openLayer(constants.layers.RewardItemLayer, { propId: 801, num: designManager.config.adDiamond })\r\n        } else if (data == 3) {\r\n            this.openLayer(constants.layers.RewardItemLayer, { propId: 104, num: designManager.config.adCoin })\r\n        }\r\n    }\r\n}\r\n\r\n"]}