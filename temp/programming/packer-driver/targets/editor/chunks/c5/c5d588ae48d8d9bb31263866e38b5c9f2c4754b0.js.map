{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/SkillSelectLayer.ts"],"names":["Color","find","Tween","tween","UIOpacity","v3","_decorator","myLog","sdkManager","tyqAdManager","cocosUtil","utilTools","constants","msgac","designManager","mapModel","playerModel","AnimationCtrl","BaseLayer","ItemLayer","ccclass","property","SkillSelectLayer","skill1ItemLayer","skill2ItemLayer","selectItemLayer","hasSelect","uiNode","btnRefresh","btnGetAll","textHint","allHint","onLoad","getNodeByPath","addComponent","isShowBannerAd","onEnable","addEventArr","mapLeave","showDelayFullVideo","showDelayInterstitialAd","onDisable","removeEventArr","initUI","tweenScaleIn2","setString","expLv","refreshSkillLayer","refreshSelectLayer","refreshInfoLayer","lvCount","layerData","skillAllNum","active","refreshInfoNode","refreshFreeNode","skillFreeRefreshCount","setNumItemLayer","node","design","skillNum","refreshSkill1Item","bind","refreshSkill2Item","itemUI","num","info","skillSystem","skill2Arr","iconNode","row","getRowById","tableName","skill2","id","setSpriteFrame","icon","skillArr","skill","arr","mapSystem","getSelectItemArr","refreshSelectItem","item","setRenderableColor","WHITE","newNode","stopAllByTarget","tweenBreath","name","weapon","getFirstIdByType","type","prop","e","btnDoubleSelect","selectEffect","addComponentOnce","starLayer","bgNode","bg2Node","lv","maxLv","starItemUI","starLv","uiOpacity","getComponent","opacity","starIcon","starIcon2","yinIcon","tweenBlink","starNode","combLayer","skillId","forArr","sInfo","getSkillInfoByType","skillRow","delay","to","scale","union","repeatForever","start","mapLeaveRet","closeLayer","processEvent","ac","data","onClickBtnRefresh","openAd","st","onClickBtnGetAll","children","forEach","push","tempFunc","shift","goNext","doSelectItem","isYin","callback","isDouble","waterfall","result","cb","colors","yin","activeInHierarchy","pos","convertToNodeSpace","convertToWorldSpace","setPosition","playAnimationOnce","call","starNode2","selectEffect2","instantiate","parent","position","removeFromParent","scheduleOnce","weaponSystem","addWeapon","addSkill","addSkill2","propSystem","getProp","layerCb","onClickSelectItem","onClickBtnDoubleSelect"],"mappings":"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","sourcesContent":["import { Color, find, Node, Tween, tween, UIOpacity, v3, _decorator } from 'cc';\r\nimport { myLog } from '../../../common/myLog';\r\nimport { sdkManager } from '../../../sdk/sdkManager';\r\nimport { tyqAdManager } from '../../../tyqSDK/tyqAdManager';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { utilTools } from '../../../utils/utilTools';\r\nimport { constants } from '../../data/constants';\r\nimport { msgac } from '../../data/msgac';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { mapModel } from '../../model/mapModel';\r\nimport { playerModel } from '../../model/playerModel';\r\nimport { AnimationCtrl } from '../base/AnimationCtrl';\r\nimport { BaseLayer } from '../base/BaseLayer';\r\nimport { ItemLayer } from '../base/ItemLayer';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SkillSelectLayer')\r\nexport class SkillSelectLayer extends BaseLayer {\r\n\r\n    skill1ItemLayer: ItemLayer;\r\n    skill2ItemLayer: ItemLayer;\r\n\r\n    selectItemLayer: ItemLayer;\r\n\r\n    hasSelect: boolean;\r\n\r\n    uiNode: Node;\r\n\r\n    btnRefresh: Node;\r\n    btnGetAll: Node;\r\n\r\n    textHint: Node;\r\n    allHint: Node;\r\n\r\n    onLoad() {\r\n        super.onLoad();\r\n\r\n        this.uiNode = this.getNodeByPath(\"ui\");\r\n\r\n        this.skill1ItemLayer = this.getNodeByPath(\"ui/skillLayer1/itemLayer\").addComponent(ItemLayer);\r\n        this.skill2ItemLayer = this.getNodeByPath(\"ui/skillLayer2/itemLayer\").addComponent(ItemLayer);\r\n\r\n        this.selectItemLayer = this.getNodeByPath(\"ui/selectLayer\").addComponent(ItemLayer);\r\n\r\n        this.btnRefresh = this.getNodeByPath(\"ui/btns/btnRefresh\");\r\n        this.btnGetAll = this.getNodeByPath(\"ui/btns/btnGetAll\");\r\n\r\n        this.textHint = this.getNodeByPath(\"ui/textHint\");\r\n        this.allHint = this.getNodeByPath(\"ui/allHint\");\r\n\r\n        this.isShowBannerAd = true;\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n\r\n        this.addEventArr([\r\n            msgac.mapLeave,\r\n        ]);\r\n        tyqAdManager.showDelayFullVideo()\r\n        tyqAdManager.showDelayInterstitialAd()\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n\r\n        this.removeEventArr([\r\n            msgac.mapLeave,\r\n        ]);\r\n    }\r\n\r\n    initUI() {\r\n        cocosUtil.tweenScaleIn2(this.uiNode);\r\n        this.hasSelect = false;\r\n\r\n        this.setString(this.getNodeByPath(\"expProgress/lv\"), mapModel.expLv);\r\n        this.refreshSkillLayer();\r\n        this.refreshSelectLayer();\r\n\r\n        this.refreshInfoLayer();\r\n    }\r\n\r\n    refreshInfoLayer() {\r\n        // 2023-03-13 改成一直显示欧皇附体按钮\r\n        return;\r\n        let lvCount = this.layerData.lvCount;\r\n        if (!lvCount) {\r\n            lvCount = 1;\r\n        }\r\n        if (mapModel.skillAllNum > 0) {\r\n            this.btnRefresh.active = false;\r\n            this.btnGetAll.active = true;\r\n\r\n            this.textHint.active = false;\r\n            this.allHint.active = true;\r\n        } else {\r\n            this.btnRefresh.active = true;\r\n            this.btnGetAll.active = false;\r\n\r\n            this.textHint.active = true;\r\n            this.allHint.active = false;\r\n\r\n            let refreshInfoNode = this.getNodeByPath(\"ui/btns/btnRefresh/info\");\r\n            let refreshFreeNode = this.getNodeByPath(\"ui/btns/btnRefresh/free\");\r\n            if (playerModel.skillFreeRefreshCount > 0) {\r\n                refreshInfoNode.active = true;\r\n                refreshFreeNode.active = false;\r\n            } else {\r\n                refreshInfoNode.active = false;\r\n                refreshFreeNode.active = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    refreshSkillLayer() {\r\n        this.setNumItemLayer(this.skill1ItemLayer.node, constants.design.skillNum, this.refreshSkill1Item.bind(this));\r\n        this.setNumItemLayer(this.skill2ItemLayer.node, constants.design.skillNum, this.refreshSkill2Item.bind(this));\r\n    }\r\n\r\n    refreshSkill2Item(itemUI: Node, num: any) {\r\n        let info = mapModel.skillSystem.skill2Arr[num - 1];\r\n        let iconNode = find(\"icon\", itemUI);\r\n        if (info) {\r\n            iconNode.active = true;\r\n            let row = designManager.getRowById(constants.tableName.skill2, info.id);\r\n            this.setSpriteFrame(iconNode, row.icon);\r\n        } else {\r\n            iconNode.active = false;\r\n        }\r\n    }\r\n\r\n    refreshSkill1Item(itemUI: Node, num: any) {\r\n        let info = mapModel.skillSystem.skillArr[num - 1];\r\n        let iconNode = find(\"icon\", itemUI);\r\n        if (info) {\r\n            iconNode.active = true;\r\n            let row = designManager.getRowById(constants.tableName.skill, info.id);\r\n            this.setSpriteFrame(iconNode, row.icon);\r\n        } else {\r\n            iconNode.active = false;\r\n        }\r\n    }\r\n\r\n    refreshSelectLayer() {\r\n        let arr = mapModel.mapSystem.getSelectItemArr();\r\n        this.selectItemLayer.initUI(this, arr, this.refreshSelectItem.bind(this));\r\n    }\r\n\r\n    refreshSelectItem(itemUI: any, item: any) {\r\n        cocosUtil.setRenderableColor(itemUI, Color.WHITE, true);\r\n        let newNode = find(\"new\", itemUI);\r\n        let info = item.info;\r\n        if (info) {\r\n            newNode.active = false;\r\n        } else {\r\n            newNode.active = true;\r\n            Tween.stopAllByTarget(newNode);\r\n            cocosUtil.tweenBreath(newNode, 0.5, 1.1);\r\n        }\r\n\r\n        let row = null;\r\n        switch (item.name) {\r\n            case constants.tableName.weapon:\r\n            case constants.tableName.skill:\r\n            case constants.tableName.skill2:\r\n                let id = designManager.getFirstIdByType(item.type);\r\n                if (info) {\r\n                    id = info.id + 1;\r\n                }\r\n                row = designManager.getRowById(item.name, id);\r\n                break;\r\n            case constants.tableName.prop:\r\n                row = designManager.getRowById(item.name, item.id);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (!row) {\r\n            myLog.e(\"row is undefined:\", row, item);\r\n        }\r\n        itemUI.row = row;\r\n        this.setString(find(\"name\", itemUI), row.name);\r\n\r\n        this.setSpriteFrame(find(\"icon\", itemUI), row.icon);\r\n        this.setString(find(\"info\", itemUI), row.info);\r\n\r\n        let btnDoubleSelect = find(\"btnDoubleSelect\", itemUI);\r\n        btnDoubleSelect.active = false;\r\n        let selectEffect = find(\"selectEffect\", itemUI);\r\n        selectEffect.active = false;\r\n        cocosUtil.addComponentOnce(selectEffect, AnimationCtrl);\r\n\r\n        let starLayer = find(\"starLayer\", itemUI);\r\n        let bgNode = find(\"bg\", itemUI);\r\n        let bg2Node = find(\"bg2\", itemUI);\r\n        if (row.lv >= constants.design.maxLv) {\r\n            bgNode.active = false;\r\n            bg2Node.active = true;\r\n        } else {\r\n            bgNode.active = true;\r\n            bg2Node.active = false;\r\n        }\r\n        if (item.name == constants.tableName.prop) {\r\n            starLayer.active = false;\r\n        } else {\r\n            starLayer.active = true;\r\n            this.setNumItemLayer(starLayer, constants.design.maxLv, (starItemUI: Node, starLv: number) => {\r\n                let uiOpacity = starItemUI.getComponent(UIOpacity);\r\n                uiOpacity.opacity = 255;\r\n                Tween.stopAllByTarget(uiOpacity);\r\n\r\n                let starIcon = find(\"icon\", starItemUI);\r\n                let starIcon2 = find(\"icon2\", starItemUI);\r\n                let yinIcon = find(\"yin\", starItemUI);\r\n                if (row.lv >= starLv) {\r\n                    yinIcon.active = false;\r\n                    if (row.lv == constants.design.maxLv) {\r\n                        starIcon.active = false;\r\n                        starIcon2.active = true;\r\n                    } else {\r\n                        starIcon.active = true;\r\n                        starIcon2.active = false;\r\n                    }\r\n                    if (row.lv == starLv) {\r\n                        cocosUtil.tweenBlink(starItemUI, 0.3);\r\n                        itemUI.starNode = starItemUI;\r\n                    }\r\n                } else {\r\n                    yinIcon.active = true;\r\n                    starIcon.active = false;\r\n                    starIcon2.active = false;\r\n                }\r\n            });\r\n            if (row.lv <= constants.design.maxLv - 1) {\r\n                btnDoubleSelect.active = true;\r\n            }\r\n        }\r\n\r\n        let combLayer = find(\"comb\", itemUI);\r\n        if (row.skillArr) {\r\n            combLayer.active = true;\r\n            let iconNode = find(\"icon\", combLayer);\r\n            let skillId = 0;\r\n            utilTools.forArr(row.skillArr, (type: number) => {\r\n                let sInfo = mapModel.skillSystem.getSkillInfoByType(type);\r\n                if (sInfo) {\r\n                    skillId = sInfo.id;\r\n                    return true;\r\n                }\r\n            });\r\n            if (skillId == 0) {\r\n                skillId = designManager.getFirstIdByType(row.skillArr[0])\r\n            }\r\n            let skillRow = designManager.getRowById(constants.tableName.skill, skillId);\r\n            this.setSpriteFrame(iconNode, skillRow.icon);\r\n            Tween.stopAllByTarget(iconNode);\r\n            tween(iconNode).delay(1).to(0.3, { scale: v3(1.5, 1.5, 1) }).to(0.15, { scale: v3(1, 1, 1) }).union().repeatForever().start();\r\n        } else {\r\n            combLayer.active = false;\r\n        }\r\n    }\r\n\r\n    mapLeaveRet() {\r\n        this.closeLayer();\r\n    }\r\n\r\n    processEvent(ac: any, data: any) {\r\n        switch (ac) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onClickBtnRefresh() {\r\n        if (this.hasSelect) {\r\n            return;\r\n        }\r\n        if (playerModel.skillFreeRefreshCount > 0) {\r\n            sdkManager.openAd(\"3选1刷新\", (st: number) => {\r\n                if (st == 1) {\r\n                    this.refreshSelectLayer();\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        playerModel.skillFreeRefreshCount++;\r\n        this.refreshSelectLayer();\r\n        this.refreshInfoLayer();\r\n    }\r\n\r\n    onClickBtnGetAll() {\r\n        if (this.hasSelect) {\r\n            return;\r\n        }\r\n        sdkManager.openAd(\"3选1欧皇附体\", (st: number) => {\r\n            if (st == 1) {\r\n                mapModel.skillAllNum--;\r\n                this.hasSelect = true;\r\n                let arr = [];\r\n                this.selectItemLayer.node.children.forEach((node: any) => {\r\n                    arr.push(node);\r\n                });\r\n                let tempFunc = () => {\r\n                    let node = arr.shift();\r\n                    if (!node) {\r\n                        this.goNext();\r\n                        return;\r\n                    }\r\n                    this.doSelectItem(node, false, () => {\r\n                        tempFunc();\r\n                    });\r\n                };\r\n                tempFunc();\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n    doSelectItem(node: any, isYin = true, callback?: Function, isDouble: boolean = false) {\r\n        let starNode: Node = node.starNode;\r\n        let item = node.item;\r\n        let row = node.row;\r\n        utilTools.waterfall([\r\n            (result: any, cb: Function) => {\r\n                if (isYin) {\r\n                    // 弱化其它选项\r\n                    utilTools.forArr(this.selectItemLayer.node.children, (itemUI: Node) => {\r\n                        if (node == itemUI) {\r\n                            return;\r\n                        }\r\n                        cocosUtil.setRenderableColor(itemUI, constants.colors.yin, true);\r\n                    });\r\n                }\r\n                if (starNode && starNode.activeInHierarchy) {\r\n                    // 星星选中特效\r\n                    let selectEffect = find(\"selectEffect\", node);\r\n                    selectEffect.active = true;\r\n                    let pos = cocosUtil.convertToNodeSpace(selectEffect, cocosUtil.convertToWorldSpace(starNode));\r\n                    selectEffect.setPosition(pos);\r\n                    selectEffect.getComponent(AnimationCtrl).playAnimationOnce(\"2\", () => {\r\n                        selectEffect.active = false;\r\n                    });\r\n                    starNode.scale = v3(1, 1, 1);\r\n                    tween(starNode).to(0.1, { scale: v3(1.5, 1.5, 1) }).delay(0.15).to(0.15, { scale: v3(1, 1, 1) }).call(() => {\r\n                        cb();\r\n                    }).start();\r\n                    if (isDouble) {\r\n                        // 连升两星\r\n                        let starNode2 = find(\"starLayer\", node).children[row.lv];\r\n                        if (starNode2) {\r\n                            let selectEffect2 = cocosUtil.instantiate(selectEffect);\r\n                            selectEffect2.parent = selectEffect.parent;\r\n                            pos = cocosUtil.convertToNodeSpace(selectEffect2, cocosUtil.convertToWorldSpace(starNode2));\r\n                            selectEffect2.position = pos;\r\n                            selectEffect2.getComponent(AnimationCtrl).playAnimationOnce(\"2\", () => {\r\n                                selectEffect2.removeFromParent();\r\n                            });\r\n                            starNode2.scale = v3(1, 1, 1);\r\n                            find(\"icon\", starNode2).active = true;\r\n                            tween(starNode2).to(0.1, { scale: v3(1.5, 1.5, 1) }).delay(0.15).to(0.15, { scale: v3(1, 1, 1) }).start();\r\n                        }\r\n                    }\r\n                    return;\r\n                }\r\n                this.scheduleOnce(() => {\r\n                    cb();\r\n                }, 0.2);\r\n            },\r\n            (result: any, cb: Function) => {\r\n                switch (item.name) {\r\n                    case constants.tableName.weapon:\r\n                        mapModel.weaponSystem.addWeapon(item.type);\r\n                        if (isDouble) {\r\n                            mapModel.weaponSystem.addWeapon(item.type);\r\n                        }\r\n                        break;\r\n                    case constants.tableName.skill:\r\n                        mapModel.skillSystem.addSkill(item.type);\r\n                        if (isDouble) {\r\n                            mapModel.skillSystem.addSkill(item.type);\r\n                        }\r\n                        break;\r\n                    case constants.tableName.skill2:\r\n                        mapModel.skillSystem.addSkill2(item.type);\r\n                        if (isDouble) {\r\n                            mapModel.skillSystem.addSkill2(item.type);\r\n                        }\r\n                        break;\r\n                    case constants.tableName.prop:\r\n                        mapModel.propSystem.getProp(item.id);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n                cb();\r\n            },\r\n            (result: any, cb: Function) => {\r\n                if (callback) {\r\n                    callback();\r\n                }\r\n            }\r\n        ]);\r\n    }\r\n\r\n    goNext() {\r\n        this.layerData.lvCount--;\r\n        if (this.layerData.lvCount > 0) {\r\n            this.initUI();\r\n        } else {\r\n            this.closeLayer();\r\n            if (this.layerCb) {\r\n                this.layerCb();\r\n            }\r\n        }\r\n    }\r\n\r\n    onClickSelectItem(node: any) {\r\n        if (this.hasSelect) {\r\n            return;\r\n        }\r\n        this.hasSelect = true;\r\n        this.doSelectItem(node, true, () => {\r\n            this.goNext();\r\n        });\r\n    }\r\n\r\n    onClickBtnDoubleSelect(node: any) {\r\n        if (this.hasSelect) {\r\n            return;\r\n        }\r\n        sdkManager.openAd(\"3选1连升两星\", (st: number) => {\r\n            if (st == 1) {\r\n                this.hasSelect = true;\r\n                let starNode: Node = node.parent.starNode;\r\n                Tween.stopAllByTarget(starNode.getComponent(UIOpacity));\r\n                starNode.getComponent(UIOpacity).opacity = 255;\r\n                find(\"yin\", starNode).active = true;\r\n                find(\"icon\", starNode).active = false;\r\n                this.scheduleOnce(() => {\r\n                    find(\"yin\", starNode).active = false;\r\n                    find(\"icon\", starNode).active = true;\r\n                    this.doSelectItem(node.parent, true, () => {\r\n                        this.goNext();\r\n                    }, true);\r\n                }, 0.3);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n\r\n"]}