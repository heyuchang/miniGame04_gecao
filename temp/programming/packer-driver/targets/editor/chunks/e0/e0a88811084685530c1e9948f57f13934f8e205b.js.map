{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/engine/MotionStreakUtil.ts"],"names":["Point","Texture2D","UIRenderer","Vec2","_decorator","ccclass","property","constructor","point","dir","distance","time","set","setPoint","x","y","setDir","MotionStreakUtil","_points","points","onLoad","texture","onEnable","reset","_flushAssembler","assembler","Assembler","getAssembler","_assembler","renderData","createData","_renderData","material","_updateColor","length","clear","lateUpdate","dt","update","_render","render","commitComp"],"mappings":"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","sourcesContent":["import { Texture2D, UIRenderer, Vec2, _decorator } from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\nclass Point {\r\n    public point = new Vec2();\r\n    public dir = new Vec2();\r\n    public distance = 0;\r\n    public time = 0;\r\n\r\n    constructor(point?: Vec2, dir?: Vec2) {\r\n        if (point) this.point.set(point);\r\n        if (dir) this.dir.set(dir);\r\n    }\r\n\r\n    public setPoint(x, y) {\r\n        this.point.x = x;\r\n        this.point.y = y;\r\n    }\r\n\r\n    public setDir(x, y) {\r\n        this.dir.x = x;\r\n        this.dir.y = y;\r\n    }\r\n}\r\n\r\n@ccclass('MotionStreakUtil')\r\nexport class MotionStreakUtil extends UIRenderer {\r\n    public static Point = Point;\r\n\r\n    /**\r\n     * @en The fade time to fade.\r\n     * @zh 拖尾的渐隐时间，以秒为单位。\r\n     * @example\r\n     * motionStreak.fadeTime = 3;\r\n     */\r\n    @property\r\n    fadeTime = 1;\r\n\r\n    /**\r\n     * @en The minimum segment size.\r\n     * @zh 拖尾之间最小距离。\r\n     * @example\r\n     * motionStreak.minSeg = 3;\r\n     */\r\n    @property\r\n    minSeg = 10;\r\n\r\n    /**\r\n     * @en The stroke's width.\r\n     * @zh 拖尾的宽度。\r\n     * @example\r\n     * motionStreak.stroke = 64;\r\n     */\r\n    @property\r\n    stroke = 10;\r\n\r\n    /**\r\n     * @en The texture of the MotionStreak.\r\n     * @zh 拖尾的贴图。\r\n     * @example\r\n     * motionStreak.texture = newTexture;\r\n     */\r\n    @property(Texture2D)\r\n    texture: Texture2D;\r\n\r\n    /**\r\n     * @en The fast Mode.\r\n     * @zh 是否启用了快速模式。当启用快速模式，新的点会被更快地添加，但精度较低。\r\n     * @example\r\n     * motionStreak.fastMode = true;\r\n     */\r\n    @property\r\n    fastMode: boolean = true;\r\n\r\n    public get points() {\r\n        return this._points;\r\n    }\r\n\r\n\r\n    private _points: Point[] = [];\r\n\r\n    onLoad() {\r\n        if (!this.texture) {\r\n            // 动态加载拖尾纹理\r\n        }\r\n    }\r\n\r\n    public onEnable() {\r\n        super.onEnable();\r\n        this.reset();\r\n    }\r\n\r\n    protected _flushAssembler() {\r\n        const assembler = MotionStreakUtil.Assembler.getAssembler(this);\r\n\r\n        if (this._assembler !== assembler) {\r\n            this._assembler = assembler;\r\n        }\r\n\r\n        if (!this.renderData) {\r\n            if (this._assembler && this._assembler.createData) {\r\n                this._renderData = this._assembler.createData(this);\r\n                this.renderData!.material = this.material;\r\n                this._updateColor();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Remove all living segments of the ribbon.\r\n     * @zh 删除当前所有的拖尾片段。\r\n     * @example\r\n     * // Remove all living segments of the ribbon.\r\n     * myMotionStreak.reset();\r\n     */\r\n    public reset() {\r\n        this._points.length = 0;\r\n        if (this.renderData) this.renderData.clear();\r\n    }\r\n\r\n    public lateUpdate(dt) {\r\n        if (this._assembler) this._assembler.update(this, dt);\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _render(render: any) {\r\n        if (this.texture) {\r\n            render.commitComp(this, this.renderData, this.texture, this._assembler, null);\r\n        }\r\n    }\r\n}\r\n"]}