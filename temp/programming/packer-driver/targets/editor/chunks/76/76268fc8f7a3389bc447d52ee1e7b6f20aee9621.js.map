{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/sdk/sdkManager.ts"],"names":["SdkManager","localText","msgac","audioManager","eventManager","mapModel","playerModel","UserData","H5AdSdk4399","CronCtr","Channel","tyqAdManager","tyqSDK","constructor","instance","_instance","initSDK","getChannel","H5_4399","checkDownUrl","openAd","info","cb","tmpFunc","st","send","showNotice","adAwardHint","noRewardAd","noAd","addDayTaskNum","getInstance","$videoCalCnt","saveDataToCloud","gameOnShow","isInDevelopmentEnvironment","isRecordAd","DEFAULT","mapId","mapSystem","fightPause","showRewardedAd","state","fightResume","getShareUid","query","getEnterUrlQuery","uid","sdkManager"],"mappings":"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","sourcesContent":["\r\nimport { localText } from \"../game/data/localText\";\r\nimport { msgac } from \"../game/data/msgac\";\r\nimport { audioManager } from \"../game/manager/audioManager\";\r\nimport { eventManager } from \"../game/manager/eventManager\";\r\nimport { mapModel } from \"../game/model/mapModel\";\r\nimport { playerModel } from \"../game/model/playerModel\";\r\nimport { UserData } from \"../game/model/UserData\";\r\nimport { H5AdSdk4399 } from \"../tyqSDK/H5AdSdk4399\";\r\nimport CronCtr from \"../tyqSDK/network/CronCtr\";\r\nimport { Channel, tyqAdManager } from \"../tyqSDK/tyqAdManager\";\r\nimport { tyqSDK } from \"../tyqSDK/tyqSDK\";\r\n\r\n\r\nclass SdkManager {\r\n\r\n    private static _instance: SdkManager;\r\n    private constructor() {\r\n\r\n    }\r\n\r\n    public static get instance(): SdkManager {\r\n        if (!this._instance) {\r\n            this._instance = new SdkManager();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    // 注意!!!每次打包前，要检查该变量值是否为对应的渠道，git上的版本默认为：WECHAT_MRTGD\r\n    // public channel: ChannelFlag = ChannelFlag.WECHAT_JJWS;\r\n\r\n    initSDK() {\r\n        if (tyqAdManager.getChannel() == Channel.H5_4399) {\r\n            H5AdSdk4399.instance.checkDownUrl()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 激励视频广告统一播放接口\r\n     * 完整观看广告后，获得奖励，调用：tmpFunc(1)\r\n     * 中途退出或者观看失败，调用：tmpFunc(0)\r\n     * @param cb \r\n     */\r\n    openAd(info: string, cb: Function) {\r\n        let tmpFunc = (st: number) => {\r\n            if (st == 0) {\r\n                eventManager.send(msgac.showNotice, localText.adAwardHint);\r\n            } else if (st == -1) {\r\n                eventManager.send(msgac.showNotice, localText.noRewardAd);\r\n            } else if (st == 2) {\r\n                eventManager.send(msgac.showNotice, localText.noAd);\r\n            }\r\n            cb(st);\r\n            if (st == 1) {\r\n                playerModel.addDayTaskNum(11);\r\n                // 好友观看视频广告累计数量\r\n                UserData.getInstance().$videoCalCnt++;\r\n                CronCtr.getInstance().saveDataToCloud(\"videoCalCnt\", UserData.getInstance().$videoCalCnt);\r\n            }\r\n            audioManager.gameOnShow(true);\r\n        };\r\n\r\n        // // test\r\n        // tmpFunc(1);\r\n        // return;\r\n\r\n        if (playerModel.isInDevelopmentEnvironment() || playerModel.isRecordAd) {\r\n            // 开发环境，默认直接成功\r\n            tmpFunc(1);\r\n            return;\r\n        }\r\n\r\n        if (tyqAdManager.getChannel() == Channel.DEFAULT) {\r\n            // 电脑测试直接返回观看成功\r\n            tmpFunc(1);\r\n            return;\r\n        }\r\n\r\n        if (mapModel.mapId > 0) {\r\n            mapModel.mapSystem.fightPause();\r\n        }\r\n\r\n        if (tyqAdManager.getChannel() == Channel.H5_4399) {\r\n            H5AdSdk4399.instance.showRewardedAd((state) => {\r\n                if (mapModel.mapId > 0) {\r\n                    mapModel.mapSystem.fightResume();\r\n                }\r\n                tmpFunc(state);\r\n            })\r\n        } else {\r\n            tyqSDK.showRewardedAd(info, (state) => {\r\n                if (mapModel.mapId > 0) {\r\n                    mapModel.mapSystem.fightResume();\r\n                }\r\n                tmpFunc(state);\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n    getShareUid() {\r\n        let query = tyqAdManager.getEnterUrlQuery();\r\n        if (query && query.uid) {\r\n            return query.uid;\r\n        }\r\n        return \"\";\r\n    }\r\n\r\n}\r\n\r\nexport const sdkManager = SdkManager.instance;\r\n\r\n"]}