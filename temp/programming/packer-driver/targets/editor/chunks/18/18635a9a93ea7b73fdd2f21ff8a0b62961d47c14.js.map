{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/RewardLayer.ts"],"names":["instantiate","macro","Node","Prefab","sp","UITransform","v3","_decorator","cocosUtil","utilTools","audioManager","AnimationCtrl","PropItemPrefab","BaseUILayer","ccclass","property","RewardLayer","type","onLoad","onEnable","showReward","showYanhua","arr","layerData","propArr","self","notMoveAni","scheduleOnce","showGetReward","listLayer","getComponent","width","Math","min","length","index","element","propItem","addChild","setView","Id","Num","Type_UnTouch","setScale","posArr","schedule","skinName","random","scale","pos","getRandomItemByArr","fireNode","yanhua","parent","node","active","position","Skeleton","setSkin","aniCtrl","addComponentOnce","playAnimationOnce","REPEAT_FOREVER","onDisable","onDestroy","start","closeLayer","playEffect"],"mappings":"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","sourcesContent":["import { instantiate, macro, Node, Prefab, sp, UITransform, v3, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { utilTools } from '../../../utils/utilTools';\r\nimport { audioManager } from '../../manager/audioManager';\r\nimport { AnimationCtrl } from '../base/AnimationCtrl';\r\nimport { PropItemPrefab } from '../item/PropItemPrefab';\r\nimport { BaseUILayer } from './BaseUILayer';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RewardLayer')\r\nexport class RewardLayer extends BaseUILayer {\r\n\r\n    @property({ type: Prefab }) propItem: Prefab = null;\r\n    @property({ type: Node }) listLayer: Node = null;\r\n\r\n    @property({ type: Node }) yanhua: Node = null;\r\n    onLoad() {\r\n        super.onLoad()\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable()\r\n        this.showReward()\r\n        this.showYanhua()\r\n    }\r\n\r\n    showReward() {\r\n        let arr = this.layerData.propArr\r\n\r\n        let self = this\r\n        if (!this.layerData.notMoveAni) {\r\n            this.scheduleOnce(function () {\r\n                self.showGetReward(arr)\r\n            }, 0.5)\r\n        }\r\n\r\n        this.listLayer.getComponent(UITransform).width = Math.min(135 * arr.length, 675)\r\n        for (let index = 0; index < arr.length; index++) {\r\n            let element = arr[index];\r\n            //  UserData.getInstance().getRewardProp([propdata])\r\n            let propItem = instantiate(this.propItem)\r\n            this.listLayer.addChild(propItem)\r\n            propItem.getComponent(PropItemPrefab).setView(element.Id, element.Num, PropItemPrefab.Type_UnTouch)\r\n            propItem.getComponent(PropItemPrefab).setScale(120)\r\n        }\r\n    }\r\n\r\n    showYanhua() {\r\n        // 放烟花\r\n        let posArr = [\r\n            v3(-100, 200, 0),\r\n            v3(0, -100, 0),\r\n            v3(150, -250, 0),\r\n            v3(300, -500, 0),\r\n            v3(100, -450, 0),\r\n        ];\r\n\r\n        cocosUtil.schedule(this, () => {\r\n            if (posArr.length <= 0) {\r\n                return;\r\n            }\r\n            let skinName = Math.random() > 0.5 ? \"huang\" : \"lan\";\r\n            let scale = 0.8 + Math.random() * 0.2;\r\n            let pos = utilTools.getRandomItemByArr(posArr, true);\r\n            let fireNode = cocosUtil.instantiate(this.yanhua);\r\n            fireNode.parent = this.node;\r\n            fireNode.active = true;\r\n            fireNode.position = pos;\r\n            fireNode.scale = v3(scale, scale, 1);\r\n            fireNode.getComponent(sp.Skeleton).setSkin(skinName);\r\n            let aniCtrl: AnimationCtrl = cocosUtil.addComponentOnce(fireNode, AnimationCtrl);\r\n            aniCtrl.playAnimationOnce(\"animation\", () => {\r\n                fireNode.parent = null;\r\n            });\r\n        }, 1.5, macro.REPEAT_FOREVER, 0, true);\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    closeLayer() {\r\n        audioManager.playEffect(\"btnClick\")\r\n        super.closeLayer()\r\n    }\r\n\r\n}\r\n\r\n"]}