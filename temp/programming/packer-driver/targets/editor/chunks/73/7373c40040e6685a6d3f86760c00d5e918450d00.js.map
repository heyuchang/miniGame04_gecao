{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/tyqSDK/H5AdSdk4399.ts"],"names":["H5AdSdk4399","assetManager","constructor","instance","_instance","showRewardedAd","successCb","window","h5api","console","log","videocallback","obj","code","message","playAd","checkDownUrl","is4399","checkbin","selfPip","task","done","input","output","i","length","item","url","arr","split","index","element","transformPipeline","append","dw","downloader","_downloaders","dbbin","register","options","onComplete","includes"],"mappings":";;;gFAGaA,W;;;;;;;;;AAHJC,MAAAA,Y,OAAAA,Y;;;;;;;;;6BAGID,W,GAAN,MAAMA,WAAN,CAAkB;AAGbE,QAAAA,WAAW,GAAG,CAAG;;AACC,mBAARC,QAAQ,GAAgB;AACtC,cAAI,CAAC,KAAKC,SAAV,EAAqB;AACjB,iBAAKA,SAAL,GAAiB,IAAIJ,WAAJ,EAAjB;AACH;;AACD,iBAAO,KAAKI,SAAZ;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;;;AACIC,QAAAA,cAAc,CAACC,SAAD,EAAsB;AAChC,cAAIC,MAAM,CAACC,KAAX,EAAkB;AACdC,YAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA;AACZ;AACA;AACA;AACA;;AACY,qBAASC,aAAT,CAAuBC,GAAvB,EAA4B;AACxBH,cAAAA,OAAO,CAACC,GAAR,CAAY,QAAQE,GAAG,CAACC,IAAZ,GAAmB,MAAnB,GAA4BD,GAAG,CAACE,OAA5C;;AACA,kBAAIF,GAAG,CAACC,IAAJ,KAAa,KAAjB,EAAwB;AACpBJ,gBAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACH,eAFD,MAEO,IAAIE,GAAG,CAACC,IAAJ,KAAa,KAAjB,EAAwB;AAC3BJ,gBAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAJ,gBAAAA,SAAS,IAAIA,SAAS,CAAC,CAAD,CAAtB;AACH,eAHM,MAGA;AACHG,gBAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAJ,gBAAAA,SAAS,IAAIA,SAAS,CAAC,CAAD,CAAtB;AACH;AACJ;;AAEDC,YAAAA,MAAM,CAACC,KAAP,CAAaO,MAAb,CAAoBJ,aAApB;AACA;AACH;;AACD;AACH;;AAGMK,QAAAA,YAAY,GAAG;AAClB,cAAIT,MAAM,CAACC,KAAX,EAAkB;AACd,gBAAIS,MAAM,GAAG,IAAb;;AACA,gBAAIC,QAAQ,GAAI,YAAY;AACxB,kBAAI,CAACD,MAAL,EAAa;;AACb,kBAAIE,OAAO,GAAG,UAAUC,IAAV,EAAqBC,IAArB,EAAqC;AAC/C,sBAAMC,KAAK,GAAGF,IAAI,CAACG,MAAL,GAAcH,IAAI,CAACE,KAAjC;;AACA,qBAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAACG,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,sBAAIE,IAAI,GAAGJ,KAAK,CAACE,CAAD,CAAhB;AACA,sBAAI,CAACE,IAAI,CAACC,GAAV,EAAe;AACf,sBAAIC,GAAG,GAAGF,IAAI,CAACC,GAAL,CAASE,KAAT,CAAe,GAAf,CAAV;;AACA,sBAAID,GAAG,CAACH,MAAJ,IAAc,CAAd,IAAmBG,GAAG,CAACA,GAAG,CAACH,MAAJ,GAAa,CAAd,CAAH,IAAuB,OAA9C,EAAuD;AACnDC,oBAAAA,IAAI,CAACC,GAAL,GAAW,EAAX;;AACA,yBAAK,IAAIG,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGF,GAAG,CAACH,MAAJ,GAAa,CAAzC,EAA4CK,KAAK,EAAjD,EAAqD;AACjD,4BAAMC,OAAO,GAAGH,GAAG,CAACE,KAAD,CAAnB;AACAJ,sBAAAA,IAAI,CAACC,GAAL,IAAaI,OAAO,GAAG,GAAvB;AACH;;AACDL,oBAAAA,IAAI,CAACC,GAAL,IAAY,cAAZ;AACH;;AACD,sBAAIC,GAAG,CAACH,MAAJ,IAAc,CAAd,IAAmBG,GAAG,CAACA,GAAG,CAACH,MAAJ,GAAa,CAAd,CAAH,IAAuB,KAA9C,EAAqD;AACjDC,oBAAAA,IAAI,CAACC,GAAL,GAAW,EAAX;;AACA,yBAAK,IAAIG,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGF,GAAG,CAACH,MAAJ,GAAa,CAAzC,EAA4CK,KAAK,EAAjD,EAAqD;AACjD,4BAAMC,OAAO,GAAGH,GAAG,CAACE,KAAD,CAAnB;AACAJ,sBAAAA,IAAI,CAACC,GAAL,IAAaI,OAAO,GAAG,GAAvB;AACH;;AACDL,oBAAAA,IAAI,CAACC,GAAL,IAAY,OAAZ;AACH;AACJ;;AACD,uBAAO,IAAP;AACH,eAxBD,CAFwB,CA2BxB;AACA;;;AACA1B,cAAAA,YAAY,CAAC+B,iBAAb,CAA+BC,MAA/B,CAAsCd,OAAtC,EA7BwB,CA8BxB;;AACA,kBAAIe,EAAE,GAAGjC,YAAY,CAACkC,UAAb,CAAwBC,YAAjC;AACA,kBAAIC,KAAK,GAAGH,EAAE,CAAC,QAAD,CAAd;AACAjC,cAAAA,YAAY,CAACkC,UAAb,CAAwBG,QAAxB,CAAiC,OAAjC,EAA0C,CAACX,GAAD,EAAcY,OAAd,EAA4BC,UAA5B,KAAgD;AACtF,oBAAIb,GAAG,CAACc,QAAJ,CAAa,QAAb,CAAJ,EAA4B;AACxBP,kBAAAA,EAAE,CAAC,QAAD,CAAF;AACH,iBAFD,MAEO;AACHG,kBAAAA,KAAK;AACR;AACJ,eAND;AAOH,aAxCD;;AAyCAnB,YAAAA,QAAQ;AACX;AACJ;;AA3FoB,O;;AAAZlB,MAAAA,W,CAEMI,S","sourcesContent":["import { assetManager } from \"cc\";\r\n\r\n\r\nexport class H5AdSdk4399 {\r\n\r\n    private static _instance: H5AdSdk4399;\r\n    private constructor() { }\r\n    public static get instance(): H5AdSdk4399 {\r\n        if (!this._instance) {\r\n            this._instance = new H5AdSdk4399();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    /**\r\n     * 激励视频广告统一播放接口\r\n     * 完整观看广告后，获得奖励，调用：tmpFunc(1)\r\n     * 中途退出或者观看失败，调用：tmpFunc(0)\r\n     * @param cb \r\n     */\r\n    showRewardedAd(successCb: Function) {\r\n        if (window.h5api) {\r\n            console.log(\"开始播放 h5api\");\r\n            /**\r\n             * 此callback回调函数的形式\r\n             *\r\n             * @param obj  广告状态\r\n             */\r\n            function videocallback(obj) {\r\n                console.log(\"代码:\" + obj.code + \",消息:\" + obj.message);\r\n                if (obj.code === 10000) {\r\n                    console.log(\"开始播放\");\r\n                } else if (obj.code === 10001) {\r\n                    console.log(\"播放结束\");\r\n                    successCb && successCb(1)\r\n                } else {\r\n                    console.log(\"广告异常\");\r\n                    successCb && successCb(0);\r\n                }\r\n            }\r\n\r\n            window.h5api.playAd(videocallback);\r\n            return\r\n        }\r\n        return\r\n    }\r\n\r\n\r\n    public checkDownUrl() {\r\n        if (window.h5api) {\r\n            let is4399 = true;\r\n            let checkbin = (function () {\r\n                if (!is4399) return;\r\n                let selfPip = function (task: any, done: any): any {\r\n                    const input = task.output = task.input;\r\n                    for (let i = 0; i < input.length; i++) {\r\n                        let item = input[i];\r\n                        if (!item.url) continue;\r\n                        let arr = item.url.split(\".\");\r\n                        if (arr.length >= 2 && arr[arr.length - 1] == \"cconb\") {\r\n                            item.url = \"\";\r\n                            for (let index = 0; index < arr.length - 1; index++) {\r\n                                const element = arr[index];\r\n                                item.url += (element + \".\");\r\n                            }\r\n                            item.url += \"_cconb.dbbin\";\r\n                        }\r\n                        if (arr.length >= 2 && arr[arr.length - 1] == \"bin\") {\r\n                            item.url = \"\";\r\n                            for (let index = 0; index < arr.length - 1; index++) {\r\n                                const element = arr[index];\r\n                                item.url += (element + \".\");\r\n                            }\r\n                            item.url += \"dbbin\";\r\n                        }\r\n                    }\r\n                    return null;\r\n                }\r\n                //@ts-ignore\r\n                // if (!CC_BUILD) return;\r\n                assetManager.transformPipeline.append(selfPip);\r\n                //@ts-ignore\r\n                let dw = assetManager.downloader._downloaders;\r\n                let dbbin = dw[\".dbbin\"];\r\n                assetManager.downloader.register(\"dbbin\", (url: string, options: any, onComplete: any) => {\r\n                    if (url.includes(\"_cconb\")) {\r\n                        dw[\".cconb\"]()\r\n                    } else {\r\n                        dbbin();\r\n                    }\r\n                })\r\n            });\r\n            checkbin()\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}