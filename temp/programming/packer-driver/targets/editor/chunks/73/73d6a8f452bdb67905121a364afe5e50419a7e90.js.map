{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/skill/Skill8.ts"],"names":["Component","_decorator","cocosUtil","audioManager","mapModel","physicsGroup","ccclass","property","Skill8","skill","timeCount","init","updateLogic","dt","getAtkCd","arr","monsterSystem","forVisibleMonster","monster","pos","node","position","playerPos","player","Math","abs","x","visibleHalfSize","width","y","height","push","length","i","row","num","scheduleOnce","index","floor","random","hp","convertToWorldSpace","bulletSystem","addBullet","bulletId","PLAYER_BULLET","playEffect","audio"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,U,OAAAA,U;;AACXC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OAGH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U,GAE9B;;wBAEaO,M,WADZF,OAAO,CAAC,QAAD,C,gBAAR,MACaE,MADb,SAC4BR,SAD5B,CACsC;AAAA;AAAA;AAAA,eAElCS,KAFkC;AAAA,eAIlCC,SAJkC,GAId,CAJc;AAAA;;AAMlCC,QAAAA,IAAI,CAACF,KAAD,EAAe;AACf,eAAKA,KAAL,GAAaA,KAAb;AAEH;;AAEDG,QAAAA,WAAW,CAACC,EAAD,EAAa;AACpB,eAAKH,SAAL,IAAkBG,EAAlB;;AAEA,cAAI,KAAKH,SAAL,GAAiB,KAAKD,KAAL,CAAWK,QAAX,EAArB,EAA4C;AACxC;AACH;;AAED,cAAIC,GAAG,GAAG,EAAV;AACA;AAAA;AAAA,oCAASC,aAAT,CAAuBC,iBAAvB,CAA0CC,OAAD,IAAsB;AAC3D,gBAAIC,GAAG,GAAGD,OAAO,CAACE,IAAR,CAAaC,QAAvB;AACA,gBAAIC,SAAS,GAAG;AAAA;AAAA,sCAASC,MAAT,CAAgBH,IAAhB,CAAqBC,QAArC;;AACA,gBAAIG,IAAI,CAACC,GAAL,CAASN,GAAG,CAACO,CAAJ,GAAQJ,SAAS,CAACI,CAA3B,IAAgC;AAAA;AAAA,sCAASC,eAAT,CAAyBC,KAAzB,GAAiC,GAArE,EAA0E;AACtE;AACH;;AACD,gBAAIJ,IAAI,CAACC,GAAL,CAASN,GAAG,CAACU,CAAJ,GAAQP,SAAS,CAACO,CAA3B,IAAgC;AAAA;AAAA,sCAASF,eAAT,CAAyBG,MAAzB,GAAkC,GAAtE,EAA2E;AACvE;AACH;;AACDf,YAAAA,GAAG,CAACgB,IAAJ,CAASb,OAAT;AACH,WAVD;;AAWA,cAAIH,GAAG,CAACiB,MAAJ,IAAc,CAAlB,EAAqB;AACjB;AACH;;AACD,eAAKtB,SAAL,GAAiB,CAAjB;;AAEA,eAAK,IAAIuB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKxB,KAAL,CAAWyB,GAAX,CAAeC,GAAnC,EAAwCF,CAAC,EAAzC,EAA6C;AACzC,iBAAKG,YAAL,CAAkB,MAAM;AACpB,kBAAIrB,GAAG,CAACiB,MAAJ,IAAc,CAAlB,EAAqB;AACjB;AACH;;AACD,kBAAIK,KAAK,GAAGb,IAAI,CAACc,KAAL,CAAWd,IAAI,CAACe,MAAL,KAAgBxB,GAAG,CAACiB,MAA/B,CAAZ;AACA,kBAAId,OAAO,GAAGH,GAAG,CAACsB,KAAD,CAAjB;;AACA,kBAAInB,OAAO,CAACsB,EAAR,IAAc,CAAlB,EAAqB;AACjB;AACH;;AACD,kBAAIrB,GAAG,GAAG;AAAA;AAAA,0CAAUsB,mBAAV,CAA8BvB,OAAO,CAACE,IAAtC,CAAV;AACA;AAAA;AAAA,wCAASsB,YAAT,CAAsBC,SAAtB,CAAgC,KAAKlC,KAAL,CAAWyB,GAAX,CAAeU,QAA/C,EAAyD;AAAA;AAAA,gDAAaC,aAAtE,EAAqF1B,GAArF;AACA;AAAA;AAAA,gDAAa2B,UAAb,CAAwB,KAAKrC,KAAL,CAAWyB,GAAX,CAAea,KAAvC;AACH,aAZD,EAYGd,CAAC,GAAG,GAZP;AAaH;AAEJ;;AAnDiC,O","sourcesContent":["import { Component, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { audioManager } from '../../../manager/audioManager';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { physicsGroup } from '../../../other/physicsGroup';\r\nimport { Monster } from '../monsters/Monster';\r\nimport { Skill } from './Skill';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 闪电\r\n@ccclass('Skill8')\r\nexport class Skill8 extends Component {\r\n\r\n    skill: Skill;\r\n\r\n    timeCount: number = 0;\r\n\r\n    init(skill: Skill) {\r\n        this.skill = skill;\r\n\r\n    }\r\n\r\n    updateLogic(dt: number) {\r\n        this.timeCount += dt;\r\n\r\n        if (this.timeCount < this.skill.getAtkCd()) {\r\n            return;\r\n        }\r\n\r\n        let arr = [];\r\n        mapModel.monsterSystem.forVisibleMonster((monster: Monster) => {\r\n            let pos = monster.node.position;\r\n            let playerPos = mapModel.player.node.position;\r\n            if (Math.abs(pos.x - playerPos.x) > mapModel.visibleHalfSize.width - 100) {\r\n                return;\r\n            }\r\n            if (Math.abs(pos.y - playerPos.y) > mapModel.visibleHalfSize.height - 150) {\r\n                return;\r\n            }\r\n            arr.push(monster);\r\n        });\r\n        if (arr.length <= 0) {\r\n            return;\r\n        }\r\n        this.timeCount = 0;\r\n\r\n        for (let i = 0; i < this.skill.row.num; i++) {\r\n            this.scheduleOnce(() => {\r\n                if (arr.length <= 0) {\r\n                    return;\r\n                }\r\n                let index = Math.floor(Math.random() * arr.length);\r\n                let monster = arr[index];\r\n                if (monster.hp <= 0) {\r\n                    return;\r\n                }\r\n                let pos = cocosUtil.convertToWorldSpace(monster.node);\r\n                mapModel.bulletSystem.addBullet(this.skill.row.bulletId, physicsGroup.PLAYER_BULLET, pos);\r\n                audioManager.playEffect(this.skill.row.audio);\r\n            }, i * 0.3);\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n"]}