{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/monsters/Monster6.ts"],"names":["BoxCollider2D","Component","macro","v3","_decorator","cocosUtil","utilTools","mapModel","physicsGroup","ccclass","property","Monster6","monster","moveStop","bulletId1","bulletId2","bulletId3","numCount","otherCollider1","outVec3","init","getComponents","enabled","startSkillLogic","getDirection","pos","node","getPosition","playerPos","player","x","subtract","normalize","time","Math","random","scheduleOnce","arr","id","weight","distancePlayer","push","ret","getRowByWeight","useSkill4","hp","animationCtrl","playAnimation","schedule","getInfoPosition","getCircleDirectionArr","i","index","floor","length","targetPos","add","splice","bulletSystem","addBullet","MONSTER_BULLET","unscheduleAllCallbacks","REPEAT_FOREVER","useSkill3","playAnimationOnce","useSkill2","canFace","useSkill1"],"mappings":"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","sourcesContent":["import { BoxCollider2D, Component, macro, v3, Vec3, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { utilTools } from '../../../../utils/utilTools';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { physicsGroup } from '../../../other/physicsGroup';\r\nimport { Monster } from './Monster';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 蝎子\r\n@ccclass('Monster6')\r\nexport class Monster6 extends Component {\r\n\r\n    monster: Monster;\r\n    moveStop: boolean;\r\n\r\n    // 闪电\r\n    bulletId1: number = 1006;\r\n    // 大电球\r\n    bulletId2: number = 1007;\r\n    // 静态扳手\r\n    bulletId3: number = 1009;\r\n\r\n    numCount: number = 0;\r\n\r\n    otherCollider1: BoxCollider2D;\r\n\r\n    outVec3: Vec3 = v3(0, 0, 0);\r\n\r\n    init(monster: Monster) {\r\n        this.monster = monster;\r\n        this.moveStop = false;\r\n\r\n        this.otherCollider1 = monster.getComponents(BoxCollider2D)[1];\r\n        this.otherCollider1.enabled = false;\r\n\r\n        this.startSkillLogic();\r\n    }\r\n\r\n    // 向指定目标方向移动\r\n    getDirection() {\r\n        let pos = this.monster.node.getPosition();\r\n        let playerPos = mapModel.player.node.getPosition();\r\n        if (pos.x < playerPos.x) {\r\n            playerPos.x -= 150;\r\n        } else {\r\n            playerPos.x += 150;\r\n        }\r\n        playerPos.subtract(pos).normalize();\r\n\r\n        return playerPos;\r\n    }\r\n\r\n    startSkillLogic() {\r\n        let time = 1 + Math.random();\r\n        this.scheduleOnce(() => {\r\n            let arr = [\r\n                { id: 3, weight: 10 },\r\n                { id: 4, weight: 20 }\r\n            ];\r\n            if (this.monster.distancePlayer <= 260) {\r\n                arr.push({ id: 1, weight: 20 });\r\n            }\r\n            if (this.monster.distancePlayer <= 460) {\r\n                arr.push({ id: 2, weight: 10 });\r\n            }\r\n            let ret = utilTools.getRowByWeight(arr);\r\n            this[\"useSkill\" + ret.id]();\r\n        }, time);\r\n    }\r\n\r\n    useSkill4() {\r\n        if (this.monster.hp <= 0) {\r\n            return;\r\n        }\r\n        this.moveStop = true;\r\n        this.monster.animationCtrl.playAnimation(\"attack4\", true);\r\n        this.numCount = 0;\r\n\r\n        this.schedule(() => {\r\n            this.numCount++;\r\n            let pos = this.monster.getInfoPosition(3, true);\r\n\r\n            let arr = cocosUtil.getCircleDirectionArr(6, 150);\r\n\r\n            for (let i = 0; i < 1; i++) {\r\n                let index = Math.floor(Math.random() * arr.length);\r\n                let targetPos = mapModel.player.node.getPosition().add(arr[index]);\r\n                arr.splice(index, 1);\r\n                mapModel.bulletSystem.addBullet(this.bulletId3, physicsGroup.MONSTER_BULLET, pos, null, targetPos);\r\n            }\r\n\r\n            if (this.numCount >= 3) {\r\n                this.moveStop = false;\r\n                this.monster.animationCtrl.playAnimation(\"walk\", true);\r\n                this.unscheduleAllCallbacks();\r\n                this.startSkillLogic();\r\n            }\r\n        }, 2, macro.REPEAT_FOREVER, 0);\r\n    }\r\n\r\n\r\n    useSkill3() {\r\n        if (this.monster.hp <= 0) {\r\n            return;\r\n        }\r\n        this.moveStop = true;\r\n        this.monster.animationCtrl.playAnimationOnce(\"attack3\", () => {\r\n            this.moveStop = false;\r\n            this.startSkillLogic();\r\n        });\r\n\r\n        let pos = this.monster.getInfoPosition(2, true);\r\n        mapModel.bulletSystem.addBullet(this.bulletId2, physicsGroup.MONSTER_BULLET, pos, null);\r\n    }\r\n\r\n    // 与玩家的距离<=460才会触发\r\n    useSkill2() {\r\n        if (this.monster.hp <= 0) {\r\n            return;\r\n        }\r\n        this.moveStop = true;\r\n        this.monster.canFace = false;\r\n        this.monster.animationCtrl.playAnimationOnce(\"attack2\", () => {\r\n            this.moveStop = false;\r\n            this.monster.canFace = true;\r\n            this.startSkillLogic();\r\n        });\r\n        this.scheduleOnce(() => {\r\n            let pos = this.monster.getInfoPosition(0, true);\r\n            mapModel.bulletSystem.addBullet(this.bulletId1, physicsGroup.MONSTER_BULLET, pos);\r\n        }, 1);\r\n    }\r\n\r\n    // 与玩家的距离<=260才会触发\r\n    useSkill1() {\r\n        if (this.monster.hp <= 0) {\r\n            return;\r\n        }\r\n        this.moveStop = true;\r\n        this.monster.animationCtrl.playAnimationOnce(\"attack1\", () => {\r\n            this.moveStop = false;\r\n            this.otherCollider1.enabled = false;\r\n            this.startSkillLogic();\r\n        });\r\n        this.scheduleOnce(() => {\r\n            this.otherCollider1.enabled = true;\r\n        }, 0.05);\r\n    }\r\n\r\n}\r\n\r\n"]}