{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/TowerFloorLayer.ts"],"names":["find","_decorator","ChannelFlag","tyqSDK","cocosUtil","constants","designManager","mapModel","UserData","AnimationCtrl","BaseLayer","ccclass","property","TowerFloorLayer","floorLayer","floor","onLoad","getNodeByPath","getSwitchValue","active","channel","WECHAT_JJWS","onEnable","onDisable","onDestroy","initUI","arr","mapId","layerData","id","getInstance","getTowerMapInfo","tmp","f","push","maxFloor","getTable","tableName","towerFloor","length","setItemLayer","refreshFloorItem","bind","itemUI","setString","aniCtrl","addComponentOnce","nowFloor","playAnimationOnce","playAnimation","processEvent","ac","data","onButtonClick","node","name","onClickBtnRole","openLayer","layers","TowerRoleLayer","onClickFloorItem","item","enterMapWithMapId","eventSendCustomEvent"],"mappings":"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","sourcesContent":["import { find, Node, _decorator } from 'cc';\r\nimport { ChannelFlag, tyqSDK } from '../../../tyqSDK/tyqSDK';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { constants } from '../../data/constants';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { mapModel } from '../../model/mapModel';\r\nimport { UserData } from '../../model/UserData';\r\nimport { AnimationCtrl } from '../base/AnimationCtrl';\r\nimport { BaseLayer } from '../base/BaseLayer';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('TowerFloorLayer')\r\nexport class TowerFloorLayer extends BaseLayer {\r\n\r\n    floorLayer: Node;\r\n    floor: number = 1;\r\n\r\n    onLoad() {\r\n        super.onLoad();\r\n\r\n        this.floorLayer = this.getNodeByPath(\"ui/floorLayer\");\r\n\r\n        if (tyqSDK.getSwitchValue(\"tyq_HeroLayer_open\") != 1) {\r\n            this.getNodeByPath(\"ui/btnRole\").active = false\r\n        }\r\n\r\n        if (tyqSDK.channel != ChannelFlag.WECHAT_JJWS) {\r\n            this.getNodeByPath(\"ui/btnRole\").active = true\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n\r\n    initUI() {\r\n        let arr = [];\r\n        let mapId = this.layerData.id;\r\n        let floor = UserData.getInstance().getTowerMapInfo(mapId).floor;\r\n        this.floor = floor;\r\n        let tmp = 2;\r\n        while (true) {\r\n            let f = floor - tmp;\r\n            tmp--;\r\n            if (tmp < 0) {\r\n                break;\r\n            }\r\n            if (f <= 0) {\r\n                continue;\r\n            }\r\n            arr.push(f);\r\n        }\r\n        let maxFloor = designManager.getTable(constants.tableName.towerFloor).length;\r\n        tmp = floor;\r\n        while (arr.length <= 7) {\r\n            arr.push(tmp);\r\n            tmp++;\r\n            if (tmp > maxFloor) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.setItemLayer(this.floorLayer, arr, this.refreshFloorItem.bind(this));\r\n    }\r\n\r\n    refreshFloorItem(itemUI: any, floor: number) {\r\n        this.setString(find(\"floor\", itemUI), floor);\r\n        let aniCtrl: AnimationCtrl = cocosUtil.addComponentOnce(find(\"spine\", itemUI), AnimationCtrl);\r\n\r\n        let mapId = this.layerData.id;\r\n        let nowFloor = UserData.getInstance().getTowerMapInfo(mapId).floor;\r\n\r\n        if (nowFloor == floor) {\r\n            aniCtrl.playAnimationOnce(\"a2\", () => {\r\n                aniCtrl.playAnimation(\"a3\", true);\r\n            });\r\n        } else if (floor > nowFloor) {\r\n            aniCtrl.playAnimation(\"a1\", true);\r\n        } else {\r\n            aniCtrl.playAnimation(\"a4\", true);\r\n        }\r\n    }\r\n\r\n    processEvent(ac: any, data: any) {\r\n        switch (ac) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onButtonClick(node: Node, name: string) {\r\n        switch (name) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onClickBtnRole() {\r\n        this.openLayer(constants.layers.TowerRoleLayer);\r\n    }\r\n\r\n    onClickFloorItem(node) {\r\n        let floor = node.item;\r\n        let mapId = this.layerData.id;\r\n        if (floor != UserData.getInstance().getTowerMapInfo(mapId).floor) {\r\n            return;\r\n        }\r\n        // this.closeLayer();\r\n        mapModel.enterMapWithMapId(mapId, floor);\r\n        tyqSDK.eventSendCustomEvent(\"参与无尽模式\")\r\n    }\r\n\r\n}\r\n\r\n"]}