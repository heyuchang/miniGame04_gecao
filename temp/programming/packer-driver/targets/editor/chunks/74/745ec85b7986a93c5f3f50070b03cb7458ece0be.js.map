{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/bullet/Bullet1061.ts"],"names":["Component","tween","Vec3","_decorator","cocosUtil","utilTools","mapModel","ccclass","property","bullet1061","bullet","contactNotHide","outScreenNotRecycle","isOutScreenReflex","init","tweenScaleIn","node","by","angle","repeatForever","start","scheduleOnce","tweenScaleOut","recycleSelf","extraObj","time","contactBegin","direction","negative","radian","angleToRadian","getFloatValue","rotateZ","ZERO","setDirection","mirrorReflex","isX","force","x","y","outScreenX","pos","playerPos","Math","abs","visibleHalfSize","width","outScreenY","height","outWallX","mapSystem","wallLayer","active","wallRightVal","wallLeftVal","outWallY","wallTopVal","wallBottomVal","update","dt","player","position","recycleSelfEnd","isValid","invokeClass","subNum"],"mappings":"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","sourcesContent":["import { Component, tween, Vec3, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { utilTools } from '../../../../utils/utilTools';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { Bullet } from './Bullet';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 技能-科技球\r\n@ccclass('bullet1061')\r\nexport class bullet1061 extends Component {\r\n\r\n    bullet: Bullet;\r\n    contactNotHide: boolean = true;\r\n\r\n    // 不可以自动销毁\r\n    outScreenNotRecycle: boolean = true;\r\n\r\n    isOutScreenReflex: boolean;\r\n\r\n\r\n    init(bullet: Bullet) {\r\n        this.bullet = bullet;\r\n        this.isOutScreenReflex = false;\r\n\r\n        cocosUtil.tweenScaleIn(this.node, 0.5);\r\n\r\n        tween(this.node).by(0.6, { angle: 360 }).repeatForever().start();\r\n        this.scheduleOnce(() => {\r\n            cocosUtil.tweenScaleOut(this.node, 0.5, () => {\r\n                this.bullet.recycleSelf();\r\n            });\r\n        }, this.bullet.extraObj.time);\r\n\r\n    }\r\n\r\n    contactBegin() {\r\n        if (this.isOutScreenReflex) {\r\n            return;\r\n        }\r\n        // 打到怪物，反方向随机角度\r\n        let direction = this.bullet.direction.negative();\r\n        let radian = utilTools.angleToRadian(60);\r\n        radian = utilTools.getFloatValue(-radian, radian);\r\n        Vec3.rotateZ(direction, direction, Vec3.ZERO, radian);\r\n        this.bullet.setDirection(direction);\r\n    }\r\n\r\n    mirrorReflex(isX: boolean, force: boolean = false) {\r\n        if (this.isOutScreenReflex && !force) {\r\n            return;\r\n        }\r\n        this.isOutScreenReflex = true;\r\n        // 碰到屏幕边缘，做镜面反射\r\n        if (isX) {\r\n            this.bullet.direction.x *= -1;\r\n            return;\r\n        }\r\n        this.bullet.direction.y *= -1;\r\n    }\r\n\r\n    outScreenX(pos: Vec3, playerPos: Vec3) {\r\n        return Math.abs(playerPos.x - pos.x) >= mapModel.visibleHalfSize.width;\r\n    }\r\n\r\n    outScreenY(pos: Vec3, playerPos: Vec3) {\r\n        return Math.abs(playerPos.y - pos.y) >= mapModel.visibleHalfSize.height;\r\n    }\r\n\r\n    outWallX(pos: Vec3) {\r\n        if (!mapModel.mapSystem.wallLayer.active) {\r\n            return false;\r\n        }\r\n        if (pos.x >= mapModel.mapSystem.wallRightVal || pos.x <= mapModel.mapSystem.wallLeftVal) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    outWallY(pos: Vec3) {\r\n        if (!mapModel.mapSystem.wallLayer.active) {\r\n            return false;\r\n        }\r\n        if (pos.y >= mapModel.mapSystem.wallTopVal || pos.y <= mapModel.mapSystem.wallBottomVal) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    update(dt: number) {\r\n        let playerPos = mapModel.player.node.position;\r\n        let pos = this.node.position;\r\n        if (this.outScreenX(pos, playerPos)) {\r\n            this.mirrorReflex(true);\r\n            return;\r\n        }\r\n        if (this.outWallX(pos)) {\r\n            this.mirrorReflex(true, true);\r\n            return;\r\n        }\r\n        if (this.outScreenY(pos, playerPos)) {\r\n            this.mirrorReflex(false);\r\n            return;\r\n        }\r\n        if (this.outWallY(pos)) {\r\n            this.mirrorReflex(false, true);\r\n            return;\r\n        }\r\n        this.isOutScreenReflex = false;\r\n    }\r\n\r\n    recycleSelfEnd() {\r\n        // 通知上级数量减少了\r\n        if (cocosUtil.isValid(this.bullet.extraObj.invokeClass)) {\r\n            this.bullet.extraObj.invokeClass.subNum();\r\n        }\r\n    }\r\n\r\n}\r\n\r\n"]}