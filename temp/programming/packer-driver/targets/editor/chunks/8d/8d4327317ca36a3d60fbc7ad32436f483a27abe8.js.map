{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/weapon/Weapon7.ts"],"names":["Component","UITransform","_decorator","cocosUtil","constants","audioManager","mapModel","physicsGroup","ccclass","property","Weapon7","weapon","weaponId","stopTimeCount","atkDis","isHitPass","bullet","init","row","lv","design","maxLv","atk","getDisTargetNode","pos","getInfoPosition","extraObj","atkPercentAdd","invokeClass","isValid","node","recycleSelf","playEffect","audio","update","bulletSystem","addBullet","bulletId","PLAYER_BULLET","direction","scheduleOnce","atkEnd","unschedule","timeCount","forceDestroy","angle","convertToNodeSpace","setPosition","targetNode","width","bulletUtil","setBodyWidth","getComponent","height"],"mappings":"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","sourcesContent":["import { Component, UITransform, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { constants } from '../../../data/constants';\r\nimport { audioManager } from '../../../manager/audioManager';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { physicsGroup } from '../../../other/physicsGroup';\r\nimport { Bullet } from '../bullet/Bullet';\r\nimport { Weapon } from './Weapon';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 激光枪\r\n@ccclass('Weapon7')\r\nexport class Weapon7 extends Component {\r\n\r\n    weapon: Weapon;\r\n    weaponId = 10160;\r\n\r\n    stopTimeCount: boolean;\r\n    // 射程\r\n    atkDis: number = 400;\r\n    // 是否穿透\r\n    isHitPass: boolean = false;\r\n\r\n    bullet: Bullet;\r\n\r\n    init(weapon: Weapon) {\r\n        this.weapon = weapon;\r\n        this.stopTimeCount = false;\r\n\r\n        if (this.weapon.row.lv == constants.design.maxLv) {\r\n            this.isHitPass = true;\r\n            this.atkDis = 1000;\r\n        } else {\r\n            this.isHitPass = false;\r\n            this.atkDis = 400;\r\n        }\r\n\r\n    }\r\n\r\n    atk() {\r\n        // 攻击距离判断\r\n        if (this.weapon.getDisTargetNode() > this.atkDis) {\r\n            return;\r\n        }\r\n\r\n        this.stopTimeCount = true;\r\n        let pos = this.weapon.getInfoPosition(0, true);\r\n        this.bullet = null;\r\n\r\n        let extraObj: any = {};\r\n        extraObj.atkPercentAdd = this.weapon.atkPercentAdd;\r\n        extraObj.invokeClass = (bullet: Bullet) => {\r\n            if (!cocosUtil.isValid(this.node)) {\r\n                this.bullet.recycleSelf();\r\n                return;\r\n            }\r\n            audioManager.playEffect(this.weapon.row.audio);\r\n            this.bullet = bullet;\r\n            this.update();\r\n        };\r\n        mapModel.bulletSystem.addBullet(this.weapon.row.bulletId, physicsGroup.PLAYER_BULLET, pos, this.weapon.direction, extraObj);\r\n\r\n        this.scheduleOnce(this.atkEnd, this.weapon.row.lv);\r\n    }\r\n\r\n    atkEnd() {\r\n        this.unschedule(this.atkEnd);\r\n        this.weapon.timeCount = 0;\r\n        this.stopTimeCount = false;\r\n        if (cocosUtil.isValid(this.bullet)) {\r\n            this.bullet.recycleSelf();\r\n            this.bullet = null;\r\n        }\r\n    }\r\n\r\n    forceDestroy() {\r\n        this.atkEnd();\r\n    }\r\n\r\n    update() {\r\n        if (!this.bullet) {\r\n            return;\r\n        }\r\n        // 旋转角度\r\n        this.bullet.node.angle = this.node.angle;\r\n\r\n        // 位置\r\n        let pos = this.weapon.getInfoPosition(0, true);\r\n        pos = cocosUtil.convertToNodeSpace(this.bullet.node, pos);\r\n        this.bullet.node.setPosition(pos);\r\n\r\n        if (!this.weapon.targetNode) {\r\n            return;\r\n        }\r\n\r\n        // 长度\r\n        let width = this.weapon.getDisTargetNode();\r\n        if (this.isHitPass) {\r\n            width = this.atkDis;\r\n        }\r\n        this.bullet.bulletUtil.setBodyWidth(width - this.weapon.targetNode.getComponent(UITransform).height * 0.2);\r\n\r\n        if (width > this.atkDis) {\r\n            this.atkEnd();\r\n            return;\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n"]}