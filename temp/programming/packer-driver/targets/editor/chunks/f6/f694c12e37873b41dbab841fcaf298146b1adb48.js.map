{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/monsters/Monster23.ts"],"names":["BoxCollider2D","Component","_decorator","cocosUtil","utilTools","mapModel","HintNames","ccclass","property","Monster23","monster","moveStop","otherCollider","isFollow","monsterId","init","getComponents","resetCollider","startSkillLogic","enabled","scheduleOnce","arr","id","weight","ret","getRowByWeight","Math","random","useSkill1","hp","canFace","collider","animationCtrl","playAnimationOnce","useSkill2","i","pos","getAroundPos","node","mapSystem","adjustInWall","worldPos","convertToWorldSpaceWithPos","extraObj","hintSystem","addHint","targetPos3","update","dt","position","player","getPosition"],"mappings":"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","sourcesContent":["import { BoxCollider2D, Component, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { utilTools } from '../../../../utils/utilTools';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { HintNames } from '../hint/Hint';\r\nimport { Monster } from './Monster';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 盾兵\r\n@ccclass('Monster23')\r\nexport class Monster23 extends Component {\r\n\r\n    monster: Monster;\r\n    moveStop: boolean;\r\n\r\n    otherCollider: BoxCollider2D;\r\n\r\n    isFollow: boolean;\r\n\r\n    monsterId: number = 14;\r\n\r\n    init(monster: Monster) {\r\n        this.monster = monster;\r\n        this.moveStop = false;\r\n        this.isFollow = false;\r\n\r\n        this.otherCollider = this.getComponents(BoxCollider2D)[1];\r\n        this.resetCollider();\r\n\r\n        this.startSkillLogic();\r\n    }\r\n\r\n    resetCollider() {\r\n        this.otherCollider.enabled = false;\r\n    }\r\n\r\n    startSkillLogic() {\r\n        this.scheduleOnce(() => {\r\n            let arr: any = [\r\n                { id: 1, weight: 10 },\r\n                { id: 2, weight: 10 },\r\n            ];\r\n\r\n            let ret = utilTools.getRowByWeight(arr);\r\n            if (ret) {\r\n                this[\"useSkill\" + ret.id]();\r\n            } else {\r\n                this.startSkillLogic();\r\n            }\r\n        }, 1.5 + Math.random());\r\n    }\r\n\r\n    useSkill1() {\r\n        if (this.monster.hp <= 0) {\r\n            return;\r\n        }\r\n        this.moveStop = true;\r\n        this.monster.canFace = false;\r\n        this.isFollow = true;\r\n        this.monster.collider.enabled = false;\r\n\r\n        this.scheduleOnce(() => {\r\n            this.isFollow = false;\r\n        }, 1);\r\n\r\n        this.scheduleOnce(() => {\r\n            this.otherCollider.enabled = true;\r\n            this.monster.collider.enabled = true;\r\n        }, 1.5);\r\n\r\n        this.monster.animationCtrl.playAnimationOnce(\"attack1\", () => {\r\n            this.monster.canFace = true;\r\n            this.moveStop = false;\r\n            this.resetCollider();\r\n            this.startSkillLogic();\r\n        });\r\n    }\r\n\r\n    useSkill2() {\r\n        if (this.monster.hp <= 0) {\r\n            return;\r\n        }\r\n\r\n        // 召唤小怪\r\n        for (let i = 0; i < 3; i++) {\r\n            this.scheduleOnce(() => {\r\n                let pos = cocosUtil.getAroundPos(this.node, 150 + 50 * Math.random(), 300);\r\n                mapModel.mapSystem.adjustInWall(pos, 160);\r\n                let worldPos = cocosUtil.convertToWorldSpaceWithPos(this.node, pos);\r\n\r\n                let extraObj: any = {};\r\n                extraObj.monsterId = this.monsterId;\r\n                mapModel.hintSystem.addHint(HintNames.targetPos3, worldPos, 0, extraObj);\r\n            }, i * 0.6);\r\n        }\r\n\r\n        this.startSkillLogic();\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this.isFollow) {\r\n            this.node.position = mapModel.player.node.getPosition();\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}