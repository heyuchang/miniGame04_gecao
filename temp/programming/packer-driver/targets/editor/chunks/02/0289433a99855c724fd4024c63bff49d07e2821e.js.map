{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/weapon/Weapon6.ts"],"names":["Component","_decorator","cocosUtil","constants","audioManager","mapModel","physicsGroup","AnimationCtrl","ccclass","property","Weapon6","weapon","weaponId","isFixedPos","aniCtrl","init","unscheduleAllCallbacks","addComponentOnce","playAnimation","atk","getDisTargetNode","playEffect","row","audio","canFace","playAnimationOnce","scheduleOnce","pos","getInfoPosition","extraObj","atkPercentAdd","bulletSystem","addBullet","bulletId","PLAYER_BULLET","lv","design","maxLv","direction","clone","normalize","dis","arr","i","target","add","multiplyScalar","eobj","scale","timeCount"],"mappings":"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","sourcesContent":["import { Component, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { constants } from '../../../data/constants';\r\nimport { audioManager } from '../../../manager/audioManager';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { physicsGroup } from '../../../other/physicsGroup';\r\nimport { AnimationCtrl } from '../../base/AnimationCtrl';\r\nimport { Weapon } from './Weapon';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 锤子\r\n@ccclass('Weapon6')\r\nexport class Weapon6 extends Component {\r\n\r\n    weapon: Weapon;\r\n    weaponId = 10155;\r\n\r\n    // 固定位置，不跟随目标瞄准\r\n    isFixedPos: boolean = true;\r\n\r\n    aniCtrl: AnimationCtrl;\r\n\r\n    init(weapon: Weapon) {\r\n        this.weapon = weapon;\r\n        this.unscheduleAllCallbacks();\r\n\r\n        // @ts-ignore\r\n        this.aniCtrl = cocosUtil.addComponentOnce(this, AnimationCtrl);\r\n        this.aniCtrl.playAnimation(\"1\", true);\r\n    }\r\n\r\n    atk() {\r\n        if (this.weapon.getDisTargetNode() > 200) {\r\n            return;\r\n        }\r\n\r\n        audioManager.playEffect(this.weapon.row.audio);\r\n\r\n        this.weapon.canFace = false;\r\n        this.aniCtrl.playAnimationOnce(\"2\");\r\n        this.scheduleOnce(() => {\r\n            let pos = this.weapon.getInfoPosition(0, true);\r\n            let extraObj: any = {};\r\n            extraObj.atkPercentAdd = this.weapon.atkPercentAdd;\r\n            mapModel.bulletSystem.addBullet(this.weapon.row.bulletId, physicsGroup.PLAYER_BULLET, pos, null, extraObj);\r\n            if (this.weapon.row.lv == constants.design.maxLv) {\r\n                // 往外扩散\r\n                let direction = this.weapon.direction.clone().normalize();\r\n                let dis = 0;\r\n                let arr = [100, 80, 60, 40];\r\n                for (let i = 0; i < 3; i++) {\r\n                    this.scheduleOnce(() => {\r\n                        dis += arr[i] + arr[i + 1];\r\n                        let target = pos.clone().add(direction.clone().multiplyScalar(dis));\r\n                        let eobj: any = {};\r\n                        eobj.scale = 0.8 - i * 0.2;\r\n                        eobj.atkPercentAdd = this.weapon.atkPercentAdd;\r\n                        mapModel.bulletSystem.addBullet(this.weapon.row.bulletId, physicsGroup.PLAYER_BULLET, target, null, eobj);\r\n                    }, i * 0.2 + 0.2);\r\n                }\r\n            }\r\n        }, 0.1);\r\n        this.scheduleOnce(() => {\r\n            this.weapon.canFace = true;\r\n            this.weapon.timeCount = 0;\r\n        }, 0.32);\r\n\r\n    }\r\n\r\n}\r\n\r\n"]}