{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/BaseUILayer.ts"],"names":["Button","Component","Node","Prefab","Sprite","tween","UITransform","v3","view","_decorator","myLog","tyqSDK","cocosUtil","constants","audioManager","designManager","layerManager","ResLoader","resManager","playerModel","ScrollViewUtil","ccclass","property","BaseUILayer","resLoader","layerId","layerData","onLoad","onEnable","isShowBanner","isRecordAd","showBannerAd","getScreenScale","screen1","getVisibleSize","resolute","getDesignResolutionSize","scale","width","height","toast","content","createNotice","onDisable","hideBannerAd","onDestroy","setSpriteFrame2","node","name","showCb","bundleName1","bundles","icon","isValid","sprite","getComponent","enabled","bundleName","path","loadSpriteFrame","err","spriteFrame","addAsset","openLayer","layerName","data","cb","openSingleLayer","baseLayer","prefab","addTopUILayer","loadAsset","layer","e","message","instantiate","com","addComponent","parent","onClickClose","closeLayer","destroy","stringToArr","str","index","indexOf","endIndex","newStr","substring","split","fitScrollView","curview","minHeigth","maxHeigth","windowSize","Math","min","fitNodeWidget","posy","position","x","z","console","log","y","scrollViewSetData","scrollViewNode","arr","refreshItemFunc","notResetPos","scrollViewUtil","setData","itemUI","item","setImageCustomSize","size","newWidth","newHeight","addButtonHander","btnComponent","target","hander","customEventData","transition","Transition","SCALE","eventHander","EventHandler","component","handler","clickEvents","showGetReward","rewardArr","playEffect","forEach","element","propData","getRowById","tableName","prop","Id","type","weaponData","weapon","weaponid","playCoinFlyAnim","Num","count","iconpath","startPos","endPos","r","iconSize","delay","points","getCirclePoints","coinNodeList","map","pos","coin","self","fun","addChild","setPosition","to","union","repeatForever","start","midPos","dis","calcDistance","i","idx","call","randomScope","radians","PI","round","sin","cos","unshift","random","pos1","pos2","xdiff","ydiff","pow"],"mappings":"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","sourcesContent":["import { Button, Component, Node, Prefab, Sprite, SpriteFrame, tween, UITransform, v3, view, _decorator } from 'cc';\r\nimport { myLog } from '../../../common/myLog';\r\nimport { tyqSDK } from '../../../tyqSDK/tyqSDK';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { constants } from '../../data/constants';\r\nimport { audioManager } from '../../manager/audioManager';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { layerManager } from '../../manager/layerManager';\r\nimport { ResLoader, resManager } from '../../manager/resManager';\r\nimport { playerModel } from '../../model/playerModel';\r\nimport { ScrollViewUtil } from '../base/ScrollViewUtil';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BaseUILayer')\r\nexport class BaseUILayer extends Component {\r\n\r\n    // 资源管理类\r\n    private resLoader: ResLoader = new ResLoader();\r\n\r\n    public layerId: number = -1;\r\n    public layerData: any = {};\r\n\r\n    @property\r\n    isShowBanner: Boolean = false;\r\n\r\n    onLoad() {\r\n        // super.onLoad();\r\n        // this.initLayout()\r\n    }\r\n\r\n    onEnable() {\r\n        if (this.isShowBanner && !playerModel.isRecordAd) {\r\n            //  myLog.i(\"展示banner\")\r\n            tyqSDK.showBannerAd()\r\n        }\r\n    }\r\n\r\n\r\n    getScreenScale() {\r\n        let screen1 = view.getVisibleSize()\r\n        let resolute = view.getDesignResolutionSize()\r\n        let scale = 1\r\n        if (screen1.width / screen1.height <= 720 / 1280) {\r\n            scale = screen1.width / resolute.width\r\n        } else {\r\n            scale = screen1.height / resolute.height\r\n        }\r\n        return scale\r\n    }\r\n\r\n    toast(content) {\r\n        layerManager.createNotice(content);\r\n    }\r\n\r\n    onDisable() {\r\n        if (this.isShowBanner) {\r\n            tyqSDK.hideBannerAd()\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n    }\r\n\r\n    setSpriteFrame2(node: Node, name: string, showCb?: Function, bundleName1 = constants.bundles.icon) {\r\n        if (!name) {\r\n            return;\r\n        }\r\n        if (!cocosUtil.isValid(node)) {\r\n            return;\r\n        }\r\n        let sprite = node.getComponent(Sprite);\r\n        if (!cocosUtil.isValid(sprite)) {\r\n            return;\r\n        }\r\n        sprite.enabled = false;\r\n        node[\"loadName\"] = name;\r\n\r\n        let bundleName = bundleName1;\r\n        let path = name\r\n\r\n        resManager.loadSpriteFrame(bundleName, path, (err, spriteFrame: SpriteFrame) => {\r\n            if (err) {\r\n                return;\r\n            }\r\n            if (!cocosUtil.isValid(node)) {\r\n                return;\r\n            }\r\n            if (!cocosUtil.isValid(sprite)) {\r\n                return;\r\n            }\r\n            if (node[\"loadName\"] != name) {\r\n                return;\r\n            }\r\n            this.resLoader.addAsset(spriteFrame);\r\n            sprite.enabled = true;\r\n            sprite.spriteFrame = spriteFrame;\r\n            if (showCb) {\r\n                showCb(sprite.node);\r\n            }\r\n        });\r\n    }\r\n\r\n    openLayer(layerName: string, data?: any, cb?: Function, showCb?: Function) {\r\n        // 默认每个弹窗只允许同时显示一个\r\n        if (typeof (data) == \"function\") {\r\n            cb = data;\r\n            data = null;\r\n        }\r\n        layerManager.openSingleLayer(layerName, data, cb, (baseLayer: BaseUILayer, prefab: Prefab) => {\r\n            if (baseLayer.resLoader && prefab) {\r\n                baseLayer.resLoader.addAsset(prefab);\r\n            }\r\n            if (showCb) {\r\n                showCb();\r\n            }\r\n        });\r\n    }\r\n\r\n    addTopUILayer(layerName) {\r\n        resManager.loadAsset(constants.bundles.layer, layerName, Prefab, null, (err, prefab) => {\r\n            if (err) {\r\n                myLog.e(\"LayerManager.openLayer error:\" + err.message, layerName, err);\r\n                return;\r\n            }\r\n\r\n\r\n            let node = cocosUtil.instantiate(prefab);\r\n            let com = node.getComponent(layerName) || node.addComponent(layerName);\r\n\r\n            // 添加到节点上后，会马上触发onLoad和onEnable回调，而start方法是在首次执行update之前被调用\r\n            node.parent = this.node;\r\n        });\r\n    }\r\n\r\n    onClickClose() {\r\n        this.closeLayer()\r\n    }\r\n\r\n    closeLayer(layerId?: number | string) {\r\n        if (!layerId) {\r\n            layerId = this.layerId;\r\n        }\r\n        if (layerId && layerId != -1) {\r\n            layerManager.closeLayer(layerId);\r\n            return;\r\n        }\r\n        this.node.destroy();\r\n    }\r\n\r\n    stringToArr(str: string) {\r\n        let index = str.indexOf(\"[\")\r\n        let endIndex = str.indexOf(\"]\")\r\n        let newStr = str.substring(index + 1, endIndex)\r\n        return newStr.split(\",\")\r\n    }\r\n\r\n    fitScrollView(curview: Node, minHeigth, maxHeigth) {\r\n        let windowSize = view.getVisibleSize();\r\n        let resolute = view.getDesignResolutionSize()\r\n        let scale = 1\r\n        if (windowSize.width / windowSize.height <= 720 / 1280) {\r\n            scale = windowSize.width / resolute.width\r\n        } else {\r\n            scale = windowSize.height / resolute.height\r\n        }\r\n        curview.getComponent(UITransform).height = Math.min(maxHeigth, minHeigth + (windowSize.height / scale / 2 - 1280 / 2))\r\n    }\r\n\r\n    fitNodeWidget(node: Node, posy) {\r\n        let windowSize = view.getVisibleSize();\r\n        let resolute = view.getDesignResolutionSize()\r\n        let scale = 1\r\n        if (windowSize.width / windowSize.height <= 720 / 1280) {\r\n            scale = windowSize.width / resolute.width\r\n        } else {\r\n            scale = windowSize.height / resolute.height\r\n        }\r\n        node.position = v3(node.position.x, 0 - windowSize.height / scale / 2 + posy, node.position.z)\r\n        console.log(\"fitNodeWidget \" + node.name, node.position.y)\r\n    }\r\n\r\n    scrollViewSetData(scrollViewNode: Node, arr: any, refreshItemFunc?: Function, data?: any, notResetPos?: boolean) {\r\n        let scrollViewUtil = scrollViewNode.getComponent(ScrollViewUtil);\r\n        if (!scrollViewUtil) {\r\n            return;\r\n        }\r\n        scrollViewUtil.setData(arr, (itemUI: Node, item: any, index: number) => {\r\n            if (refreshItemFunc) {\r\n                refreshItemFunc(itemUI, item, index, data);\r\n            }\r\n            //  this.addButtonListener(itemUI);\r\n        });\r\n    }\r\n\r\n    setImageCustomSize(node: Node, size) {\r\n        let width = node.getComponent(UITransform).width\r\n        let height = node.getComponent(UITransform).height\r\n        let scale = Math.min(size / width, size / height)\r\n        let newWidth = width * scale\r\n        let newHeight = height * scale\r\n        node.getComponent(UITransform).width = newWidth\r\n        node.getComponent(UITransform).height = newHeight\r\n        //node.scale = v3(scale, scale, 1)\r\n    }\r\n\r\n    addButtonHander(btnComponent: Node | Button, target: Node, com: string, hander: string, customEventData?: any) {\r\n        if (btnComponent instanceof Button) {\r\n        } else {\r\n            if (btnComponent.getComponent(Button)) {\r\n                btnComponent = btnComponent.getComponent(Button)\r\n            } else {\r\n                btnComponent = btnComponent.addComponent(Button);\r\n            }\r\n        }\r\n        btnComponent.transition = Button.Transition.SCALE;\r\n        let eventHander = new Component.EventHandler();\r\n        eventHander.target = target;\r\n        eventHander.component = com;\r\n        eventHander.handler = hander;\r\n        eventHander.customEventData = customEventData;\r\n        btnComponent.clickEvents = [eventHander];\r\n    }\r\n\r\n    showGetReward(rewardArr) {\r\n        audioManager.playEffect(\"coin\")\r\n\r\n        rewardArr.forEach((element, index) => {\r\n            let propData = designManager.getRowById(constants.tableName.prop, element.Id)\r\n            let icon = \"prop/\" + propData.icon\r\n            if (propData.type == 11) {\r\n                let weaponData = designManager.getRowById(constants.tableName.weapon, propData.weaponid)\r\n                icon = \"weapon/\" + weaponData.icon\r\n            }\r\n            if (propData.type == 1) {\r\n                this.playCoinFlyAnim(8, icon, v3(0, 60, 0), v3(200, 600, 0), 40)\r\n            } else if (propData.type == 10) {\r\n                this.playCoinFlyAnim(8, icon, v3(0, -60, 0), v3(-300, 600, 0), 40)\r\n            } else if (propData.type == 9) {\r\n                this.playCoinFlyAnim(8, icon, v3(0, -60, 0), v3(50, 600, 0), 40)\r\n            } else if (propData.type == 8 || propData.type == 11 || propData.type == 17) {\r\n                this.playCoinFlyAnim(element.Num, icon, v3(0, 0, 0), v3(-150, -600, 0), 20, 100, index * 0.02)\r\n            } else {\r\n                this.playCoinFlyAnim(8, icon, v3(0, 0, 0), v3(-150, -600, 0), 20, 100, index * 0.01)\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**金币落袋具体实现方法 */\r\n    protected playCoinFlyAnim(count: number, iconpath, startPos, endPos, r: number = 50, iconSize = 0, delay = 0) {\r\n        //金币分散成圆\r\n\r\n        let points = this.getCirclePoints(r, startPos, count);\r\n        let coinNodeList = points.map(pos => {\r\n            var coin = new Node(\"Sprite\");\r\n            coin.addComponent(Sprite);\r\n            if (iconSize > 0) {\r\n                let self = this\r\n                let fun = function (sprite) {\r\n                    self.setImageCustomSize(sprite, iconSize)\r\n                }\r\n                this.setSpriteFrame2(coin, iconpath, fun)\r\n            } else {\r\n                this.setSpriteFrame2(coin, iconpath)\r\n            }\r\n            coin.layer = this.node.layer\r\n            // cc.find('Canvas').addChild(coin);\r\n            this.node.addChild(coin);\r\n            coin.setPosition(pos.x, pos.y, 0);\r\n            coin.scale = v3(0, 0, 0)\r\n            tween(coin).to(0.2, { scale: v3(1.2, 1.2, 1.2) }).to(0.2, { scale: v3(1, 1, 1) }).union().repeatForever().start()\r\n            return {\r\n                node: coin,\r\n                startPos: startPos,\r\n                midPos: pos,\r\n                endPos: endPos,\r\n                dis: this.calcDistance(pos, endPos)\r\n            }\r\n        })\r\n\r\n        //执行动作\r\n        let i = 0;\r\n        coinNodeList.forEach((item, idx) => {\r\n            i++;\r\n            tween(item.node)\r\n                .to(0.15, { position: v3(item.midPos.x, item.midPos.y, 0) })//初始位置\r\n                .delay(idx * 0.05 + 0.5 + delay)\r\n                .to(0.35, { position: v3(item.endPos.x, item.endPos.y, 0) })//终点\r\n                .call(() => {\r\n                    item.node.destroy();\r\n                })\r\n                .union()\r\n                .start()\r\n        });\r\n    }\r\n\r\n    protected getCirclePoints(r: number, pos, count: number, randomScope: number = 50) {\r\n        let points = []\r\n        for (let i = 0; i < count; i++) {\r\n            let radians = (Math.PI / 180) * Math.round(360 / count)\r\n            let x = pos.x + r * Math.sin(radians * i)\r\n            let y = pos.y + r * Math.cos(radians * i)\r\n            points.unshift(v3(x + Math.random() * randomScope, y + Math.random() * randomScope, 0))\r\n        }\r\n        return points\r\n    }\r\n\r\n    /**\r\n* 已知两点求距离\r\n* @param {cc.Vec2} pos1\r\n* @param {cc.Vec2} pos2\r\n*/\r\n    public calcDistance(pos1, pos2) {\r\n        let xdiff = pos1.x - pos2.x;\r\n        let ydiff = pos1.y - pos2.y;\r\n        let dis = Math.pow((xdiff * xdiff + ydiff * ydiff), 0.5);\r\n        return dis;\r\n    };\r\n}\r\n\r\n"]}