{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/HeroLayer.ts"],"names":["instantiate","Label","Node","Prefab","sp","_decorator","myLog","tyqSDK","constants","msgac","audioManager","designManager","eventManager","RedPointLogicMgr","RedpointPos","RPointMask","UserData","PropItemPrefab","BaseUILayer","ccclass","property","HeroLayer","type","tooltip","Skeleton","_propNodeList","_isSort","onLoad","fitScrollView","propView","i","propNodeLeft","children","length","push","propNodeRight","onEnable","on","wearDrop","updateProp","updateDropData","onDisable","off","onDestroy","start","initList","initWearDrop","attackLabel","getComponent","string","getInstance","attack","lifeLabel","life","ins","setRPointView","node","getChildByName","checkPropCanBless","mask","RPM_BlessProp","subPath","eventSendCustomEvent","sortbtn","heroSk","setSkin","getHeroSkin","propdata","wearProp","item","rewardItem","addChild","name","setView","Type_HideNum","Type_UnWear","setScale","dataArr","getPropList","equipSort","a","b","equipDataA","getRowById","tableName","prop","equipDataB","quality","sort","scrollViewSetData","scrollView","initItem","wearIndex","itemUI","index","Type_ToWear","checkThisPropBestToWear","right","updateRedPoint","propLayer","forEach","propId","arr","getPropSort","element","num","iswear","row","id","propSort","playEffect","openBless","openLayer","layers","BlessLayer","onClickBtnSkin","SkinChangeLayer"],"mappings":"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","sourcesContent":["import { instantiate, Label, Node, Prefab, sp, _decorator } from 'cc';\r\nimport { myLog } from '../../../common/myLog';\r\nimport { tyqSDK } from '../../../tyqSDK/tyqSDK';\r\nimport { constants } from '../../data/constants';\r\nimport { msgac } from '../../data/msgac';\r\nimport { audioManager } from '../../manager/audioManager';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { eventManager } from '../../manager/eventManager';\r\nimport { RedPointLogicMgr, RedpointPos, RPointMask } from '../../manager/RedPointLogicMgr';\r\nimport { UserData } from '../../model/UserData';\r\nimport { PropItemPrefab } from '../item/PropItemPrefab';\r\nimport { BaseUILayer } from './BaseUILayer';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroLayer')\r\nexport class HeroLayer extends BaseUILayer {\r\n\r\n    @property({ type: Node, tooltip: \"道具列表容器\" }) propLayer: Node = null;\r\n    @property({ type: Prefab, tooltip: \"道具节点\" }) rewardItem: Prefab = null;\r\n    @property({ type: Node, tooltip: \"道具列表View\" }) propView: Node = null;\r\n    @property({ type: Node, tooltip: \"道具列表View\" }) scrollView: Node = null;\r\n\r\n    @property({ type: Node, tooltip: \"穿戴装备\" }) propNodeLeft: Node = null;\r\n    @property({ type: Node, tooltip: \"穿戴装备\" }) propNodeRight: Node = null;\r\n\r\n    @property({ type: Node, tooltip: \"攻击力\" }) attackLabel: Node = null;\r\n    @property({ type: Node, tooltip: \"生命值\" }) lifeLabel: Node = null;\r\n\r\n\r\n    @property({ type: Node, tooltip: \"排序按钮\" }) sortbtn: Node = null;\r\n\r\n\r\n    @property({ type: sp.Skeleton, tooltip: \"角色spine\" }) heroSk: sp.Skeleton = null;\r\n\r\n\r\n    _propNodeList = [];\r\n\r\n    _isSort = false\r\n\r\n    onLoad() {\r\n        this.fitScrollView(this.propView, 320, 600)\r\n\r\n        for (let i = 0; i < this.propNodeLeft.children.length; i++) {\r\n            this._propNodeList.push(this.propNodeLeft.children[i]);\r\n        }\r\n        for (let i = 0; i < this.propNodeRight.children.length; i++) {\r\n            this._propNodeList.push(this.propNodeRight.children[i]);\r\n        }\r\n\r\n        // test\r\n        // UserData.getInstance().addPropByDesign([10155, 1]);\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n        eventManager.on(msgac.wearDrop, this.updateProp, this);\r\n        eventManager.on(msgac.updateDropData, this.updateProp, this);\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n        eventManager.off(msgac.wearDrop, this.updateProp, this);\r\n        eventManager.off(msgac.updateDropData, this.updateProp, this);\r\n\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n\r\n    start() {\r\n        this.initList()\r\n        this.initWearDrop()\r\n\r\n        this.attackLabel.getComponent(Label).string = UserData.getInstance().attack + \"\"\r\n        this.lifeLabel.getComponent(Label).string = UserData.getInstance().life + \"\"\r\n\r\n        RedPointLogicMgr.ins().setRPointView(this.node.getChildByName(\"btnBless\"), null, UserData.getInstance().checkPropCanBless())\r\n        RedPointLogicMgr.ins().on(this.node, [{ mask: [RPointMask.RPM_BlessProp], subPath: \"btnBless\" },])\r\n\r\n        tyqSDK.eventSendCustomEvent(\"进入装备界面\")\r\n\r\n        this.sortbtn.getChildByName(\"Label\").getComponent(Label).string = \"按品质排序\"\r\n\r\n        this.heroSk.setSkin(UserData.getInstance().getHeroSkin())\r\n    }\r\n\r\n    updateProp() {\r\n        this.initList()\r\n        this.initWearDrop()\r\n        this.attackLabel.getComponent(Label).string = UserData.getInstance().attack + \"\"\r\n        this.lifeLabel.getComponent(Label).string = UserData.getInstance().life + \"\"\r\n    }\r\n\r\n    initWearDrop() {\r\n        let propdata = UserData.getInstance().wearProp\r\n        myLog.i(\"propdata = \", propdata)\r\n        for (let i = 0; i < propdata.length && i < this._propNodeList.length; i++) {\r\n            let item = this._propNodeList[i].getChildByName(\"PropItem\")\r\n            if (item == null) {\r\n                item = instantiate(this.rewardItem)\r\n                this._propNodeList[i].addChild(item)\r\n                item.name = \"PropItem\"\r\n            }\r\n            item.getComponent(PropItemPrefab).setView(propdata[i], i + 1, PropItemPrefab.Type_HideNum | PropItemPrefab.Type_UnWear)\r\n            item.getComponent(PropItemPrefab).setScale(130)\r\n        }\r\n    }\r\n\r\n    initList() {\r\n        if (this._isSort) {\r\n            let dataArr = this.getPropList()\r\n            let equipSort = (a: number, b: number) => {\r\n                let equipDataA = designManager.getRowById(constants.tableName.prop, a)\r\n                let equipDataB = designManager.getRowById(constants.tableName.prop, b)\r\n                return equipDataB.quality - equipDataA.quality;\r\n            }\r\n            dataArr.sort(equipSort);\r\n            this.scrollViewSetData(this.scrollView, dataArr, this.initItem)\r\n        } else {\r\n            let dataArr = this.getPropList()\r\n            let equipSort = (a: number, b: number) => {\r\n                let equipDataA = designManager.getRowById(constants.tableName.prop, a)\r\n                let equipDataB = designManager.getRowById(constants.tableName.prop, b)\r\n                return equipDataA.wearIndex - equipDataB.wearIndex;\r\n            }\r\n            dataArr.sort(equipSort);\r\n            this.scrollViewSetData(this.scrollView, dataArr, this.initItem)\r\n        }\r\n\r\n    }\r\n\r\n    initItem(itemUI: Node, item: any, index: number) {\r\n        itemUI.getComponent(PropItemPrefab).setView(item, 1, PropItemPrefab.Type_HideNum | PropItemPrefab.Type_ToWear)\r\n        itemUI.getComponent(PropItemPrefab).setScale(120)\r\n        RedPointLogicMgr.ins().setRPointView(itemUI, null, UserData.getInstance().checkThisPropBestToWear(item), null, RedpointPos.right)\r\n    }\r\n\r\n    updateRedPoint() {\r\n        let children = this.propLayer.children\r\n        children.forEach(itemUI => {\r\n            RedPointLogicMgr.ins().setRPointView(itemUI, null, UserData.getInstance().checkThisPropBestToWear(itemUI.getComponent(PropItemPrefab).propId))\r\n        });\r\n    }\r\n\r\n    getPropList() {\r\n        let arr = UserData.getInstance().getPropSort()\r\n        let dataArr = []\r\n        arr.forEach(element => {\r\n            let num = element.iswear == 1 ? element.num - 1 : element.num\r\n            let row = designManager.getRowById(constants.tableName.prop, element.id);\r\n            if (row.type != 8 && row.type != 11) {\r\n                return;\r\n            }\r\n            for (let i = 0; i < num; i++) {\r\n                dataArr.push(element.id)\r\n            }\r\n        });\r\n        return dataArr\r\n    }\r\n\r\n    propSort() {\r\n        audioManager.playEffect(\"btnClick\")\r\n        if (this._isSort) {\r\n            this.sortbtn.getChildByName(\"Label\").getComponent(Label).string = \"按品质排序\"\r\n            this._isSort = false\r\n        } else {\r\n            this.sortbtn.getChildByName(\"Label\").getComponent(Label).string = \"取消排序\"\r\n            this._isSort = true\r\n        }\r\n\r\n        this.initList()\r\n    }\r\n\r\n    openBless() {\r\n        //  this.closeLayer()\r\n        audioManager.playEffect(\"btnClick\")\r\n        this.openLayer(constants.layers.BlessLayer)\r\n    }\r\n\r\n    onClickBtnSkin() {\r\n        audioManager.playEffect(\"btnClick\")\r\n        this.openLayer(constants.layers.SkinChangeLayer, () => {\r\n            this.heroSk.setSkin(UserData.getInstance().getHeroSkin())\r\n        });\r\n    }\r\n\r\n}\r\n\r\n"]}