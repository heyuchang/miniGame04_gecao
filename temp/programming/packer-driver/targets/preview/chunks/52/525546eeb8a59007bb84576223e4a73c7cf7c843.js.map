{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/PropItemPrefab.ts"],"names":["Node","Label","Sprite","UITransform","v3","_decorator","myLog","constants","audioManager","designManager","BaseUILayer","ccclass","property","PropItemPrefab","type","tooltip","_propId","_propFlag","start","propId","setView","id","num","flag","propdata","getRowById","tableName","prop","self","fun","sprite","setImageCustomSize","node","off","EventType","TOUCH_END","openInfo","Type_UnKnow","numLabel","string","setSpriteFrame2","icon","bundles","greybg","active","typeIcon","weaponData","weapon","weaponid","bg","quality","Type_UnTouch","on","wwqVec","Type_OnlyIcon","Type_BigIcon","scale","Type_HideNum","Type_Grey","Type_ShowType","i","playEffect","openLayer","layers","PropInfoLayer","setScale","width","bgWidth","getComponent","bgHeight","height","changeBg","resPath","bundleName","Type_UnWear","Type_ToWear","Type_Bless"],"mappings":"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","sourcesContent":["import { Node, Label, Sprite, UITransform, v3, _decorator } from \"cc\";\r\nimport { myLog } from \"../../../common/myLog\";\r\nimport { constants } from \"../../data/constants\";\r\nimport { audioManager } from \"../../manager/audioManager\";\r\nimport { designManager } from \"../../manager/designManager\";\r\nimport { BaseUILayer } from \"../layer/BaseUILayer\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PropItemPrefab')\r\nexport class PropItemPrefab extends BaseUILayer {\r\n\r\n    @property({ type: Sprite, tooltip: \"图标\" }) icon: Sprite = null;\r\n    @property({ type: Sprite, tooltip: \"图标背景\" }) bg: Sprite = null;\r\n    @property({ type: Node, tooltip: \"灰色遮罩\" }) greybg: Node = null;\r\n    @property({ type: Sprite, tooltip: \"图标背景\" }) typeIcon: Sprite = null;\r\n\r\n\r\n    @property({ type: Label, tooltip: \"数量\" }) numLabel: Label = null;\r\n\r\n    private _propId: number = 0\r\n    private _propFlag = 0\r\n\r\n    public static Type_HideNum = 1\r\n    public static Type_UnWear = 1 << 1 // 详情可以穿戴按钮\r\n    public static Type_ToWear = 1 << 2 // 详情可以卸下按钮\r\n    public static Type_Bless = 1 << 3   // 点击选择合成 \r\n    public static Type_UnTouch = 1 << 4  // 不能点击\r\n    public static Type_Grey = 1 << 5  // 灰色遮罩\r\n    public static Type_ShowType = 1 << 6  // 展示类型图标\r\n    public static Type_UnKnow = 1 << 7  // 展示类型图标\r\n    public static Type_BigIcon = 1 << 8  // 展示类型图标\r\n    public static Type_OnlyIcon = 1 << 9  // 展示类型图标\r\n\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    public get propId() {\r\n        return this._propId\r\n    }\r\n\r\n    setView(id, num, flag = 0) {\r\n        this._propId = id\r\n        let propdata = designManager.getRowById(constants.tableName.prop, id)\r\n        let self = this\r\n\r\n        let fun = function (sprite) {\r\n            self.setImageCustomSize(sprite, 95)\r\n        }\r\n        this.node.off(Node.EventType.TOUCH_END, this.openInfo, this);\r\n\r\n\r\n\r\n        if (flag & PropItemPrefab.Type_UnKnow) {\r\n            this.numLabel.string = \"x??\"\r\n            this.setSpriteFrame2(this.icon.node, \"prop/prop_unknow\", fun, constants.bundles.icon)\r\n            this.greybg.active = false\r\n            this.typeIcon.node.active = false\r\n            return\r\n        }\r\n\r\n\r\n        if (propdata) {\r\n            let icon = \"prop/\" + propdata.icon\r\n            if (propdata.type == 11) {\r\n                let weaponData = designManager.getRowById(constants.tableName.weapon, propdata.weaponid)\r\n                icon = \"weapon/\" + weaponData.icon\r\n            }\r\n            this.setSpriteFrame2(this.bg.node, \"prop/propbg\" + propdata.quality, null, constants.bundles.icon)\r\n            this.setSpriteFrame2(this.typeIcon.node, \"prop/propType\" + propdata.quality, null, constants.bundles.icon)\r\n            this.setSpriteFrame2(this.icon.node, icon, fun, constants.bundles.icon)\r\n\r\n            if (!(flag & PropItemPrefab.Type_UnTouch) && (propdata.type == 8 || propdata.type == 11)) {\r\n                this.node.on(Node.EventType.TOUCH_END, this.openInfo, this);\r\n            }\r\n        } else {\r\n            this.setSpriteFrame2(this.bg.node, \"heroLayer/propbg\", null, constants.bundles.wwqVec)\r\n            this.setSpriteFrame2(this.icon.node, \"prop/prop_seat_\" + num, fun, constants.bundles.icon)\r\n            this.numLabel.node.active = false\r\n            this.greybg.active = false\r\n            this.typeIcon.node.active = false\r\n            return\r\n        }\r\n\r\n        if (flag & PropItemPrefab.Type_OnlyIcon) {\r\n            this.bg.node.active = false\r\n            this.greybg.active = false\r\n            this.typeIcon.node.active = false\r\n            this.numLabel.node.active = false\r\n\r\n            return\r\n        }\r\n\r\n\r\n        if (flag & PropItemPrefab.Type_BigIcon) {\r\n            this.greybg.active = false\r\n            this.typeIcon.node.active = false\r\n            this.bg.node.active = false\r\n            this.node.scale = v3(3, 3, 3)\r\n            this.numLabel.node.active = false\r\n            return\r\n        }\r\n\r\n\r\n        this.numLabel.string = \"X\" + num\r\n        this._propFlag = flag\r\n\r\n        //  myLog.i(\"prop : \", this._propId, flag)\r\n        if (flag & PropItemPrefab.Type_HideNum) {\r\n            this.numLabel.node.active = false\r\n        }\r\n\r\n        if (flag & PropItemPrefab.Type_Grey) {\r\n            this.greybg.active = true\r\n        } else {\r\n            this.greybg.active = false\r\n        }\r\n\r\n        if (flag & PropItemPrefab.Type_ShowType) {\r\n            this.typeIcon.node.active = true\r\n        } else {\r\n            this.typeIcon.node.active = false\r\n        }\r\n    }\r\n\r\n    openInfo() {\r\n        myLog.i(\"点击装备\")\r\n        audioManager.playEffect(\"btnClick\")\r\n\r\n        this.openLayer(constants.layers.PropInfoLayer, { propId: this._propId, flag: this._propFlag })\r\n    }\r\n\r\n    setScale(width) {\r\n        let bgWidth = this.bg.getComponent(UITransform).width\r\n        let bgHeight = this.bg.getComponent(UITransform).height\r\n        let scale = width / bgWidth\r\n        this.node.scale = v3(scale, scale, 1)\r\n\r\n        this.node.getComponent(UITransform).width = bgWidth * scale\r\n        this.node.getComponent(UITransform).height = bgHeight * scale\r\n    }\r\n\r\n    changeBg(resPath, bundleName) {\r\n        this.setSpriteFrame2(this.bg.node, resPath, null, bundleName)\r\n        \r\n    }\r\n\r\n}"]}