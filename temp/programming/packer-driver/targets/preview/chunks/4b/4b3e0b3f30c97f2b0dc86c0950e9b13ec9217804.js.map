{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/bullet/Bullet1071.ts"],"names":["Component","find","tween","Tween","UIOpacity","v3","_decorator","cocosUtil","utilTools","constants","mapModel","ccclass","property","bullet1071","bullet","contactNotHide","contactBulletTime","lv","shineColor","init","node","angle","extraObj","frameColor","parseColor","design","maxLv","initScale","stopAllByTarget","bodyNode","uiOpacity","getComponent","opacity","to","start","setRenderableColor","frameLayer","time","forArr","children","frameNode","index","active","scheduleOnce","call","scale","Math","random","onUpdate","ratio","union","repeatForever","endCb","skillSystem","getSkill2RangeAddScale","update","playerPos","player","getPosition","setPosition","recycleSelfEnd","unscheduleAllCallbacks"],"mappings":"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","sourcesContent":["import { Color, Component, find, Node, tween, Tween, UIOpacity, v3, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { utilTools } from '../../../../utils/utilTools';\r\nimport { constants } from '../../../data/constants';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { Bullet } from './Bullet';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 技能-力场\r\n@ccclass('bullet1071')\r\nexport class bullet1071 extends Component {\r\n\r\n    bullet: Bullet;\r\n    contactNotHide: boolean = true;\r\n    contactBulletTime: number = 1;\r\n\r\n    lv: number;\r\n    shineColor: Color;\r\n\r\n    init(bullet: Bullet) {\r\n        this.bullet = bullet;\r\n\r\n        this.node.angle = 0;\r\n        let lv = this.bullet.extraObj.lv;\r\n        this.lv = lv;\r\n\r\n        let frameColor = \"#22D600\".parseColor();\r\n        if (lv == constants.design.maxLv) {\r\n            frameColor = \"#FF00F5\".parseColor();\r\n        }\r\n        this.shineColor = frameColor;\r\n        this.initScale();\r\n\r\n        Tween.stopAllByTarget(this.bullet.bodyNode);\r\n        let uiOpacity = this.bullet.bodyNode.getComponent(UIOpacity);\r\n        uiOpacity.opacity = 0;\r\n        tween(uiOpacity).to(2, { opacity: 255 }).start();\r\n\r\n        cocosUtil.setRenderableColor(this.bullet.bodyNode, frameColor);\r\n        let frameLayer = find(\"frameLayer\", this.node);\r\n        let time = 0.8;\r\n        utilTools.forArr(frameLayer.children, (frameNode: Node, index: number) => {\r\n            frameNode.active = false;\r\n            cocosUtil.setRenderableColor(frameNode, frameColor);\r\n            Tween.stopAllByTarget(frameNode);\r\n            this.scheduleOnce(() => {\r\n                tween(frameNode).call(() => {\r\n                    frameNode.active = true;\r\n                    frameNode.scale = v3(0, 0, 1);\r\n                    frameNode.getComponent(UIOpacity).opacity = 255;\r\n                    frameNode.angle = Math.random() * 360;\r\n                }).to(time * 4, { scale: v3(0.8, 0.8, 1) }).to(time, { scale: v3(1, 1, 1) }, {\r\n                    onUpdate: (node: Node, ratio: number) => {\r\n                        frameNode.getComponent(UIOpacity).opacity = 255 * (1 - ratio);\r\n                    }\r\n                }).union().repeatForever().start();\r\n            }, index * time * 1.25);\r\n        });\r\n\r\n        this.bullet.extraObj.endCb(this);\r\n    }\r\n\r\n    initScale() {\r\n        let scale = 0.8 + this.lv * 0.4;\r\n        scale += mapModel.skillSystem.getSkill2RangeAddScale();\r\n        this.node.scale = v3(scale, scale, 1);\r\n    }\r\n\r\n    update() {\r\n        // 跟随玩家移动\r\n        let playerPos = mapModel.player.node.getPosition();\r\n        this.node.setPosition(playerPos);\r\n    }\r\n\r\n    recycleSelfEnd() {\r\n        this.unscheduleAllCallbacks();\r\n        utilTools.forArr(find(\"frameLayer\", this.node).children, (frameNode: Node) => {\r\n            Tween.stopAllByTarget(frameNode);\r\n        });\r\n    }\r\n\r\n}\r\n\r\n"]}