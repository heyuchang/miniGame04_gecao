{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/EnergyLayer.ts"],"names":["find","ScrollView","UITransform","v2","_decorator","sdkManager","cocosUtil","constants","localText","msgac","designManager","eventManager","playerModel","UserData","BaseLayer","ccclass","property","EnergyLayer","timeNode","barNode","contentNode","handNode","itemUIArr","onLoad","layerName","layers","getNodeByPath","active","rowArr","getTable","tableName","energyAward","energyItem","itemUI","i","length","row","instantiate","parent","push","height","getComponent","onEnable","addEventArr","energyObjRefresh","scheduleOnce","refreshShowList","listNode","targetItemUI","info","getEnergyAwardInfoById","id","getInstance","energy","num","award1","pos","convertToWorldSpace","convertToNodeSpace","position","my","Math","abs","y","scrollToOffset","onDisable","removeEventArr","onDestroy","energyObjRefreshRet","data","scrollView","stopAutoScroll","scrollToTop","initUI","refreshTimeNode","refreshItemUIArr","refrshProgress","duration","energyObj","endTime","getTime","Date","day","floor","times","hour","ceil","houre","setString","energyTimeHint","format","tb","p","getRowById","lastRow","lastNum","max","r","rp","setProgressBar","point","shineNode1","lockNode1","hasGetNode1","shineNode2","lockNode2","hasGetNode2","award2","onClickAwardItem1","node","openAwardInfoLayer","award","addPropArrByDesign","openAwardGetLayer","send","refreshRedPoint","onClickAwardItem2","openAd","st","onClickBar"],"mappings":"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","sourcesContent":["import { find, Node, ScrollView, UITransform, v2, _decorator } from 'cc';\r\nimport { sdkManager } from '../../../sdk/sdkManager';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { constants } from '../../data/constants';\r\nimport { localText } from '../../data/localText';\r\nimport { msgac } from '../../data/msgac';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { eventManager } from '../../manager/eventManager';\r\nimport { playerModel } from '../../model/playerModel';\r\nimport { UserData } from '../../model/UserData';\r\nimport { BaseLayer } from '../base/BaseLayer';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('EnergyLayer')\r\nexport class EnergyLayer extends BaseLayer {\r\n\r\n    timeNode: Node;\r\n    barNode: Node;\r\n    contentNode: Node;\r\n    handNode: Node;\r\n\r\n    itemUIArr: any = [];\r\n\r\n    onLoad() {\r\n        this.layerName = constants.layers.EnergyLayer;\r\n        super.onLoad();\r\n\r\n        this.timeNode = this.getNodeByPath(\"ui/time/text\");\r\n        this.barNode = this.getNodeByPath(\"ui/energyListNoUtil/view/content/bar\");\r\n        this.contentNode = this.getNodeByPath(\"ui/energyListNoUtil/view/content\");\r\n        this.handNode = this.getNodeByPath(\"ui/energyListNoUtil/view/content/hand\");\r\n        this.handNode.active = false;\r\n\r\n        let rowArr = designManager.getTable(constants.tableName.energyAward);\r\n        let energyItem = find(\"layer/energyItem\", this.contentNode);\r\n        let itemUI: any = energyItem;\r\n        for (let i = 0; i < rowArr.length; i++) {\r\n            let row = rowArr[i];\r\n            if (i > 0) {\r\n                itemUI = cocosUtil.instantiate(energyItem);\r\n                itemUI.parent = find(\"layer\", this.contentNode);\r\n            }\r\n            itemUI.row = row;\r\n            this.itemUIArr.push(itemUI);\r\n        }\r\n\r\n        let height = itemUI.getComponent(UITransform).height;\r\n        this.contentNode.getComponent(UITransform).height = height * (rowArr.length + 0.5);\r\n        this.barNode.getComponent(UITransform).height = height * rowArr.length;\r\n\r\n        // test\r\n        // UserData.getInstance().addPropNum(108, 600);\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n        this.addEventArr([\r\n            msgac.energyObjRefresh\r\n        ]);\r\n\r\n        this.scheduleOnce(() => {\r\n            this.refreshShowList();\r\n        });\r\n    }\r\n\r\n    refreshShowList() {\r\n        this.handNode.active = false;\r\n        let listNode = this.getNodeByPath(\"ui/energyListNoUtil\");\r\n        // 自动滚动，优先到首个未领取奖励的地方，其次首个未完成的地方\r\n        let targetItemUI = null;\r\n        for (let i = 0; i < this.itemUIArr.length; i++) {\r\n            let row = this.itemUIArr[i].row;\r\n            let info = playerModel.getEnergyAwardInfoById(row.id);\r\n            if (UserData.getInstance().energy >= row.num && (!info.award1)) {\r\n                targetItemUI = this.itemUIArr[i];\r\n                break;\r\n            }\r\n        }\r\n        if (targetItemUI) {\r\n            this.handNode.active = true;\r\n            let pos = cocosUtil.convertToWorldSpace(find(\"awardLayer/awardItem1\", targetItemUI));\r\n            pos = cocosUtil.convertToNodeSpace(this.handNode, pos);\r\n            this.handNode.position = pos;\r\n        }\r\n\r\n        if (!targetItemUI) {\r\n            for (let i = 0; i < this.itemUIArr.length; i++) {\r\n                let row = this.itemUIArr[i].row;\r\n                if (UserData.getInstance().energy < row.num) {\r\n                    targetItemUI = this.itemUIArr[i];\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (!targetItemUI) {\r\n            targetItemUI = this.itemUIArr[this.itemUIArr.length - 1];\r\n        }\r\n\r\n        let my = Math.abs(targetItemUI.position.y) - targetItemUI.getComponent(UITransform).height;\r\n        if (my < 0) {\r\n            my = 0;\r\n        }\r\n        let pos = v2(0, 0);\r\n        pos.y = my;\r\n        listNode.getComponent(ScrollView).scrollToOffset(pos, 0.6);\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n\r\n        this.removeEventArr([\r\n            msgac.energyObjRefresh\r\n        ]);\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n\r\n    energyObjRefreshRet(data: any) {\r\n        let scrollView = this.getNodeByPath(\"ui/energyListNoUtil\").getComponent(ScrollView);\r\n        scrollView.stopAutoScroll();\r\n        scrollView.scrollToTop();\r\n        this.initUI();\r\n    }\r\n\r\n    initUI() {\r\n        this.refreshTimeNode();\r\n        this.refreshItemUIArr();\r\n        this.refrshProgress();\r\n    }\r\n\r\n    refreshTimeNode() {\r\n        let duration = playerModel.energyObj.endTime.getTime() - new Date().getTime();\r\n        let day = Math.floor(duration / constants.times.day);\r\n        let hour = Math.ceil((duration - day * constants.times.day) / constants.times.houre);\r\n        this.setString(this.timeNode, localText.energyTimeHint.format(day, hour));\r\n    }\r\n\r\n    refrshProgress() {\r\n        let tb = designManager.getTable(constants.tableName.energyAward);\r\n        let id = 0;\r\n        for (let i = 0; i < tb.length; i++) {\r\n            let row = tb[i];\r\n            if (UserData.getInstance().energy < row.num) {\r\n                id = i + 1;\r\n                break;\r\n            }\r\n        }\r\n        let p = 1 / tb.length * (id - 1);\r\n        if (id == 0) {\r\n            p = 1;\r\n        } else {\r\n            let row = designManager.getRowById(constants.tableName.energyAward, id);\r\n            let lastRow = designManager.getRowById(constants.tableName.energyAward, id - 1);\r\n            let lastNum = 0;\r\n            if (lastRow) {\r\n                lastNum = lastRow.num;\r\n            }\r\n            let max = row.num - lastNum;\r\n            let r = UserData.getInstance().energy - lastNum;\r\n            let rp = (1 / tb.length) * (r / max);\r\n            p += rp;\r\n        }\r\n        this.setProgressBar(this.barNode, p);\r\n    }\r\n\r\n    refreshItemUIArr() {\r\n        for (let i = 0; i < this.itemUIArr.length; i++) {\r\n            let itemUI = this.itemUIArr[i];\r\n            let row = itemUI.row;\r\n            this.setString(find(\"flag/rank\", itemUI), row.id);\r\n            this.setString(find(\"flag/num\", itemUI), row.num + localText.point);\r\n            let info = playerModel.getEnergyAwardInfoById(row.id);\r\n\r\n            // 普通奖励\r\n            find(\"awardLayer/awardItem1\", itemUI).row = row;\r\n            let shineNode1 = find(\"awardLayer/awardItem1/shine\", itemUI);\r\n            let lockNode1 = find(\"awardLayer/awardItem1/lock\", itemUI);\r\n            let hasGetNode1 = find(\"awardLayer/awardItem1/hasGet\", itemUI);\r\n            shineNode1.active = false;\r\n            lockNode1.active = false;\r\n            hasGetNode1.active = false;\r\n            if (UserData.getInstance().energy >= row.num) {\r\n                if (info.award1) {\r\n                    // 已领取\r\n                    hasGetNode1.active = true;\r\n                } else {\r\n                    // 可领取\r\n                    shineNode1.active = true;\r\n                }\r\n            } else {\r\n                lockNode1.active = true;\r\n            }\r\n\r\n            // 广告奖励\r\n            find(\"awardLayer/awardItem2\", itemUI).row = row;\r\n            let shineNode2 = find(\"awardLayer/awardItem2/shine\", itemUI);\r\n            let lockNode2 = find(\"awardLayer/awardItem2/lock\", itemUI);\r\n            let hasGetNode2 = find(\"awardLayer/awardItem2/hasGet\", itemUI);\r\n            shineNode2.active = false;\r\n            lockNode2.active = false;\r\n            hasGetNode2.active = false;\r\n            if (UserData.getInstance().energy >= row.num) {\r\n                if (info.award2) {\r\n                    // 已领取\r\n                    hasGetNode2.active = true;\r\n                } else {\r\n                    // 可领取\r\n                    shineNode2.active = true;\r\n                }\r\n            } else {\r\n                lockNode2.active = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    onClickAwardItem1(node: any) {\r\n        let row = node.row;\r\n        if (UserData.getInstance().energy < row.num) {\r\n            // 还未完成\r\n            this.openAwardInfoLayer(row.award1);\r\n            return;\r\n        }\r\n        let info = playerModel.getEnergyAwardInfoById(row.id);\r\n        if (info.award1) {\r\n            // 已领取\r\n            this.openAwardInfoLayer(row.award1);\r\n            return;\r\n        }\r\n        info.award1 = 1;\r\n        let award = UserData.getInstance().addPropArrByDesign(row.award1);\r\n        this.openAwardGetLayer(award);\r\n        this.initUI();\r\n        this.refreshShowList();\r\n        eventManager.send(msgac.refreshRedPoint);\r\n    }\r\n\r\n    onClickAwardItem2(node: any) {\r\n        let row = node.row;\r\n        if (UserData.getInstance().energy < row.num) {\r\n            // 还未完成\r\n            this.openAwardInfoLayer(row.award2);\r\n            return;\r\n        }\r\n        let info = playerModel.getEnergyAwardInfoById(row.id);\r\n        if (info.award2) {\r\n            // 已领取\r\n            this.openAwardInfoLayer(row.award2);\r\n            return;\r\n        }\r\n        sdkManager.openAd(\"能量战令\", (st: number) => {\r\n            if (st == 1) {\r\n                info.award2 = 1;\r\n                let award = UserData.getInstance().addPropArrByDesign(row.award2);\r\n                this.openAwardGetLayer(award);\r\n                this.initUI();\r\n            }\r\n        });\r\n    }\r\n\r\n    onClickBar() {\r\n        // playerModel.energyObj.endTime = new Date();\r\n        // UserData.getInstance().addPropNum(108, 100);\r\n        // this.initUI();\r\n    }\r\n\r\n}\r\n\r\n"]}