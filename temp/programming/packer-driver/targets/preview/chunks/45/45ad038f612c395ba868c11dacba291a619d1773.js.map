{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/tyqSDK/beHaviorComponent.ts"],"names":["assetManager","Component","SpriteFrame","Texture2D","_decorator","Node","Sprite","Wechat","Channel","tyqAdManager","tyqSDKConfig","ccclass","property","beHaviorComponent","type","tooltip","isClick","onEnable","start","isOpenBeHavior","console","log","destroy","node","on","EventType","TOUCH_START","getChannel","WECHAT","strategy","isShareBehavior","loadAsset","err","sp","icon","getComponent","spriteFrame","reportShareBehavior","currentShow","onDisable","bundleName","path","assetType","onProgress","onComplete","bundle","getBundle","get","loadAssetFunc","load","finish","total","asset","message","loadBundle","retBundle"],"mappings":"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","sourcesContent":["import { assetManager, Component, SpriteFrame, Texture2D, _decorator, Node, Sprite } from \"cc\";\r\nimport { Wechat } from \"./platform/wechat/wechat\";\r\nimport { Channel, tyqAdManager } from \"./tyqAdManager\";\r\nimport { tyqSDKConfig } from \"./tyqSDKConfig\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('beHaviorComponent')\r\nexport class beHaviorComponent extends Component {\r\n\r\n    @property({ type: Node }) icon: Node = null;\r\n    @property({ tooltip: \"广告业务1：系统分配，0：自定义\" }) strategy = 1;\r\n    @property({ tooltip: \"强制0：广告，1分享，strategy == 1时才生效\" }) currentShow = 0;\r\n\r\n    private isClick = false\r\n    onEnable() {\r\n    }\r\n\r\n    start() {\r\n        if (!tyqSDKConfig.isOpenBeHavior) {\r\n            console.log(\"beHaviorComponent destroy\")\r\n            this.destroy()\r\n            return\r\n        }\r\n\r\n        this.node.on(Node.EventType.TOUCH_START, () => {\r\n            console.log(\"beHaviorComponent 点击\")\r\n            this.isClick = true\r\n        }, this);\r\n        if (tyqAdManager.getChannel() != Channel.WECHAT) {\r\n            return\r\n        }\r\n        if (this.strategy == 1) {\r\n            if (Wechat.isShareBehavior()) {\r\n                this.loadAsset(\"icon\", \"prop/ui_Share\", SpriteFrame, null, (err, sp) => {\r\n                    this.icon.getComponent(Sprite).spriteFrame = sp\r\n                })\r\n                tyqAdManager.reportShareBehavior(1, this.strategy, 1)\r\n            } else {\r\n                tyqAdManager.reportShareBehavior(1, this.strategy, 0)\r\n            }\r\n        } else {\r\n            if (this.currentShow == 1) {\r\n                this.loadAsset(\"icon\", \"prop/ui_Share\", SpriteFrame, null, (err, sp) => {\r\n                    this.icon.getComponent(Sprite).spriteFrame = sp\r\n                })\r\n                tyqAdManager.reportShareBehavior(1, this.strategy, 1)\r\n            } else {\r\n                tyqAdManager.reportShareBehavior(1, this.strategy, 0)\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    onDisable() {\r\n        if (tyqAdManager.getChannel() != Channel.WECHAT) {\r\n            return\r\n        }\r\n        if (this.strategy == 1) {\r\n            if (Wechat.isShareBehavior()) {\r\n                this.loadAsset(\"icon\", \"prop/ui_Share\", SpriteFrame, null, (err, sp) => {\r\n                    this.icon.getComponent(Sprite).spriteFrame = sp\r\n                })\r\n                tyqAdManager.reportShareBehavior(this.isClick ? 4 : 3, this.strategy, 1)\r\n            } else {\r\n                tyqAdManager.reportShareBehavior(this.isClick ? 4 : 3, this.strategy, 0)\r\n            }\r\n        } else {\r\n            if (this.currentShow == 1) {\r\n                this.loadAsset(\"icon\", \"prop/ui_Share\", SpriteFrame, null, (err, sp) => {\r\n                    this.icon.getComponent(Sprite).spriteFrame = sp\r\n                })\r\n                tyqAdManager.reportShareBehavior(this.isClick ? 4 : 3, this.strategy, 1)\r\n            } else {\r\n                tyqAdManager.reportShareBehavior(this.isClick ? 4 : 3, this.strategy, 0)\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n   * 从bundle中加载某个资源，优先使用缓存中的\r\n   * @param bundleName bundle名称\r\n   * @param path 资源路径\r\n   * @param assetType 资源类型\r\n   * @param onProgress 加载进度回调\r\n   * @param onComplete 加载完成回调\r\n   */\r\n    loadAsset(bundleName: string, path: string, assetType: any, onProgress?: Function, onComplete?: Function) {\r\n        if (assetType == SpriteFrame) {\r\n            path += \"/spriteFrame\";\r\n        } else if (assetType == Texture2D) {\r\n            path += \"/texture\";\r\n        }\r\n        let bundle = assetManager.getBundle(bundleName);\r\n        if (bundle && bundle.get(path, assetType)) {\r\n            if (onComplete) {\r\n                onComplete(null, bundle.get(path, assetType));\r\n            }\r\n            return;\r\n        }\r\n\r\n        let loadAssetFunc = () => {\r\n            bundle.load(path, assetType, (finish: number, total: number) => {\r\n                if (onProgress) {\r\n                    onProgress(finish / total);\r\n                }\r\n            }, (err, asset) => {\r\n                if (err) {\r\n                    console.log(\"ResManager.loadAsset error:\" + err.message, \"bundleName:\" + bundleName, \"path:\" + path, err);\r\n                    if (onComplete) {\r\n                        onComplete(err);\r\n                    }\r\n                    return;\r\n                }\r\n                if (onComplete) {\r\n                    onComplete(null, asset);\r\n                }\r\n            });\r\n        };\r\n\r\n        if (!bundle) {\r\n            assetManager.loadBundle(bundleName, (err, retBundle) => {\r\n                if (err) {\r\n                    if (onComplete) {\r\n                        onComplete(err);\r\n                    }\r\n                    return;\r\n                }\r\n                bundle = retBundle;\r\n                loadAssetFunc();\r\n            });\r\n            return;\r\n        }\r\n\r\n        loadAssetFunc();\r\n    }\r\n\r\n}"]}