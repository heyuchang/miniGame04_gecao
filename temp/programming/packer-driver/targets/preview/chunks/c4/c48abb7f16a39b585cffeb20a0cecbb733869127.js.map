{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/BackLifeLayer.ts"],"names":["Color","tween","v3","_decorator","sdkManager","Channel","tyqAdManager","cocosUtil","localText","designManager","mapModel","UserData","BaseLayer","ccclass","property","BackLifeLayer","timeNode","time","diamondNumNode","onLoad","getNodeByPath","isShowBannerAd","onEnable","getInstance","mapData","onDisable","onDestroy","initUI","config","backLifeCount","mapSystem","backlifeCount","doSettlement","closeLayer","delay","to","scale","call","getChannel","H5_4399","onClickBtnClose","setString","union","repeat","start","backLifeDiamond","baoshi","setRenderableColor","RED","WHITE","processEvent","ac","data","onButtonClick","node","name","roleBackLife","player","backLife","onClickBtnAd","openAd","st","onClickBtnDiamond","createNotice","lackDiamond","useBaoShi"],"mappings":"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","sourcesContent":["import { Color, Node, tween, v3, _decorator } from 'cc';\r\nimport { sdkManager } from '../../../sdk/sdkManager';\r\nimport { Channel, tyqAdManager } from '../../../tyqSDK/tyqAdManager';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { localText } from '../../data/localText';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { mapModel } from '../../model/mapModel';\r\nimport { UserData } from '../../model/UserData';\r\nimport { BaseLayer } from '../base/BaseLayer';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BackLifeLayer')\r\nexport class BackLifeLayer extends BaseLayer {\r\n\r\n    timeNode: Node;\r\n    time: number = 9;\r\n\r\n    diamondNumNode: Node;\r\n\r\n    onLoad() {\r\n        super.onLoad();\r\n\r\n        this.timeNode = this.getNodeByPath(\"ui/time/time\");\r\n        this.diamondNumNode = this.getNodeByPath(\"ui/btns/btnDiamond/info/num\");\r\n        this.isShowBannerAd = true;\r\n\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n\r\n        UserData.getInstance().mapData = null;\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n\r\n    initUI() {\r\n        if (designManager.config.backLifeCount > 0 && mapModel.mapSystem.backlifeCount >= designManager.config.backLifeCount) {\r\n            // 复活次数已达上限\r\n            mapModel.mapSystem.doSettlement(false);\r\n            this.closeLayer();\r\n            return;\r\n        }\r\n        tween(this.timeNode).delay(0.2).to(0.6, { scale: v3(1.3, 1.3, 1) }).call(() => {\r\n            this.time--;\r\n            if (this.time < 0) {\r\n                this.time = 0;\r\n                if (tyqAdManager.getChannel() == Channel.H5_4399) {\r\n                    this.onClickBtnClose()\r\n                }\r\n            }\r\n            this.setString(this.timeNode, this.time);\r\n        }).to(0.6, { scale: v3(1, 1, 1) }).union().repeat(10).start();\r\n\r\n        this.setString(this.diamondNumNode, \"x\" + designManager.config.backLifeDiamond);\r\n        if (UserData.getInstance().baoshi < designManager.config.backLifeDiamond) {\r\n            cocosUtil.setRenderableColor(this.diamondNumNode, Color.RED);\r\n        } else {\r\n            cocosUtil.setRenderableColor(this.diamondNumNode, Color.WHITE);\r\n        }\r\n    }\r\n\r\n    processEvent(ac: any, data: any) {\r\n        switch (ac) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onButtonClick(node: Node, name: string) {\r\n        switch (name) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    roleBackLife() {\r\n        mapModel.mapSystem.backlifeCount++;\r\n        mapModel.player.backLife();\r\n        this.closeLayer();\r\n    }\r\n\r\n    onClickBtnClose() {\r\n        mapModel.mapSystem.doSettlement(false);\r\n        this.closeLayer();\r\n    }\r\n\r\n    onClickBtnAd() {\r\n        sdkManager.openAd(\"复活\", (st: number) => {\r\n            if (st == 1) {\r\n                this.roleBackLife();\r\n            }\r\n        });\r\n    }\r\n\r\n    onClickBtnDiamond() {\r\n        if (UserData.getInstance().baoshi < designManager.config.backLifeDiamond) {\r\n            this.createNotice(localText.lackDiamond);\r\n            return;\r\n        }\r\n        UserData.getInstance().useBaoShi(-designManager.config.backLifeDiamond, true);\r\n        this.roleBackLife();\r\n    }\r\n\r\n}\r\n\r\n"]}