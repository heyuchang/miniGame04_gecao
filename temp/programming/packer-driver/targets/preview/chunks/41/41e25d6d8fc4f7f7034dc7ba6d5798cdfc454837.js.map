{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/PropInfoLayer.ts"],"names":["Label","Node","RichText","_decorator","constants","msgac","designManager","eventManager","UserData","PropItemPrefab","BaseUILayer","ccclass","property","PropInfoLayer","type","tooltip","_propId","_propFlag","_weaponLv","onLoad","layerData","propId","flag","weaponLv","propData","getRowById","tableName","prop","atk","setSpriteFrame2","attrIcon","bundles","wwqVec","getInstance","weaponOptLvEffect","attrNumLab","string","color","colors","blue","parseColor","attrlabel","hp","green","propInfoLab","info","propNameLab","name","propItem","getComponent","setView","Type_HideNum","Type_ShowType","btnWear","off","EventType","TOUCH_END","unWearProp","wearProp","Type_ToWear","getChildByName","common","on","Type_UnWear","active","suitId","suit_id","suitNode","suitData","suit","suitNameLab","suitNum","getSuitNum","getColor","num","color1","color2","str","atkStr3","effectAtk_3","effectHP_3","suitAttr3","atkStr5","effectAtk_5","effectHP_5","suitAttr5","initBtnInfo","propdata","setWearProp","send","wearDrop","onClose","closeLayer"],"mappings":"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","sourcesContent":["import { Label, Node, RichText, _decorator } from 'cc';\r\nimport { constants } from '../../data/constants';\r\nimport { msgac } from '../../data/msgac';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { eventManager } from '../../manager/eventManager';\r\nimport { UserData } from '../../model/UserData';\r\nimport { PropItemPrefab } from '../item/PropItemPrefab';\r\nimport { BaseUILayer } from './BaseUILayer';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PropInfoLayer')\r\nexport class PropInfoLayer extends BaseUILayer {\r\n\r\n\r\n    @property({ type: Node, tooltip: \"道具节点\" }) propItem: Node = null;\r\n    @property({ type: Node, tooltip: \"按钮\" }) btnWear: Node = null;\r\n\r\n    @property({ type: Node, tooltip: \"属性图标\" }) attrIcon: Node = null;\r\n    @property({ type: Label, tooltip: \"属性\" }) attrlabel: Label = null;\r\n    @property({ type: Label, tooltip: \"属性值\" }) attrNumLab: Label = null;\r\n\r\n    @property({ type: Label, tooltip: \"装备详情\" }) propInfoLab: Label = null;\r\n    @property({ type: Label, tooltip: \"装备名字\" }) propNameLab: Label = null;\r\n\r\n    @property({ type: Label, tooltip: \"套装名字\" }) suitNameLab: Label = null;\r\n\r\n    @property({ type: RichText, tooltip: \"3套属性\" }) suitAttr3: RichText = null;\r\n    @property({ type: RichText, tooltip: \"5套属性\" }) suitAttr5: RichText = null;\r\n    @property({ type: Label, tooltip: \"套装数量\" }) suitNum: Label = null;\r\n\r\n    @property({ type: Node, tooltip: \"套装节点\" }) suitNode: Node = null;\r\n\r\n\r\n    _propId = 0\r\n    _propFlag = 0\r\n    _weaponLv = 0;\r\n\r\n    onLoad() {\r\n        super.onLoad();\r\n        this._propId = this.layerData.propId\r\n        this._propFlag = this.layerData.flag\r\n        this._weaponLv = this.layerData.weaponLv;\r\n\r\n        let propData = designManager.getRowById(constants.tableName.prop, this._propId)\r\n\r\n        if (propData.atk > 0) {\r\n            this.setSpriteFrame2(this.attrIcon, \"heroLayer/ui_gj\", null, constants.bundles.wwqVec)\r\n            let atk = propData.atk;\r\n            if (this._weaponLv > 0) {\r\n                atk = UserData.getInstance().weaponOptLvEffect(atk, this._weaponLv);\r\n            }\r\n            this.attrNumLab.string = \"+\" + atk\r\n            this.attrNumLab.color = constants.colors.blue.parseColor()\r\n            this.attrlabel.string = \"攻击\"\r\n        } else if (propData.hp > 0) {\r\n            this.attrNumLab.string = \"+\" + propData.hp\r\n            this.setSpriteFrame2(this.attrIcon, \"heroLayer/ui_sm\", null, constants.bundles.wwqVec)\r\n            this.attrlabel.string = \"生命\"\r\n            this.attrNumLab.color = constants.colors.green.parseColor()\r\n        }\r\n\r\n        this.propInfoLab.string = \"\" + propData.info\r\n        this.propNameLab.string = \"\" + propData.name\r\n\r\n        this.propItem.getComponent(PropItemPrefab).setView(this._propId, 0, PropItemPrefab.Type_HideNum | PropItemPrefab.Type_ShowType)\r\n        this.btnWear.off(Node.EventType.TOUCH_END, this.unWearProp, this);\r\n        this.btnWear.off(Node.EventType.TOUCH_END, this.wearProp, this);\r\n        if (this._propFlag & PropItemPrefab.Type_ToWear) {\r\n            this.btnWear.getChildByName(\"Label\").getComponent(Label).string = \"穿戴\"\r\n            this.setSpriteFrame2(this.btnWear, \"btnres/ui_yellow\", null, constants.bundles.common)\r\n            this.btnWear.on(Node.EventType.TOUCH_END, this.wearProp, this);\r\n        } else if (this._propFlag & PropItemPrefab.Type_UnWear) {\r\n            this.btnWear.getChildByName(\"Label\").getComponent(Label).string = \"卸下\"\r\n            this.btnWear.on(Node.EventType.TOUCH_END, this.unWearProp, this);\r\n            this.setSpriteFrame2(this.btnWear, \"btnres/btn_purple\", null, constants.bundles.common)\r\n        } else {\r\n            this.btnWear.active = false\r\n        }\r\n\r\n        let suitId = propData.suit_id\r\n        if (suitId) {\r\n            this.suitNode.active = true\r\n            let suitData = designManager.getRowById(constants.tableName.suit, suitId)\r\n            this.suitNameLab.string = suitData.name\r\n\r\n            let suitNum = UserData.getInstance().getSuitNum(propData)\r\n            this.suitNum.string = \"(\" + suitNum + \"/5)\"\r\n\r\n            let getColor = function (num, color1, color2, str) {\r\n                let color = suitNum >= num ? color1 : color2\r\n                return \"<color=\" + color + \">\" + str + \"</color>\"\r\n            }\r\n\r\n            let atkStr3 = \"\"\r\n            if (suitData.effectAtk_3 > 0) {\r\n                atkStr3 += getColor(3, \"#ffffff\", \"#4c5061\", \"攻击\") + getColor(3, \"#1096fd\", \"#4c5061\", \" +\" + suitData.effectAtk_3 + \"%\")\r\n            }\r\n            \r\n            if (suitData.effectHP_3 > 0) {\r\n                if (atkStr3 != \"\") {\r\n                    atkStr3 += \" \"\r\n                }\r\n                atkStr3 += getColor(3, \"#ffffff\", \"#4c5061\", \"血量\") + getColor(3, \"#38ff38\", \"#4c5061\", \" +\" + suitData.effectHP_3 + \"%\")\r\n            }\r\n\r\n            this.suitAttr3.string = atkStr3\r\n\r\n            let atkStr5 = \"\"\r\n            if (suitData.effectAtk_5 > 0) {\r\n                atkStr5 += getColor(5, \"#ffffff\", \"#4c5061\", \"攻击\") + getColor(5, \"#1096fd\", \"#4c5061\", \" +\" + suitData.effectAtk_5 + \"%\")\r\n            }\r\n\r\n            if (suitData.effectHP_5 > 0) {\r\n                if (atkStr5 != \"\") {\r\n                    atkStr5 += \" \"\r\n                }\r\n                atkStr5 += getColor(5, \"#ffffff\", \"#4c5061\", \"血量\") + getColor(5, \"#38ff38\", \"#4c5061\", \" +\" + suitData.effectHP_5 + \"%\")\r\n            }\r\n            this.suitAttr5.string = atkStr5\r\n        } else {\r\n            this.suitNode.active = false\r\n        }\r\n    }\r\n\r\n    initBtnInfo() {\r\n\r\n    }\r\n\r\n    wearProp() {\r\n        let propdata = designManager.getRowById(constants.tableName.prop, this._propId)\r\n        UserData.getInstance().setWearProp(propdata)\r\n        eventManager.send(msgac.wearDrop)\r\n        this.onClose()\r\n    }\r\n\r\n    unWearProp() {\r\n        let propdata = designManager.getRowById(constants.tableName.prop, this._propId)\r\n        UserData.getInstance().unWearProp(propdata)\r\n        eventManager.send(msgac.wearDrop)\r\n        this.onClose()\r\n    }\r\n\r\n    onClose() {\r\n        this.closeLayer()\r\n    }\r\n\r\n}\r\n\r\n"]}