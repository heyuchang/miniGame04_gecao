{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/model/playerModel.ts"],"names":["PlayerModel","utilTools","constants","msgac","audioManager","designManager","eventManager","localStorageManager","mapModel","UserData","constructor","now","Date","secondInterval","saveTime","skillFreeRefreshCount","isOpenDev","isRecordAd","dayTaskObj","energyObj","daySignObj","vipObj","shareObj","isLetterAward","skillBombNum","skillHealNum","skillMagnetNum","skillLifeNum","instance","_instance","init","data","getInstance","playerData","timeStrToDate","initData","audio","player","fight","openSecondInterval","on","saveDataBefore","onSaveData","awardFlagArr","taskObj","num","awardObj","endTime","getTime","times","day","startTime","setHours","setMinutes","setSeconds","setMilliseconds","awardDayArr","finalAward","vip","adNum","dayAward","onceObj","dayNum","idAwardObj","friendNum","friendAdNum","friendPassNum","undefined","addDayTaskNum","getSaveData","clearInterval","setInterval","updateSecond","bind","overDay","send","energyObjRefresh","isInDevelopmentEnvironment","dayAct","clearGameData","setGameData","sendToUINotice","info","showNotice","getTaskInfoById","id","getAward","row","getRowById","tableName","dayTask","needNum","refreshRedPoint","getEnergyAwardInfoById","hasLetterAward","playerModel","hasDaySignAward","Math","floor","daySign","indexOf","hasDayTaskAward","tb","getTable","i","hasEnergyAward","energyAward","energy","award1","addVipAdNum","nextRow","hasVipAward"],"mappings":"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","sourcesContent":["import { utilTools } from \"../../utils/utilTools\";\r\nimport { constants } from \"../data/constants\";\r\nimport { msgac } from \"../data/msgac\";\r\nimport { audioManager } from \"../manager/audioManager\";\r\nimport { designManager } from \"../manager/designManager\";\r\nimport { eventManager } from \"../manager/eventManager\";\r\nimport { localStorageManager } from \"../manager/localStorageManager\";\r\nimport { mapModel } from \"./mapModel\";\r\nimport { UserData } from \"./UserData\";\r\n\r\nclass PlayerModel {\r\n    private static _instance: PlayerModel;\r\n    private constructor() { }\r\n    public static get instance(): PlayerModel {\r\n        if (!this._instance) {\r\n            this._instance = new PlayerModel();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    now: Date = new Date();\r\n    secondInterval: any;\r\n    saveTime: Date;\r\n    skillFreeRefreshCount = 0;\r\n\r\n    // 是否强制打开开发环境\r\n    isOpenDev: boolean = false;\r\n    // 运营录制视频版本\r\n    isRecordAd: boolean = false;\r\n\r\n    dayTaskObj: any = {};\r\n    energyObj: any = {};\r\n    daySignObj: any = {};\r\n    vipObj: any = {};\r\n    shareObj: any = {};\r\n\r\n    isLetterAward = 0;\r\n\r\n    skillBombNum = 1;\r\n    skillHealNum = 1;\r\n    skillMagnetNum = 0;\r\n    skillLifeNum = 0;\r\n\r\n    init() {\r\n        let now = new Date();\r\n        let data: any = UserData.getInstance().playerData;\r\n        utilTools.timeStrToDate(data);\r\n\r\n        audioManager.initData(data.audio);\r\n        this.initData(data.player, now);\r\n        mapModel.initData(data.fight, now);\r\n\r\n        this.openSecondInterval();\r\n        eventManager.on(msgac.saveDataBefore, this.onSaveData, this);\r\n    }\r\n\r\n    initData(data: any, now: Date) {\r\n        if (!data) {\r\n            data = {};\r\n        }\r\n        if (data.saveTime) {\r\n            this.saveTime = data.saveTime;\r\n        } else {\r\n            this.saveTime = now;\r\n        }\r\n\r\n        if (data.skillFreeRefreshCount) {\r\n            this.skillFreeRefreshCount = data.skillFreeRefreshCount\r\n        } else {\r\n            this.skillFreeRefreshCount = 0;\r\n        }\r\n\r\n        if (data.dayTaskObj) {\r\n            this.dayTaskObj = data.dayTaskObj;\r\n        } else {\r\n            this.dayTaskObj = {\r\n                awardFlagArr: [],\r\n                taskObj: {},\r\n            };\r\n        }\r\n\r\n        if (data.energyObj) {\r\n            this.energyObj = data.energyObj;\r\n        } else {\r\n            this.energyObj = {\r\n                num: 0,\r\n                awardObj: {}\r\n            };\r\n        }\r\n        if (!this.energyObj.endTime) {\r\n            this.energyObj.endTime = new Date(now.getTime() + 7 * constants.times.day);\r\n        }\r\n\r\n        if (data.daySignObj) {\r\n            this.daySignObj = data.daySignObj;\r\n        } else {\r\n            let startTime = new Date(now.getTime());\r\n            startTime.setHours(0);\r\n            startTime.setMinutes(0);\r\n            startTime.setSeconds(0);\r\n            startTime.setMilliseconds(0);\r\n            this.daySignObj = {\r\n                startTime: startTime,\r\n                awardDayArr: [],\r\n                finalAward: 0\r\n            };\r\n        }\r\n\r\n        if (data.isLetterAward) {\r\n            this.isLetterAward = data.isLetterAward;\r\n        } else {\r\n            this.isLetterAward = 0;\r\n        }\r\n\r\n        if (data.vipObj) {\r\n            this.vipObj = data.vipObj;\r\n        } else {\r\n            this.vipObj = {\r\n                vip: 1,\r\n                adNum: 0,\r\n                dayAward: 0,\r\n                onceObj: {}\r\n            };\r\n        }\r\n\r\n        if (data.shareObj) {\r\n            this.shareObj = data.shareObj;\r\n        } else {\r\n            this.shareObj = {\r\n                dayNum: 0,\r\n                idAwardObj: {},\r\n                friendNum: 0,\r\n                friendAdNum: 0,\r\n                friendPassNum: 0\r\n            };\r\n        }\r\n\r\n        if (data.skillBombNum == undefined) {\r\n            this.skillBombNum = 1;\r\n        } else {\r\n            this.skillBombNum = data.skillBombNum;\r\n        }\r\n        if (data.skillHealNum == undefined) {\r\n            this.skillHealNum = 1;\r\n        } else {\r\n            this.skillHealNum = data.skillHealNum;\r\n        }\r\n        if (data.skillMagnetNum == undefined) {\r\n            this.skillMagnetNum = 0;\r\n        } else {\r\n            this.skillMagnetNum = data.skillMagnetNum;\r\n        }\r\n        if (data.skillLifeNum == undefined) {\r\n            this.skillLifeNum = 1;\r\n        } else {\r\n            this.skillLifeNum = data.skillLifeNum;\r\n        }\r\n\r\n        this.addDayTaskNum(1);\r\n    }\r\n\r\n    getSaveData(now: Date) {\r\n        let data: any = {};\r\n        data.saveTime = this.saveTime;\r\n        data.skillFreeRefreshCount = this.skillFreeRefreshCount;\r\n        data.dayTaskObj = this.dayTaskObj;\r\n        data.energyObj = this.energyObj;\r\n        data.daySignObj = this.daySignObj;\r\n        data.isLetterAward = this.isLetterAward;\r\n        data.vipObj = this.vipObj;\r\n        data.shareObj = this.shareObj;\r\n        data.skillBombNum = this.skillBombNum;\r\n        data.skillHealNum = this.skillHealNum;\r\n        data.skillMagnetNum = this.skillMagnetNum;\r\n        data.skillLifeNum = this.skillLifeNum;\r\n\r\n        return data;\r\n    }\r\n\r\n    onSaveData() {\r\n        let now = new Date();\r\n        let data: any = {};\r\n        data.player = this.getSaveData(now);\r\n        data.audio = audioManager.getSaveData(now);\r\n\r\n        UserData.getInstance().playerData = data;\r\n    }\r\n\r\n    openSecondInterval() {\r\n        if (this.secondInterval) {\r\n            clearInterval(this.secondInterval);\r\n        }\r\n        this.secondInterval = setInterval(this.updateSecond.bind(this), 1000);\r\n        this.updateSecond();\r\n    }\r\n\r\n    updateSecond() {\r\n        let now = new Date();\r\n        this.now = now;\r\n\r\n        if (utilTools.overDay(this.saveTime, now)) {\r\n            // 跨天了\r\n            this.saveTime = now;\r\n            this.overDay(now);\r\n            // 通知UI层\r\n            eventManager.send(msgac.overDay);\r\n        }\r\n\r\n        if (now.getTime() >= this.energyObj.endTime) {\r\n            this.energyObj = {\r\n                num: 0,\r\n                awardObj: {},\r\n                endTime: new Date(now.getTime() + 7 * constants.times.day)\r\n            };\r\n            eventManager.send(msgac.energyObjRefresh);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 是否处于开发环境\r\n     */\r\n    isInDevelopmentEnvironment(): boolean {\r\n        return this.isOpenDev;\r\n    }\r\n\r\n    overDay(now: Date) {\r\n        this.skillFreeRefreshCount = 0;\r\n        this.dayTaskObj = {\r\n            awardFlagArr: [],\r\n            taskObj: {},\r\n        };\r\n        this.vipObj.dayAward = 0;\r\n        this.shareObj.dayNum = 0;\r\n        UserData.getInstance().dayAct = 0;\r\n    }\r\n\r\n    // 清楚存档，方便开发测试用\r\n    clearGameData() {\r\n        localStorageManager.setGameData({});\r\n        this.init();\r\n    }\r\n\r\n    sendToUINotice(info: any) {\r\n        eventManager.send(msgac.showNotice, info);\r\n    }\r\n\r\n    getTaskInfoById(id: number) {\r\n        let info = this.dayTaskObj.taskObj[id];\r\n        if (!info) {\r\n            info = {\r\n                num: 0,\r\n                getAward: 0\r\n            };\r\n            this.dayTaskObj.taskObj[id] = info;\r\n        }\r\n        return info;\r\n    }\r\n\r\n    addDayTaskNum(id: number, num: number = 1) {\r\n        let info = this.getTaskInfoById(id);\r\n        info.num += num;\r\n        let row = designManager.getRowById(constants.tableName.dayTask, id);\r\n        if (info.num >= row.needNum && !info.getAward) {\r\n            switch (id) {\r\n                case 4:\r\n                case 5:\r\n                case 6:\r\n                    break;\r\n                default:\r\n                    eventManager.send(msgac.refreshRedPoint);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    getEnergyAwardInfoById(id: number) {\r\n        let info = this.energyObj.awardObj[id];\r\n        if (!info) {\r\n            info = {};\r\n            this.energyObj.awardObj[id] = info;\r\n        }\r\n        return info;\r\n    }\r\n\r\n    hasLetterAward() {\r\n        if (playerModel.isLetterAward) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    hasDaySignAward() {\r\n        let now = new Date();\r\n        let day = Math.floor((now.getTime() - playerModel.daySignObj.startTime) / constants.times.day);\r\n\r\n        let row = designManager.getRowById(constants.tableName.daySign, day + 1);\r\n        if (!row) {\r\n            return false;\r\n        }\r\n\r\n        if (playerModel.daySignObj.awardDayArr.indexOf(day) == -1) {\r\n            return true;;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    hasDayTaskAward() {\r\n        let tb = designManager.getTable(constants.tableName.dayTask);\r\n        for (let i in tb) {\r\n            let row = tb[i];\r\n            let info = playerModel.getTaskInfoById(row.id);\r\n            if (info.num >= row.needNum && !info.getAward) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    hasEnergyAward() {\r\n        let tb = designManager.getTable(constants.tableName.energyAward);\r\n        for (let i in tb) {\r\n            let row = tb[i];\r\n            if (UserData.getInstance().energy < row.num) {\r\n                break;\r\n            }\r\n            let info = playerModel.getEnergyAwardInfoById(row.id);\r\n            if (!info.award1) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    addVipAdNum() {\r\n        this.vipObj.adNum++;\r\n        let row = designManager.getRowById(constants.tableName.vip, this.vipObj.vip);\r\n        if (this.vipObj.adNum >= row.adNum) {\r\n            let nextRow = designManager.getRowById(constants.tableName.vip, this.vipObj.vip + 1);\r\n            if (nextRow) {\r\n                // 提升VIP等级\r\n                this.vipObj.vip++;\r\n                this.vipObj.adNum = 0;\r\n                this.vipObj.dayAward = 0;\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    hasVipAward() {\r\n        if (!this.vipObj.dayAward || !this.vipObj.onceObj[this.vipObj.vip]) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n}\r\n\r\nexport const playerModel = PlayerModel.instance;\r\n\r\n"]}