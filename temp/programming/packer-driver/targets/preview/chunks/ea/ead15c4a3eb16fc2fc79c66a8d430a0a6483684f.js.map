{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/VipLayer.ts"],"names":["find","_decorator","sdkManager","constants","localText","msgac","designManager","eventManager","playerModel","UserData","BaseLayer","ccclass","property","VipLayer","choseVip","onLoad","vipObj","vip","onEnable","onDisable","onDestroy","initUI","setString","getNodeByPath","infoLayer","row","getRowById","tableName","nextRow","btnGet","active","adNum","id","setProgressBar","full","choseRow","weaponEquipAdd","format","atkAdd","btnGetBox1","hasGet1","onceObj","btnGetBox2","hasGet2","dayAward","processEvent","ac","data","onButtonClick","node","name","onClickBtnGetBox1","awardArr","getInstance","addPropArrByDesign","award","openAwardGetLayer","send","refreshRedPoint","onClickBtnGetBox2","onClickBtnLeft","onClickBtnRight","onClickBtnBox1","openAwardInfoLayer","onClickBtnBox2","onClickBtnGet","openAd","st","hasUp","addVipAdNum"],"mappings":"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","sourcesContent":["import { find, _decorator } from 'cc';\r\nimport { sdkManager } from '../../../sdk/sdkManager';\r\nimport { constants } from '../../data/constants';\r\nimport { localText } from '../../data/localText';\r\nimport { msgac } from '../../data/msgac';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { eventManager } from '../../manager/eventManager';\r\nimport { playerModel } from '../../model/playerModel';\r\nimport { UserData } from '../../model/UserData';\r\nimport { BaseLayer } from '../base/BaseLayer';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('VipLayer')\r\nexport class VipLayer extends BaseLayer {\r\n\r\n    choseVip: number;\r\n\r\n    onLoad() {\r\n        super.onLoad();\r\n\r\n        this.choseVip = playerModel.vipObj.vip;\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n\r\n    initUI() {\r\n        let vip = playerModel.vipObj.vip;\r\n        this.setString(this.getNodeByPath(\"ui/top/rank/val\"), vip);\r\n\r\n        let infoLayer = this.getNodeByPath(\"ui/top/bar/info\");\r\n        let row = designManager.getRowById(constants.tableName.vip, vip);\r\n        let nextRow = designManager.getRowById(constants.tableName.vip, vip + 1);\r\n        let btnGet = this.getNodeByPath(\"ui/top/btnGet\");\r\n        if (nextRow) {\r\n            infoLayer.active = true;\r\n            btnGet.active = true;\r\n            this.setString(find(\"val\", infoLayer), row.adNum);\r\n            this.setString(find(\"vip\", infoLayer), \"VIP\" + nextRow.id);\r\n            this.setProgressBar(this.getNodeByPath(\"ui/top/bar\"), playerModel.vipObj.adNum / row.adNum);\r\n            this.setString(this.getNodeByPath(\"ui/top/bar/val\"), playerModel.vipObj.adNum + \"/\" + row.adNum);\r\n        } else {\r\n            btnGet.active = false;\r\n            infoLayer.active = false;\r\n            this.setProgressBar(this.getNodeByPath(\"ui/top/bar\"), 1);\r\n            this.setString(this.getNodeByPath(\"ui/top/bar/val\"), localText.full);\r\n        }\r\n\r\n        this.setString(this.getNodeByPath(\"ui/vip\"), \"VIP\" + this.choseVip + \"特权\");\r\n        let choseRow = designManager.getRowById(constants.tableName.vip, this.choseVip);\r\n        this.setString(this.getNodeByPath(\"ui/text\"), localText.weaponEquipAdd.format(choseRow.atkAdd * 100));\r\n\r\n        let btnGetBox1 = this.getNodeByPath(\"ui/info/itemLayer/btnBox1/btnGetBox1\");\r\n        let hasGet1 = this.getNodeByPath(\"ui/info/itemLayer/btnBox1/hasGet\");\r\n        btnGetBox1.active = false;\r\n        hasGet1.active = false;\r\n        if (playerModel.vipObj.onceObj[this.choseVip]) {\r\n            // 已领取首次奖励\r\n            hasGet1.active = true;\r\n        } else if (this.choseVip <= vip) {\r\n            btnGetBox1.active = true;\r\n        }\r\n\r\n        let btnGetBox2 = this.getNodeByPath(\"ui/info/itemLayer/btnBox2/btnGetBox2\");\r\n        let hasGet2 = this.getNodeByPath(\"ui/info/itemLayer/btnBox2/hasGet\");\r\n        btnGetBox2.active = false;\r\n        hasGet2.active = false;\r\n        if (this.choseVip == vip) {\r\n            if (playerModel.vipObj.dayAward) {\r\n                hasGet2.active = true;\r\n            } else {\r\n                btnGetBox2.active = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    processEvent(ac: any, data: any) {\r\n        switch (ac) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onButtonClick(node: Node, name: string) {\r\n        switch (name) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onClickBtnGetBox1() {\r\n        if (this.choseVip > playerModel.vipObj.vip) {\r\n            return;\r\n        }\r\n        if (playerModel.vipObj.onceObj[this.choseVip]) {\r\n            // 已领取\r\n            return;\r\n        }\r\n        let row = designManager.getRowById(constants.tableName.vip, this.choseVip);\r\n        let awardArr = UserData.getInstance().addPropArrByDesign(row.award);\r\n        this.openAwardGetLayer(awardArr);\r\n        playerModel.vipObj.onceObj[this.choseVip] = 1;\r\n        this.initUI();\r\n        eventManager.send(msgac.refreshRedPoint);\r\n    }\r\n\r\n    onClickBtnGetBox2() {\r\n        if (this.choseVip > playerModel.vipObj.vip) {\r\n            return;\r\n        }\r\n        if (playerModel.vipObj.dayAward) {\r\n            // 已领取\r\n            return;\r\n        }\r\n        let row = designManager.getRowById(constants.tableName.vip, this.choseVip);\r\n        let awardArr = UserData.getInstance().addPropArrByDesign(row.dayAward);\r\n        this.openAwardGetLayer(awardArr);\r\n        playerModel.vipObj.dayAward = 1;\r\n        this.initUI();\r\n        eventManager.send(msgac.refreshRedPoint);\r\n    }\r\n\r\n    onClickBtnLeft() {\r\n        if (this.choseVip <= 1) {\r\n            return;\r\n        }\r\n        this.choseVip--;\r\n        this.initUI();\r\n    }\r\n\r\n    onClickBtnRight() {\r\n        let row = designManager.getRowById(constants.tableName.vip, this.choseVip + 1);\r\n        if (!row) {\r\n            return;\r\n        }\r\n        this.choseVip++;\r\n        this.initUI();\r\n    }\r\n\r\n    onClickBtnBox1() {\r\n        if (!playerModel.vipObj.onceObj[this.choseVip]) {\r\n            this.onClickBtnGetBox1();\r\n            return;\r\n        }\r\n        let row = designManager.getRowById(constants.tableName.vip, this.choseVip);\r\n        this.openAwardInfoLayer(row.award);\r\n    }\r\n\r\n    onClickBtnBox2() {\r\n        if (!playerModel.vipObj.dayAward) {\r\n            this.onClickBtnGetBox2();\r\n            return;\r\n        }\r\n        let row = designManager.getRowById(constants.tableName.vip, this.choseVip);\r\n        this.openAwardInfoLayer(row.dayAward);\r\n    }\r\n\r\n    onClickBtnGet() {\r\n        sdkManager.openAd(\"VIP特权\", (st: number) => {\r\n            if (st == 1) {\r\n                let hasUp = playerModel.addVipAdNum();\r\n                if (hasUp) {\r\n                    this.choseVip = playerModel.vipObj.vip;\r\n                }\r\n                this.initUI();\r\n                eventManager.send(msgac.refreshRedPoint);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n\r\n"]}