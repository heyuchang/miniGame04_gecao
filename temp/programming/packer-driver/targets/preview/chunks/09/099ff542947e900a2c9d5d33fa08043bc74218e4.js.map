{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/LuckyDrawLayer.ts"],"names":["find","macro","sp","tween","Tween","UIOpacity","UITransform","v3","_decorator","cocosUtil","utilTools","constants","localText","msgac","designManager","mapModel","AnimationCtrl","BaseLayer","ccclass","property","LuckyDrawLayer","uiNode","itemLayer","circleNodeNum","choseNum","choseArr","starShineArr","starShineIndex","showChoseIndex","showChoseItemUI","startCircle","circleEnd","btnStart","hintNode","coinLayer","coinNumNode","coinNum","resultUILayer","resultBgNode","resultItemLayer","resultItemNode","resultBtnSure","pdNode","fireNode","onLoad","getNodeByPath","itemNode","children","parent","arr","x","y","lastItemNode","i","length","info","k","node","instantiate","pos","getPosition","position","isShowBannerAd","onEnable","addEventArr","mapLeave","onDisable","removeEventArr","initUI","active","setString","initItemArr","tweenScaleIn","showArr","Math","random","forceChoseArr","forArr","weaponSystem","weaponArr","item","name","tableName","weapon","row","getRowById","id","lv","design","maxLv","temp","copyObj","push","skillSystem","skillArr","skill","skill2Arr","skill2","concat","getRandomItemByArr","prop","propIds","coin","num","floor","randomArr","itemUI","index","getRowByItem","uiIndex","setSpriteFrame","icon","scheduleOnce","startAnimation","waterfall","result","cb","circleShineAnimation","totalShineAnimation","choseNumAnimation","unscheduleAllCallbacks","to","scale","union","repeatForever","start","schedule","REPEAT_FOREVER","getComponent","delay","opacity","startShineStarCircle","posArr","skinName","Skeleton","setSkin","aniCtrl","addComponentOnce","playAnimationOnce","chs","initStarShineItemUI","addNextStarShine","startShowChoseItem","uiOpacity","starNode","angle","animationCtrl","playAnimation","dt","unschedule","playerAddItem","call","showChoseResult","outItemUI","shift","shineNode","addWeapon","type","getWeaponInfoByType","addSkill","getSkillInfoByType","addSkill2","getSkill2InfoByType","propSystem","getProp","forEach","removeAllChildren","tweenFadeIn","itemTransform","itemHeight","height","itemGap","convertToWorldSpace","convertToNodeSpace","targetPos","refreshResultItemUI","tweenScaleIn2","tweenFadeOut","coinGetHint","format","starLayer","setNumItemLayer","iconNode","icon2Node","yinNode","endCb","stopAllByTarget","time","repeat","count","opacityTime","delayTime","sideNode","sideShineNode","sideOpacity","mapLeaveRet","closeLayer","processEvent","ac","data","onClickBtnStart","onButtonClick","onClickBg","layerCb","onClickBtnSure"],"mappings":"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","sourcesContent":["import { find, macro, Node, sp, tween, Tween, UIOpacity, UITransform, v3, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { utilTools } from '../../../utils/utilTools';\r\nimport { constants } from '../../data/constants';\r\nimport { localText } from '../../data/localText';\r\nimport { msgac } from '../../data/msgac';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { mapModel } from '../../model/mapModel';\r\nimport { AnimationCtrl } from '../base/AnimationCtrl';\r\nimport { BaseLayer } from '../base/BaseLayer';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('LuckyDrawLayer')\r\nexport class LuckyDrawLayer extends BaseLayer {\r\n\r\n    uiNode: Node;\r\n\r\n    itemLayer: Node;\r\n    circleNodeNum: number = 16;\r\n\r\n    choseNum: number = 0;\r\n    choseArr: any = [];\r\n\r\n    starShineArr: any = [];\r\n    starShineIndex: number = 0;\r\n    showChoseIndex: number = 0;\r\n    showChoseItemUI: Node;\r\n\r\n    startCircle: boolean = false;\r\n    circleEnd: boolean = false;\r\n    btnStart: Node;\r\n    hintNode: Node;\r\n    coinLayer: Node;\r\n    coinNumNode: Node;\r\n    coinNum: number = 0;\r\n\r\n    resultUILayer: Node;\r\n    resultBgNode: Node;\r\n    resultItemLayer: Node;\r\n    resultItemNode: Node;\r\n    resultBtnSure: Node;\r\n\r\n    // 一些特效\r\n    pdNode: Node;\r\n    fireNode: Node;\r\n\r\n    onLoad() {\r\n        super.onLoad();\r\n\r\n        this.uiNode = this.getNodeByPath(\"ui\");\r\n\r\n        this.btnStart = this.getNodeByPath(\"ui/btnStart\");\r\n        this.hintNode = this.getNodeByPath(\"ui/hint\");\r\n\r\n        this.itemLayer = this.getNodeByPath(\"ui/itemLayer\");\r\n        let itemNode = this.itemLayer.children[0];\r\n        itemNode.parent = null;\r\n        let arr = [\r\n            { x: 0, y: 100 },\r\n            { x: 100, y: 0 },\r\n            { x: 0, y: -100 },\r\n            { x: -100, y: 0 },\r\n        ];\r\n        let lastItemNode = itemNode;\r\n        for (let i = 0; i < arr.length; i++) {\r\n            let info = arr[i];\r\n            for (let k = 1; k <= 4; k++) {\r\n                let node = cocosUtil.instantiate(itemNode);\r\n                node.parent = this.itemLayer;\r\n                let pos = lastItemNode.getPosition();\r\n                pos.x += info.x;\r\n                pos.y += info.y;\r\n                node.position = pos;\r\n                lastItemNode = node;\r\n            }\r\n        }\r\n\r\n        this.coinLayer = this.getNodeByPath(\"ui/coinLayer\");\r\n        this.coinNumNode = this.getNodeByPath(\"ui/coinLayer/num\");\r\n\r\n        this.pdNode = this.getNodeByPath(\"pd\");\r\n        this.fireNode = this.getNodeByPath(\"fire\");\r\n\r\n        this.resultUILayer = this.getNodeByPath(\"resultUi\");\r\n        this.resultBgNode = this.getNodeByPath(\"resultUi/resultBg\");\r\n        this.resultItemLayer = this.getNodeByPath(\"resultUi/itemLayer\");\r\n        this.resultItemNode = this.resultItemLayer.children[0];\r\n        this.resultItemNode.parent = null;\r\n        this.resultBtnSure = this.getNodeByPath(\"resultUi/btnSure\");\r\n\r\n        this.isShowBannerAd = true;\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n\r\n        this.addEventArr([\r\n            msgac.mapLeave,\r\n        ]);\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n\r\n        this.removeEventArr([\r\n            msgac.mapLeave,\r\n        ]);\r\n    }\r\n\r\n    initUI() {\r\n        this.resultUILayer.active = false;\r\n        this.pdNode.active = false;\r\n        this.fireNode.active = false;\r\n        this.hintNode.active = false;\r\n        this.setString(this.coinNumNode, this.coinNum);\r\n\r\n        this.initItemArr();\r\n        this.btnStart.active = false;\r\n        cocosUtil.tweenScaleIn(this.uiNode, 0.3, () => {\r\n            this.btnStart.active = true;\r\n            cocosUtil.tweenScaleIn(this.btnStart);\r\n        });\r\n    }\r\n\r\n    initItemArr() {\r\n        // 转盘上显示的\r\n        let showArr = [];\r\n        // 最终随机到的\r\n        this.choseArr = [];\r\n        // 选择的个数\r\n        this.choseNum = Math.random() > 0.5 ? 3 : 5;\r\n\r\n        // 随机池子\r\n        let arr = [];\r\n        // 强制选择\r\n        let forceChoseArr = [];\r\n\r\n        // 武器\r\n        utilTools.forArr(mapModel.weaponSystem.weaponArr, (info: any) => {\r\n            let item: any = {};\r\n            item.name = constants.tableName.weapon;\r\n            item.info = info;\r\n            let row = designManager.getRowById(item.name, info.id);\r\n            if (row.lv == constants.design.maxLv - 1) {\r\n                // 4级必选中\r\n                let temp = utilTools.copyObj(item);\r\n                temp.info.id++;\r\n                forceChoseArr.push(temp);\r\n                return;\r\n            }\r\n            let lv = row.lv;\r\n            while (lv < constants.design.maxLv) {\r\n                let temp = utilTools.copyObj(item);\r\n                arr.push(temp);\r\n                lv++;\r\n            }\r\n        });\r\n\r\n        // 主动技能\r\n        utilTools.forArr(mapModel.skillSystem.skillArr, (info: any) => {\r\n            let item: any = {};\r\n            item.name = constants.tableName.skill;\r\n            item.info = info;\r\n            let row = designManager.getRowById(item.name, info.id);\r\n            if (row.lv == constants.design.maxLv - 1) {\r\n                // 4级必选中\r\n                let temp = utilTools.copyObj(item);\r\n                temp.info.id++;\r\n                forceChoseArr.push(temp);\r\n                return;\r\n            }\r\n            let lv = row.lv;\r\n            while (lv < constants.design.maxLv) {\r\n                let temp = utilTools.copyObj(item);\r\n                arr.push(temp);\r\n                lv++;\r\n            }\r\n        });\r\n\r\n        // 被动技能\r\n        utilTools.forArr(mapModel.skillSystem.skill2Arr, (info: any) => {\r\n            let item: any = {};\r\n            item.name = constants.tableName.skill2;\r\n            item.info = info;\r\n            let row = designManager.getRowById(item.name, info.id);\r\n            if (row.lv == constants.design.maxLv - 1) {\r\n                // 4级必选中\r\n                let temp = utilTools.copyObj(item);\r\n                temp.info.id++;\r\n                forceChoseArr.push(temp);\r\n                return;\r\n            }\r\n            let lv = row.lv;\r\n            while (lv < constants.design.maxLv) {\r\n                let temp = utilTools.copyObj(item);\r\n                arr.push(temp);\r\n                lv++;\r\n            }\r\n        });\r\n\r\n        showArr = showArr.concat(forceChoseArr);\r\n\r\n        // 处理强制选择的\r\n        while (forceChoseArr.length > this.choseNum) {\r\n            // 超过选择的数量要移除\r\n            utilTools.getRandomItemByArr(forceChoseArr, true);\r\n        }\r\n        this.choseArr = this.choseArr.concat(forceChoseArr);\r\n\r\n        // 随机池子补满金币\r\n        while (arr.length < this.circleNodeNum - showArr.length) {\r\n            let item: any = {};\r\n            item.name = constants.tableName.prop;\r\n            item.id = constants.propIds.coin;\r\n            item.num = Math.floor(Math.random() * 100) + 1;\r\n            arr.push(item);\r\n        }\r\n\r\n        // 接下来从池子中随机\r\n        while (this.choseArr.length < this.choseNum) {\r\n            let item = utilTools.getRandomItemByArr(arr, true);\r\n            if (!item) {\r\n                break;\r\n            }\r\n            this.choseArr.push(item);\r\n            showArr.push(item);\r\n        }\r\n\r\n        // 补满转盘\r\n        while (showArr.length < this.circleNodeNum) {\r\n            let item = utilTools.getRandomItemByArr(arr, true);\r\n            if (!item) {\r\n                break;\r\n            }\r\n            showArr.push(item);\r\n        }\r\n\r\n        // 随机打乱\r\n        showArr = utilTools.randomArr(showArr, true);\r\n        this.choseArr = utilTools.randomArr(this.choseArr, true);\r\n\r\n        utilTools.forArr(this.itemLayer.children, (itemUI: any, index: number) => {\r\n            let item = showArr[index];\r\n            let row = this.getRowByItem(item);\r\n            item.uiIndex = index;\r\n            itemUI.item = item;\r\n            this.setSpriteFrame(find(\"icon\", itemUI), row.icon);\r\n            find(\"shine\", itemUI).active = false;\r\n            find(\"star\", itemUI).active = false;\r\n            find(\"chose\", itemUI).active = false;\r\n\r\n            // 出场动画\r\n            itemUI.active = false;\r\n            this.scheduleOnce(() => {\r\n                itemUI.active = true;\r\n                cocosUtil.tweenScaleIn(itemUI);\r\n            }, 0.2 + Math.random() * 0.2);\r\n        });\r\n\r\n        // myLog.i(showArr, this.choseArr);\r\n\r\n    }\r\n\r\n    getRowByItem(item: any) {\r\n        let row = null;\r\n        switch (item.name) {\r\n            case constants.tableName.weapon:\r\n            case constants.tableName.skill:\r\n            case constants.tableName.skill2:\r\n                row = designManager.getRowById(item.name, item.info.id);\r\n                break;\r\n            case constants.tableName.prop:\r\n                row = designManager.getRowById(item.name, item.id);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        return row;\r\n    }\r\n\r\n    // 开始处理动画表现\r\n    startAnimation() {\r\n        utilTools.waterfall([\r\n            (result: any, cb: Function) => {\r\n                // 转一圈\r\n                this.circleShineAnimation(() => {\r\n                    cb();\r\n                });\r\n            },\r\n            (result: any, cb: Function) => {\r\n                // 转第二圈\r\n                this.circleShineAnimation(() => {\r\n                    cb();\r\n                });\r\n            },\r\n            (result: any, cb: Function) => {\r\n                // 整圈闪烁\r\n                this.totalShineAnimation(() => {\r\n                    cb();\r\n                });\r\n            },\r\n            (result: any, cb: Function) => {\r\n                // 选择数量闪烁\r\n                this.choseNumAnimation(() => {\r\n                    cb();\r\n                });\r\n            },\r\n            (result: any, cb: Function) => {\r\n                this.unscheduleAllCallbacks();\r\n                this.pdNode.active = true;\r\n                this.startCircle = true;\r\n                tween(this.coinLayer).to(0.2, { scale: v3(1.1, 1.1, 1) }).to(0.2, { scale: v3(1, 1, 1) }).union().repeatForever().start();\r\n                // 加金币\r\n                this.schedule(() => {\r\n                    if (this.startCircle && !this.circleEnd) {\r\n                        this.coinNum += 2;\r\n                        this.setString(this.coinNumNode, this.coinNum);\r\n                    }\r\n                }, 0.02, macro.REPEAT_FOREVER);\r\n                // 提示跳过动画\r\n                this.scheduleOnce(() => {\r\n                    this.hintNode.active = true;\r\n                    tween(this.hintNode.getComponent(UIOpacity)).delay(0.5).to(0.5, { opacity: 0 }).to(0.5, { opacity: 255 }).union().repeatForever().start();\r\n                }, 0.5);\r\n                // 开始转圈\r\n                this.startShineStarCircle();\r\n            }\r\n        ]);\r\n\r\n        // 放烟花\r\n        let posArr = [\r\n            v3(-100, 200, 0),\r\n            v3(0, -100, 0),\r\n            v3(150, -250, 0),\r\n            v3(300, -500, 0),\r\n            v3(100, -450, 0),\r\n        ];\r\n\r\n        cocosUtil.schedule(this, () => {\r\n            if (posArr.length <= 0) {\r\n                return;\r\n            }\r\n            let skinName = Math.random() > 0.5 ? \"huang\" : \"lan\";\r\n            let scale = 0.8 + Math.random() * 0.2;\r\n            let pos = utilTools.getRandomItemByArr(posArr, true);\r\n            let fireNode = cocosUtil.instantiate(this.fireNode);\r\n            fireNode.parent = this.fireNode.parent;\r\n            fireNode.active = true;\r\n            fireNode.position = pos;\r\n            fireNode.scale = v3(scale, scale, 1);\r\n            fireNode.getComponent(sp.Skeleton).setSkin(skinName);\r\n            let aniCtrl: AnimationCtrl = cocosUtil.addComponentOnce(fireNode, AnimationCtrl);\r\n            aniCtrl.playAnimationOnce(\"animation\", () => {\r\n                fireNode.parent = null;\r\n            });\r\n        }, 1.5, macro.REPEAT_FOREVER, 0, true);\r\n\r\n    }\r\n\r\n    startShineStarCircle() {\r\n        let chs = this.itemLayer.children;\r\n        let index = 5;\r\n        this.starShineArr = [];\r\n        this.starShineIndex = index + this.choseNum - 1;\r\n        this.showChoseIndex = 0;\r\n        this.showChoseItemUI = null;\r\n\r\n        for (let i = 0; i < this.choseNum; i++) {\r\n            let itemUI = chs[index];\r\n            index++;\r\n            this.initStarShineItemUI(itemUI);\r\n            this.starShineArr.push(itemUI);\r\n        }\r\n        this.schedule(this.addNextStarShine, 0.05, macro.REPEAT_FOREVER);\r\n\r\n        this.scheduleOnce(this.startShowChoseItem, 3 + 2 * Math.random());\r\n    }\r\n\r\n    startShowChoseItem() {\r\n        let item = this.choseArr[this.showChoseIndex];\r\n        if (!item) {\r\n            return;\r\n        }\r\n        this.showChoseItemUI = this.itemLayer.children[item.uiIndex];\r\n        this.showChoseIndex++;\r\n    }\r\n\r\n    initStarShineItemUI(itemUI: Node) {\r\n        let uiOpacity = find(\"shine\", itemUI).getComponent(UIOpacity);\r\n        uiOpacity.node.active = true;\r\n        uiOpacity.opacity = 255;\r\n\r\n        let starNode = find(\"star\", itemUI);\r\n        starNode.angle = Math.random() * 360;\r\n        let animationCtrl: AnimationCtrl = cocosUtil.addComponentOnce(starNode, AnimationCtrl);\r\n        animationCtrl.getComponent(UIOpacity).opacity = 255;\r\n        animationCtrl.node.active = true;\r\n        animationCtrl.playAnimation(\"3\", false, () => {\r\n            animationCtrl.node.active = false;\r\n        });\r\n    }\r\n\r\n    addNextStarShine(dt: number) {\r\n        let chs = this.itemLayer.children;\r\n        this.starShineIndex++;\r\n        if (this.starShineIndex >= this.circleNodeNum) {\r\n            this.starShineIndex = 0;\r\n        }\r\n        let itemUI = chs[this.starShineIndex];\r\n        if (this.showChoseItemUI == itemUI) {\r\n            // 选中了\r\n            this.showChoseItemUI = null;\r\n            this.unschedule(this.addNextStarShine);\r\n            find(\"chose\", itemUI).active = true;\r\n            let starNode = find(\"star\", itemUI);\r\n            starNode.active = true;\r\n            starNode.angle = 0;\r\n            starNode.getComponent(UIOpacity).opacity = 255;\r\n            let animationCtrl: AnimationCtrl = cocosUtil.addComponentOnce(starNode, AnimationCtrl);\r\n            animationCtrl.playAnimation(\"2\", false, () => {\r\n                starNode.active = false;\r\n            });\r\n            // @ts-ignore\r\n            this.playerAddItem(itemUI.item);\r\n            tween(itemUI).to(0.2, { scale: v3(1.5, 1.5, 1) }).to(0.2, { scale: v3(1, 1, 1) }).call(() => {\r\n                if (this.showChoseIndex >= this.choseArr.length) {\r\n                    // 已经全部完成\r\n                    this.showChoseResult();\r\n                } else {\r\n                    // 继续展示下一个\r\n                    this.schedule(this.addNextStarShine, 0.05, macro.REPEAT_FOREVER);\r\n                    this.startShowChoseItem();\r\n                }\r\n            }).start();\r\n            return;\r\n        }\r\n        this.initStarShineItemUI(itemUI);\r\n        this.starShineArr.push(itemUI);\r\n        let outItemUI = this.starShineArr.shift();\r\n        let shineNode = find(\"shine\", outItemUI);\r\n        tween(shineNode.getComponent(UIOpacity)).to(dt * 6, { opacity: 0 }).start();\r\n    }\r\n\r\n    playerAddItem(item: any) {\r\n        let row = this.getRowByItem(item);\r\n        switch (item.name) {\r\n            case constants.tableName.weapon:\r\n                mapModel.weaponSystem.addWeapon(row.type);\r\n                item.info = utilTools.copyObj(mapModel.weaponSystem.getWeaponInfoByType(row.type));\r\n                break;\r\n            case constants.tableName.skill:\r\n                mapModel.skillSystem.addSkill(row.type);\r\n                item.info = utilTools.copyObj(mapModel.skillSystem.getSkillInfoByType(row.type));\r\n                break;\r\n            case constants.tableName.skill2:\r\n                mapModel.skillSystem.addSkill2(row.type);\r\n                item.info = utilTools.copyObj(mapModel.skillSystem.getSkill2InfoByType(row.type));\r\n                break;\r\n            case constants.tableName.prop:\r\n                mapModel.propSystem.getProp(item.id, item.num);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    // 已全部完成\r\n    async showChoseResult() {\r\n        this.unscheduleAllCallbacks();\r\n        this.circleEnd = true;\r\n        mapModel.propSystem.getProp(constants.propIds.coin, this.coinNum);\r\n\r\n        this.itemLayer.children.forEach((itemUI: Node) => {\r\n            find(\"shine\", itemUI).active = false;\r\n            find(\"star\", itemUI).active = false;\r\n        });\r\n\r\n        this.resultUILayer.active = true;\r\n        this.resultBtnSure.active = false;\r\n        this.resultItemLayer.removeAllChildren();\r\n        await cocosUtil.tweenFadeIn(this.resultBgNode, 0.5);\r\n\r\n        let itemTransform = this.resultItemNode.getComponent(UITransform);\r\n        let itemHeight = itemTransform.height;\r\n        let itemGap = 20;\r\n\r\n        let chs = this.itemLayer.children;\r\n        for (let i = 0; i < this.choseArr.length; i++) {\r\n            let item = this.choseArr[i];\r\n            this.scheduleOnce(() => {\r\n                let node = chs[item.uiIndex];\r\n                let pos = cocosUtil.convertToWorldSpace(node);\r\n                node = cocosUtil.instantiate(node);\r\n                node.parent = this.resultItemLayer;\r\n                node.position = cocosUtil.convertToNodeSpace(node, pos);\r\n                let targetPos = v3(0, 0, 0);\r\n                targetPos.y = -itemHeight * 0.5 - (itemHeight + itemGap) * i;\r\n                tween(node).to(0.2, { position: targetPos }).to(0.1, { scale: v3(0.3, 0.3, 1) }).call(() => {\r\n                    let itemUI = cocosUtil.instantiate(this.resultItemNode);\r\n                    itemUI.parent = this.resultItemLayer;\r\n                    itemUI.position = targetPos;\r\n                    this.refreshResultItemUI(itemUI, item);\r\n                    let shineNode = find(\"shine\", itemUI);\r\n                    shineNode.active = true;\r\n                    cocosUtil.tweenScaleIn2(itemUI, 0.2, () => {\r\n                        cocosUtil.tweenFadeOut(shineNode, 0.6);\r\n                        if (i == this.choseArr.length - 1) {\r\n                            this.resultBtnSure.active = true;\r\n                            cocosUtil.tweenScaleIn2(this.resultBtnSure);\r\n                        }\r\n                    });\r\n                }).start();\r\n            }, i * 0.3);\r\n        }\r\n    }\r\n\r\n    refreshResultItemUI(itemUI: Node, item: any) {\r\n        let row = this.getRowByItem(item);\r\n        this.setSpriteFrame(find(\"icon\", itemUI), row.icon);\r\n        this.setString(find(\"name\", itemUI), row.name);\r\n\r\n        let info = row.info;\r\n        if (item.name == constants.tableName.prop) {\r\n            info = localText.coinGetHint.format(item.num);\r\n        }\r\n        this.setString(find(\"info\", itemUI), info);\r\n\r\n        let starLayer = find(\"starLayer\", itemUI);\r\n        if (item.name == constants.tableName.prop) {\r\n            starLayer.active = false;\r\n            return;\r\n        }\r\n        starLayer.active = true;\r\n        this.setNumItemLayer(starLayer, constants.design.maxLv, (starNode: Node, num: number) => {\r\n            let iconNode = find(\"icon\", starNode);\r\n            let icon2Node = find(\"icon2\", starNode);\r\n            let yinNode = find(\"yin\", starNode);\r\n            if (row.lv >= num) {\r\n                iconNode.active = true;\r\n                icon2Node.active = false;\r\n                yinNode.active = false;\r\n                if (row.lv >= constants.design.maxLv) {\r\n                    iconNode.active = false;\r\n                    icon2Node.active = true;\r\n                }\r\n            } else {\r\n                iconNode.active = false;\r\n                yinNode.active = true;\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    choseNumAnimation(endCb: Function) {\r\n        let chs = this.itemLayer.children;\r\n        let index = 5;\r\n        let arr = [];\r\n        for (let i = 0; i < this.choseNum; i++) {\r\n            let itemUI = chs[index];\r\n            arr.push(itemUI);\r\n            index++;\r\n            this.scheduleOnce(() => {\r\n                let uiOpacity = find(\"shine\", itemUI).getComponent(UIOpacity);\r\n                uiOpacity.node.active = true;\r\n                uiOpacity.opacity = 0;\r\n                tween(uiOpacity).to(0.1, { opacity: 255 }).delay(0.15).to(0.1, { opacity: 0 }).union().repeatForever().start();\r\n                if (i == this.choseNum - 1) {\r\n                    this.scheduleOnce(() => {\r\n                        utilTools.forArr(arr, (node: Node) => {\r\n                            find(\"shine\", node).active = false;\r\n                            Tween.stopAllByTarget(find(\"shine\", node).getComponent(UIOpacity));\r\n                        });\r\n                        endCb();\r\n                    }, 0.35);\r\n                }\r\n            }, i * 0.35);\r\n        }\r\n    }\r\n\r\n    totalShineAnimation(endCb: Function) {\r\n        let time = 0.3;\r\n        utilTools.forArr(this.itemLayer.children, (itemUI: Node, index: number) => {\r\n            let uiOpacity = find(\"shine\", itemUI).getComponent(UIOpacity);\r\n            uiOpacity.node.active = true;\r\n            uiOpacity.opacity = 0;\r\n            tween(uiOpacity).to(time, { opacity: 255 }).to(time, { opacity: 0 }).union().repeat(3).call(() => {\r\n                if (index == 0) {\r\n                    endCb();\r\n                }\r\n            }).start()\r\n        });\r\n    }\r\n\r\n    circleShineAnimation(endCb?: Function) {\r\n        let chs = this.itemLayer.children;\r\n        let count = 0;\r\n        let opacityTime = 0.1;\r\n        let delayTime = 0.5;\r\n        for (let i = 13; i >= 5; i--) {\r\n            let node = chs[i];\r\n            let time = count * 0.05;\r\n\r\n            let shineNode = find(\"shine\", node);\r\n            shineNode.active = true;\r\n            let uiOpacity = shineNode.getComponent(UIOpacity);\r\n            uiOpacity.opacity = 0;\r\n            this.scheduleOnce(() => {\r\n                tween(uiOpacity).to(opacityTime, { opacity: 255 }).delay(delayTime).to(opacityTime, { opacity: 0 }).call(() => {\r\n                    if (i == 5) {\r\n                        endCb();\r\n                    }\r\n                }).start();\r\n            }, time);\r\n\r\n            if (i != 13 && i != 5) {\r\n                let sideNode = chs[(26 - i) % this.circleNodeNum];\r\n                let sideShineNode = find(\"shine\", sideNode);\r\n                sideShineNode.active = true;\r\n                let sideOpacity = sideShineNode.getComponent(UIOpacity);\r\n                sideOpacity.opacity = 0;\r\n                this.scheduleOnce(() => {\r\n                    tween(sideOpacity).to(opacityTime, { opacity: 255 }).delay(delayTime).to(opacityTime, { opacity: 0 }).start();\r\n                }, time);\r\n            }\r\n            count++;\r\n        }\r\n    }\r\n\r\n    mapLeaveRet() {\r\n        this.closeLayer();\r\n    }\r\n\r\n    processEvent(ac: any, data: any) {\r\n        switch (ac) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onClickBtnStart() {\r\n        this.btnStart.active = false;\r\n        this.startAnimation();\r\n    }\r\n\r\n    onButtonClick(node: Node, name: string) {\r\n        switch (name) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onClickBg() {\r\n        if (!this.hintNode.active) {\r\n            return;\r\n        }\r\n        this.hintNode.active = false;\r\n        if (this.showChoseIndex >= 1) {\r\n            return;\r\n        }\r\n        this.circleEnd = true;\r\n        // 一次性给金币\r\n        let coin = 300;\r\n        if (this.choseNum >= 3) {\r\n            coin = 450;\r\n        }\r\n        coin = coin + 100 * Math.random();\r\n        coin = Math.floor(coin);\r\n        if (coin <= this.coinNum) {\r\n            coin = coin + 50 * Math.random();\r\n            coin = Math.floor(coin);\r\n        }\r\n        this.coinNum = coin;\r\n        this.setString(this.coinNumNode, this.coinNum);\r\n\r\n        this.unschedule(this.startShowChoseItem);\r\n        this.startShowChoseItem();\r\n    }\r\n\r\n    closeLayer() {\r\n        super.closeLayer();\r\n        if (this.layerCb) {\r\n            this.layerCb();\r\n        }\r\n    }\r\n\r\n    onClickBtnSure() {\r\n        this.closeLayer();\r\n    }\r\n\r\n}\r\n\r\n"]}