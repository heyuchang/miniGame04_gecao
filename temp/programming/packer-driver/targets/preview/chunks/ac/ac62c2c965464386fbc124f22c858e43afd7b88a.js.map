{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/bullet/Bullet5.ts"],"names":["Component","macro","tween","UIOpacity","v3","Vec3","_decorator","cocosUtil","mapModel","physicsGroup","ccclass","property","bullet5","bullet","contactNotHide","moveStop","direction1","direction2","bulletId","turnSpeed","Math","PI","init","node","setScale","uiOpacity","getComponent","opacity","dx","direction","x","by","position","easing","call","player","getPosition","subtract","normalize","tweenBlink","schedule","createSmallBullet","REPEAT_FOREVER","start","scheduleOnce","unschedule","tweenScaleOut","recycleSelf","dt","radian","startPos","convertToWorldSpace","rotateZ","ZERO","bulletSystem","addBullet","MONSTER_BULLET"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,U,OAAAA,U;;AAC9CC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U,GAE9B;;yBAEaM,O,WADZF,OAAO,CAAC,SAAD,C,gBAAR,MACaE,OADb,SAC6BZ,SAD7B,CACuC;AAAA;AAAA;AAAA,eAEnCa,MAFmC;AAAA,eAGnCC,cAHmC,GAGT,IAHS;AAAA,eAInCC,QAJmC,GAIf,KAJe;AAAA,eAMnCC,UANmC;AAAA,eAOnCC,UAPmC;AAAA,eASnCC,QATmC,GASxB,IATwB;AAAA,eAWnCC,SAXmC,GAWfC,IAAI,CAACC,EAAL,GAAU,CAXK;AAAA;;AAanCC,QAAAA,IAAI,CAACT,MAAD,EAAiB;AACjB,eAAKA,MAAL,GAAcA,MAAd;AAEA,eAAKA,MAAL,CAAYU,IAAZ,CAAiBC,QAAjB,CAA0BpB,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAA5B;AACA,cAAIqB,SAAS,GAAG,KAAKZ,MAAL,CAAYa,YAAZ,CAAyBvB,SAAzB,CAAhB;;AACA,cAAIsB,SAAJ,EAAe;AACXA,YAAAA,SAAS,CAACE,OAAV,GAAoB,GAApB;AACH;;AACD,eAAKZ,QAAL,GAAgB,IAAhB;AAEA,cAAIa,EAAE,GAAG,GAAT;;AACA,cAAI,KAAKf,MAAL,CAAYgB,SAAZ,CAAsBC,CAAtB,GAA0B,CAA9B,EAAiC;AAC7BF,YAAAA,EAAE,GAAG,CAACA,EAAN;AACH;;AACD1B,UAAAA,KAAK,CAAC,KAAKW,MAAL,CAAYU,IAAb,CAAL,CAAwBQ,EAAxB,CAA2B,GAA3B,EAAgC;AAAEC,YAAAA,QAAQ,EAAE5B,EAAE,CAACwB,EAAD,EAAK,CAAL,EAAQ,CAAR;AAAd,WAAhC,EAA4D;AAAEK,YAAAA,MAAM,EAAE;AAAV,WAA5D,EAAmFC,IAAnF,CAAwF,MAAM;AAC1F,iBAAKnB,QAAL,GAAgB,KAAhB;AACA,iBAAKF,MAAL,CAAYgB,SAAZ,GAAwB;AAAA;AAAA,sCAASM,MAAT,CAAgBZ,IAAhB,CAAqBa,WAArB,GAAmCC,QAAnC,CAA4C,KAAKxB,MAAL,CAAYU,IAAZ,CAAiBa,WAAjB,EAA5C,EAA4EE,SAA5E,EAAxB;AACA;AAAA;AAAA,wCAAUC,UAAV,CAAqB,KAAK1B,MAAL,CAAYU,IAAjC,EAAuC,GAAvC,EAH0F,CAI1F;;AACA,iBAAKP,UAAL,GAAkBZ,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAApB;AACA,iBAAKa,UAAL,GAAkBb,EAAE,CAAC,CAAD,EAAI,CAAC,CAAL,EAAQ,CAAR,CAApB;AACA,iBAAKoC,QAAL,CAAc,KAAKC,iBAAnB,EAAsC,GAAtC,EAA2CxC,KAAK,CAACyC,cAAjD;AACH,WARD,EAQGC,KARH;AAUA,eAAKC,YAAL,CAAkB,MAAM;AACpB,iBAAKC,UAAL,CAAgB,KAAKJ,iBAArB;AACA;AAAA;AAAA,wCAAUK,aAAV,CAAwB,KAAKjC,MAAL,CAAYU,IAApC,EAA0C,GAA1C,EAA+C,MAAM;AACjD,mBAAKV,MAAL,CAAYkC,WAAZ;AACH,aAFD;AAGH,WALD,EAKG,CALH;AAOH;;AAEDN,QAAAA,iBAAiB,CAACO,EAAD,EAAa;AAC1B,cAAIC,MAAM,GAAGD,EAAE,GAAG,KAAK7B,SAAvB;AACA,cAAI+B,QAAQ,GAAG;AAAA;AAAA,sCAAUC,mBAAV,CAA8B,KAAKtC,MAAL,CAAYU,IAA1C,CAAf;AACAlB,UAAAA,IAAI,CAAC+C,OAAL,CAAa,KAAKpC,UAAlB,EAA8B,KAAKA,UAAnC,EAA+CX,IAAI,CAACgD,IAApD,EAA0DJ,MAA1D;AACA;AAAA;AAAA,oCAASK,YAAT,CAAsBC,SAAtB,CAAgC,KAAKrC,QAArC,EAA+C;AAAA;AAAA,4CAAasC,cAA5D,EAA4EN,QAA5E,EAAsF,KAAKlC,UAA3F;AAEAX,UAAAA,IAAI,CAAC+C,OAAL,CAAa,KAAKnC,UAAlB,EAA8B,KAAKA,UAAnC,EAA+CZ,IAAI,CAACgD,IAApD,EAA0DJ,MAA1D;AACA;AAAA;AAAA,oCAASK,YAAT,CAAsBC,SAAtB,CAAgC,KAAKrC,QAArC,EAA+C;AAAA;AAAA,4CAAasC,cAA5D,EAA4EN,QAA5E,EAAsF,KAAKjC,UAA3F;AACH;;AAtDkC,O","sourcesContent":["import { Component, macro, tween, UIOpacity, v3, Vec3, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { physicsGroup } from '../../../other/physicsGroup';\r\nimport { Bullet } from './Bullet';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 狙击手-大子弹\r\n@ccclass('bullet5')\r\nexport class bullet5 extends Component {\r\n\r\n    bullet: Bullet;\r\n    contactNotHide: boolean = true;\r\n    moveStop: boolean = false;\r\n\r\n    direction1: Vec3;\r\n    direction2: Vec3;\r\n\r\n    bulletId = 1005;\r\n    // 小子弹产生的角度转速\r\n    turnSpeed: number = Math.PI / 3;\r\n\r\n    init(bullet: Bullet) {\r\n        this.bullet = bullet;\r\n\r\n        this.bullet.node.setScale(v3(1, 1, 1));\r\n        let uiOpacity = this.bullet.getComponent(UIOpacity);\r\n        if (uiOpacity) {\r\n            uiOpacity.opacity = 255;\r\n        }\r\n        this.moveStop = true;\r\n\r\n        let dx = 200;\r\n        if (this.bullet.direction.x < 0) {\r\n            dx = -dx;\r\n        }\r\n        tween(this.bullet.node).by(0.3, { position: v3(dx, 0, 0) }, { easing: \"quadOut\" }).call(() => {\r\n            this.moveStop = false;\r\n            this.bullet.direction = mapModel.player.node.getPosition().subtract(this.bullet.node.getPosition()).normalize();\r\n            cocosUtil.tweenBlink(this.bullet.node, 0.5);\r\n            // 开始不断产生小子弹\r\n            this.direction1 = v3(0, 1, 0);\r\n            this.direction2 = v3(0, -1, 0);\r\n            this.schedule(this.createSmallBullet, 0.2, macro.REPEAT_FOREVER);\r\n        }).start();\r\n\r\n        this.scheduleOnce(() => {\r\n            this.unschedule(this.createSmallBullet);\r\n            cocosUtil.tweenScaleOut(this.bullet.node, 0.2, () => {\r\n                this.bullet.recycleSelf();\r\n            });\r\n        }, 6);\r\n\r\n    }\r\n\r\n    createSmallBullet(dt: number) {\r\n        let radian = dt * this.turnSpeed;\r\n        let startPos = cocosUtil.convertToWorldSpace(this.bullet.node);\r\n        Vec3.rotateZ(this.direction1, this.direction1, Vec3.ZERO, radian);\r\n        mapModel.bulletSystem.addBullet(this.bulletId, physicsGroup.MONSTER_BULLET, startPos, this.direction1);\r\n\r\n        Vec3.rotateZ(this.direction2, this.direction2, Vec3.ZERO, radian);\r\n        mapModel.bulletSystem.addBullet(this.bulletId, physicsGroup.MONSTER_BULLET, startPos, this.direction2);\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}