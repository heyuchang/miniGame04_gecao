{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/base/AnimationTrack.ts"],"names":["Component","tween","v3","Vec2","_decorator","Tween","cocosUtil","utilTools","mapModel","ccclass","property","AnimationTrack","duration","time","g","v","vx","vy","endY","aniFlag","targetPos","endCallback","startShowThrow","cb","stopAllByTarget","node","radian","getFloatValue","angleToRadian","Math","random","PI","cos","sin","position","y","startBeiSaiEr","convertToWorldSpace","mapLayer","coinIconNode","moveTargetUpdate","dt","convertToNodeSpace","playerPos","player","x","nodePos","getPosition","distance","direction","subtract","normalize","dis","multiplyScalar","add","showThrowUpdate","pos","setPosition","dy","dx","by","easing","delay","call","start","update"],"mappings":"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","sourcesContent":["import { Component, tween, v3, Vec2, Vec3, _decorator, Tween } from 'cc';\r\nimport { cocosUtil } from '../../../utils/cocosUtil';\r\nimport { utilTools } from '../../../utils/utilTools';\r\nimport { mapModel } from '../../model/mapModel';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AnimationTrack')\r\nexport class AnimationTrack extends Component {\r\n\r\n    duration: number = 0.6;\r\n    time: number = 0;\r\n\r\n    // 重力加速度\r\n    g: number = -2000;\r\n    // 初速度\r\n    v: number = 800;\r\n    vx: number = 0;\r\n    vy: number = 0;\r\n    endY: number = 0;\r\n\r\n    aniFlag: number = 0;\r\n\r\n    targetPos: Vec3;\r\n\r\n    endCallback: Function;\r\n\r\n    startShowThrow(cb?: Function) {\r\n        this.endCallback = cb;\r\n        this.aniFlag = 1;\r\n        Tween.stopAllByTarget(this.node);\r\n\r\n        // 抛出角度\r\n        let radian = utilTools.getFloatValue(utilTools.angleToRadian(75), utilTools.angleToRadian(85));\r\n        if (Math.random() > 0.5) {\r\n            radian = Math.PI - radian;\r\n        }\r\n\r\n        this.v = 800 + 200 * Math.random();\r\n        this.vx = this.v * Math.cos(radian);\r\n        this.vy = this.v * Math.sin(radian);\r\n\r\n        this.endY = this.node.position.y - 20 - 50 * Math.random();\r\n    }\r\n\r\n    startBeiSaiEr() {\r\n        this.aniFlag = 2;\r\n\r\n        this.targetPos = cocosUtil.convertToWorldSpace(mapModel.mapLayer.coinIconNode);\r\n    }\r\n\r\n    moveTargetUpdate(dt: number) {\r\n        let targetPos = cocosUtil.convertToNodeSpace(this.node, this.targetPos);\r\n        let playerPos = mapModel.player.node.position;\r\n        targetPos.x += playerPos.x;\r\n        targetPos.y += playerPos.y;\r\n        let nodePos = this.node.getPosition();\r\n        if (Vec2.distance(nodePos, targetPos) <= 20) {\r\n            if (this.endCallback) {\r\n                this.endCallback();\r\n            }\r\n            return;\r\n        }\r\n        let direction = targetPos.subtract(nodePos).normalize();\r\n        let dis = dt * 1500;\r\n        direction.multiplyScalar(dis);\r\n        nodePos.add(direction);\r\n        this.node.position = nodePos;\r\n    }\r\n\r\n    showThrowUpdate(dt: number) {\r\n        let pos = this.node.getPosition();\r\n        pos.x += this.vx * dt;\r\n        pos.y += this.vy * dt;\r\n        this.vy += this.g * dt;\r\n        this.node.setPosition(pos);\r\n        if (pos.y <= this.endY) {\r\n            this.aniFlag = 0;\r\n            let time = 0.1;\r\n            let dy = 40;\r\n            let dx = 15;\r\n            if (this.vx < 0) {\r\n                dx = -dx;\r\n            }\r\n            tween(this.node).by(time, { position: v3(dx, dy) }, { easing: \"quadOut\" })\r\n                .by(time, { position: v3(dx, -dy) }, { easing: \"quadIn\" })\r\n                .delay(0.5 + 0.3 * Math.random()).call(() => {\r\n                    this.startBeiSaiEr();\r\n                }).start();\r\n        }\r\n    }\r\n\r\n    update(dt: number) {\r\n        switch (this.aniFlag) {\r\n            case 1:\r\n                this.showThrowUpdate(dt);\r\n                break;\r\n            case 2:\r\n                this.moveTargetUpdate(dt);\r\n                break;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n"]}