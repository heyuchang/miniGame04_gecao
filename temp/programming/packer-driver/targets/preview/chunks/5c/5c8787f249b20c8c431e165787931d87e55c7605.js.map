{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/item/bullet/Bullet1091.ts"],"names":["Component","_decorator","cocosUtil","mapModel","ccclass","property","bullet1091","bullet","contactNotHide","outScreenNotRecycle","isOutScreenReflex","init","speed","skillSystem","getSkill2BulletSpeedAddPercent","atk","getSkill2AtkAddPercent","Math","floor","scheduleOnce","recycleSelf","extraObj","time","mirrorReflex","isX","force","direction","x","y","outScreenX","pos","playerPos","abs","visibleHalfSize","width","outScreenY","height","outWallX","mapSystem","wallLayer","active","wallRightVal","wallLeftVal","outWallY","wallTopVal","wallBottomVal","update","dt","player","node","getPosition","recycleSelfEnd","isValid","invokeClass","subNum"],"mappings":"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","sourcesContent":["import { Component, Vec3, _decorator } from 'cc';\r\nimport { cocosUtil } from '../../../../utils/cocosUtil';\r\nimport { mapModel } from '../../../model/mapModel';\r\nimport { Bullet } from './Bullet';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 技能-钻头\r\n@ccclass('bullet1091')\r\nexport class bullet1091 extends Component {\r\n\r\n    bullet: Bullet;\r\n    contactNotHide: boolean = true;\r\n\r\n    // 不可以自动销毁\r\n    outScreenNotRecycle: boolean = true;\r\n\r\n    isOutScreenReflex: boolean;\r\n\r\n\r\n    init(bullet: Bullet) {\r\n        this.bullet = bullet;\r\n        this.isOutScreenReflex = false;\r\n\r\n        this.bullet.speed = this.bullet.speed * (1 + mapModel.skillSystem.getSkill2BulletSpeedAddPercent());\r\n        let atk = this.bullet.atk * (1 + mapModel.skillSystem.getSkill2AtkAddPercent());\r\n        this.bullet.atk = Math.floor(atk);\r\n\r\n        this.scheduleOnce(() => {\r\n            this.bullet.recycleSelf();\r\n        }, this.bullet.extraObj.time);\r\n\r\n    }\r\n\r\n    mirrorReflex(isX: boolean, force: boolean = false) {\r\n        if (this.isOutScreenReflex && !force) {\r\n            return;\r\n        }\r\n        this.isOutScreenReflex = true;\r\n        // 碰到边缘，做镜面反射\r\n        if (isX) {\r\n            this.bullet.direction.x *= -1;\r\n            return;\r\n        }\r\n        this.bullet.direction.y *= -1;\r\n    }\r\n\r\n    outScreenX(pos: Vec3, playerPos: Vec3) {\r\n        return Math.abs(playerPos.x - pos.x) >= mapModel.visibleHalfSize.width;\r\n    }\r\n\r\n    outScreenY(pos: Vec3, playerPos: Vec3) {\r\n        return Math.abs(playerPos.y - pos.y) >= mapModel.visibleHalfSize.height;\r\n    }\r\n\r\n    outWallX(pos: Vec3) {\r\n        if (!mapModel.mapSystem.wallLayer.active) {\r\n            return false;\r\n        }\r\n        if (pos.x >= mapModel.mapSystem.wallRightVal || pos.x <= mapModel.mapSystem.wallLeftVal) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    outWallY(pos: Vec3) {\r\n        if (!mapModel.mapSystem.wallLayer.active) {\r\n            return false;\r\n        }\r\n        if (pos.y >= mapModel.mapSystem.wallTopVal || pos.y <= mapModel.mapSystem.wallBottomVal) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    update(dt: number) {\r\n        let playerPos = mapModel.player.node.getPosition();\r\n        let pos = this.node.getPosition();\r\n        if (this.outScreenX(pos, playerPos)) {\r\n            this.mirrorReflex(true);\r\n            return;\r\n        }\r\n        if (this.outWallX(pos)) {\r\n            this.mirrorReflex(true, true);\r\n            return;\r\n        }\r\n        if (this.outScreenY(pos, playerPos)) {\r\n            this.mirrorReflex(false);\r\n            return;\r\n        }\r\n        if (this.outWallY(pos)) {\r\n            this.mirrorReflex(false, true);\r\n            return;\r\n        }\r\n        this.isOutScreenReflex = false;\r\n    }\r\n\r\n    recycleSelfEnd() {\r\n        // 通知上级数量减少了\r\n        if (cocosUtil.isValid(this.bullet.extraObj.invokeClass)) {\r\n            this.bullet.extraObj.invokeClass.subNum();\r\n        }\r\n    }\r\n\r\n}\r\n\r\n"]}