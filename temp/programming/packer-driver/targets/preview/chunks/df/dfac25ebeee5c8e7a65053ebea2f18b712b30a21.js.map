{"version":3,"sources":["file:///G:/cocos/%E6%9C%AB%E6%97%A5%E7%89%B9%E5%B7%A5%E9%98%9F/assets/scripts/game/compoment/layer/HomeLayer.ts"],"names":["Button","EventHandler","find","instantiate","Prefab","Sprite","tween","v3","_decorator","myLog","ServerCtr","tyqAdManager","ChannelFlag","tyqSDK","constants","msgac","audioManager","designManager","eventManager","RedPointLogicMgr","RPointMask","resManager","mapModel","playerModel","UserData","BaseLayer","ShineColor","BaseUILayer","HeroLayer","MainLayer","TopUILayer","TowerLayer","ccclass","property","HomeLayer","toggles","togglesLock","_PageLayer","layers","EnergyLayer","jumpLayerData","tabMainRedPointNode","tabEnergyRedPointNode","onLoad","chooseDesignResolution","getNodeByPath","getSwitchValue","ins","on","node","mask","RPM_PropWear","RPM_BlessProp","subPath","channel","WECHAT_JJWS","GetInstance","reqGetFriendVal","schedule","i","getEnterUrlQuery","urlParmas","uid","reqSetFriendCode","eventSendCustomEvent","onEnable","addEventArr","homeHideMenu","mapEnter","jumpLayer","getInstance","mapHand","enterMapWithMapId","hasEnergyAward","setPage","mapData","openLayer","BackMapLayer","mapId","playMusic","audioNames","home","layerData","isWin","floor","addTowerMapFloor","obj","layerName","TowerFloorLayer","send","floorRow","getRowById","tableName","towerFloor","propItem","addPropNum","propId","propNum","openAwardGetLayer","getPatrolState","PatrolLayer","setRPointView","refreshRedPoint","hasLetterAward","hasDaySignAward","hasDayTaskAward","hasVipAward","active","onDisable","onDestroy","initUI","getChildByName","getComponent","grayscale","clickEvent","component","target","customEventData","handler","addComponent","clickEvents","start","selectPage","event","console","log","parseInt","playEffect","index","createNotice","commonResRefresh","setSpriteFrame2","bundles","wwqVec","to","scale","uiNode","loadAsset","layer","err","prefab","e","message","removeAllChildren","layerNode","addChild","onClickBtnPartol","openBless","openTowerFloorLayer","DaySignLayer","onClickBtnDaySign","jumpLayerRet","data","showRewardItem","RewardSkinLayer","mapEnterRet","TransLayer","loadMapRes","percent","MapLayer","closeLayer","homeHideMenuRet","hide","onClickBtnHit","bodyNode","shineColor","startShine","materials","shineColorSpine"],"mappings":"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","sourcesContent":["import { Button, EventHandler, find, instantiate, Node, Prefab, Sprite, tween, v3, _decorator } from 'cc';\r\nimport { myLog } from '../../../common/myLog';\r\nimport ServerCtr from '../../../tyqSDK/network/ServerCtr';\r\nimport { tyqAdManager } from '../../../tyqSDK/tyqAdManager';\r\nimport { ChannelFlag, tyqSDK } from '../../../tyqSDK/tyqSDK';\r\nimport { constants } from '../../data/constants';\r\nimport { msgac } from '../../data/msgac';\r\nimport { audioManager } from '../../manager/audioManager';\r\nimport { designManager } from '../../manager/designManager';\r\nimport { eventManager } from '../../manager/eventManager';\r\nimport { RedPointLogicMgr, RPointMask } from '../../manager/RedPointLogicMgr';\r\nimport { resManager } from '../../manager/resManager';\r\nimport { mapModel } from '../../model/mapModel';\r\nimport { playerModel } from '../../model/playerModel';\r\nimport { UserData } from '../../model/UserData';\r\nimport { BaseLayer } from '../base/BaseLayer';\r\nimport { ShineColor } from '../shader/ShineColor';\r\nimport { BaseUILayer } from './BaseUILayer';\r\nimport { HeroLayer } from './HeroLayer';\r\nimport { MainLayer } from './MainLayer';\r\nimport { TopUILayer } from './TopUILayer';\r\nimport { TowerLayer } from './TowerLayer';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HomeLayer')\r\nexport class HomeLayer extends BaseLayer {\r\n\r\n    toggles: Node[] = [];\r\n    togglesLock = [false, false, false, false, false];\r\n\r\n    _PageLayer = [constants.layers.TowerLayer, \"HeroLayer\", \"MainLayer\", \"ShopLayer\", constants.layers.EnergyLayer]\r\n\r\n    jumpLayerData: any;\r\n\r\n    tabMainRedPointNode: Node;\r\n    tabEnergyRedPointNode: Node;\r\n\r\n    onLoad() {\r\n        this.chooseDesignResolution()\r\n        this.tabMainRedPointNode = this.getNodeByPath(\"Layout/ui_btn3/redPoint\");\r\n        this.tabEnergyRedPointNode = this.getNodeByPath(\"Layout/ui_btn5/redPoint\");\r\n        if (tyqSDK.getSwitchValue(\"tyq_HeroLayer_open\") == 1) {\r\n            this.togglesLock[1] = false\r\n            RedPointLogicMgr.ins().on(this.node, [{ mask: [RPointMask.RPM_PropWear, RPointMask.RPM_BlessProp], subPath: \"Layout/ui_btn2\" },])\r\n        } else {\r\n            this.togglesLock[1] = true\r\n        }\r\n\r\n        if (tyqSDK.channel != ChannelFlag.WECHAT_JJWS) {\r\n            this.togglesLock[1] = false\r\n        }\r\n\r\n        ServerCtr.GetInstance().reqGetFriendVal();\r\n        this.schedule(() => {\r\n            ServerCtr.GetInstance().reqGetFriendVal();\r\n        }, 60 * 5);\r\n\r\n        myLog.i(\"进游戏的url参数：\", tyqAdManager.getEnterUrlQuery());\r\n        let urlParmas = tyqAdManager.getEnterUrlQuery();\r\n        if (urlParmas && urlParmas.uid) {\r\n            ServerCtr.GetInstance().reqSetFriendCode(urlParmas.uid);\r\n            tyqSDK.eventSendCustomEvent(\"参与分享活动成功进来的玩家\")\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n        this.addEventArr([\r\n            msgac.homeHideMenu,\r\n            msgac.mapEnter,\r\n            msgac.jumpLayer,\r\n        ]);\r\n        //  eventManager.on(msgac.homeHideMenu, this.homeHideMenuRet, this)\r\n        if (!UserData.getInstance().mapHand) {\r\n            // 直接进去爬塔第一关\r\n            mapModel.enterMapWithMapId(101, 1);\r\n            return;\r\n        }\r\n\r\n        if (playerModel.hasEnergyAward()) {\r\n            this.setPage(4);\r\n        } else {\r\n            this.setPage(0)\r\n        }\r\n\r\n        if (UserData.getInstance().mapData) {\r\n            this.openLayer(constants.layers.BackMapLayer, null, (mapId: number) => {\r\n                if (mapId) {\r\n                    mapModel.enterMapWithMapId(mapId);\r\n                }\r\n            });\r\n        }\r\n        // RedPointLogicMgr.ins().setRPointView(this.getNodeByPath(\"Layout/ui_btn2\") ,null, true)\r\n        audioManager.playMusic(constants.audioNames.home);\r\n\r\n        if (this.layerData.isWin && this.layerData.floor > 0) {\r\n            // 爬塔胜利\r\n            UserData.getInstance().addTowerMapFloor(this.layerData.mapId);\r\n\r\n            // 跳回去爬塔界面\r\n            let obj: any = {};\r\n            obj.layerName = constants.layers.TowerFloorLayer;\r\n            obj.mapId = this.layerData.mapId;\r\n            eventManager.send(msgac.jumpLayer, obj);\r\n\r\n            let floorRow = designManager.getRowById(constants.tableName.towerFloor, this.layerData.floor);\r\n            let propItem = UserData.getInstance().addPropNum(floorRow.propId, floorRow.propNum);\r\n            this.openAwardGetLayer([propItem]);\r\n\r\n        }\r\n\r\n        // 强制弹出巡逻收益\r\n        if (UserData.getInstance().getPatrolState() <= 0) {\r\n            this.openLayer(constants.layers.PatrolLayer);\r\n            RedPointLogicMgr.ins().setRPointView(this.getNodeByPath(\"Map/btnPortal\"), null, false)\r\n        }\r\n\r\n    }\r\n\r\n    refreshRedPoint() {\r\n        if (playerModel.hasLetterAward() || playerModel.hasDaySignAward() || playerModel.hasDayTaskAward() || playerModel.hasVipAward()) {\r\n            this.tabMainRedPointNode.active = true;\r\n        } else {\r\n            this.tabMainRedPointNode.active = false;\r\n        }\r\n\r\n        this.tabEnergyRedPointNode.active = playerModel.hasEnergyAward();\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n\r\n    initUI() {\r\n        for (let i = 0; i < 5; i++) {\r\n            this.toggles[i] = this.getNodeByPath(\"Layout/ui_btn\" + (i + 1))\r\n            this.toggles[i].getChildByName(\"icon\").getComponent(Sprite).grayscale = this.togglesLock[i]\r\n            //  console.log(\" this.toggles[i] = \", this.toggles[i])\r\n            let clickEvent = new EventHandler()\r\n            clickEvent.component = \"HomeLayer\"\r\n            clickEvent.target = this.node\r\n            clickEvent.customEventData = i + \"\"\r\n            clickEvent.handler = \"selectPage\"\r\n            if (!this.toggles[i].getComponent(Button)) {\r\n                this.toggles[i].addComponent(Button).clickEvents = [clickEvent]\r\n            }\r\n            // this.toggles[i].addComponent(Button).clickEvents.push(clickEvent)\r\n        }\r\n\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    selectPage(node, event) {\r\n        console.log(\"event =\", event)\r\n        this.setPage(parseInt(event))\r\n        audioManager.playEffect(\"btnClick\")\r\n    }\r\n\r\n    setPage(index) {\r\n\r\n        if (this.togglesLock[index]) {\r\n            this.createNotice(\"还未解锁\")\r\n            return\r\n        }\r\n\r\n        this.getNodeByPath(\"TopUILayer\").active = index != 3\r\n        if (index == 2) {\r\n            eventManager.send(msgac.commonResRefresh)\r\n        }\r\n        // if (index == 3) {\r\n        //     this.openLayer(constants.layers.ShopLayer)\r\n        //     return\r\n        // }\r\n        for (let i = 0; i < 5; i++) {\r\n            if (i != index) {\r\n                this.setSpriteFrame2(this.toggles[i], \"homeLayer/ui_xk\", null, constants.bundles.wwqVec)\r\n                //  this.toggles[i].getChildByName(\"icon\").scale = new Vec3(0.6, 0.6, 1)\r\n                tween(this.toggles[i].getChildByName(\"icon\")).to(0.15, { scale: v3(0.6, 0.6, 1) }).start()\r\n                this.toggles[i].getChildByName(\"name\").active = false\r\n            } else {\r\n                this.setSpriteFrame2(this.toggles[i], \"homeLayer/ui_hdmb\", null, constants.bundles.wwqVec)\r\n                //this.toggles[i].getChildByName(\"icon\").scale = new Vec3(1, 1, 1)\r\n                tween(this.toggles[i].getChildByName(\"icon\")).to(0.15, { scale: v3(1, 1, 1) }).start()\r\n                this.toggles[i].getChildByName(\"name\").active = true\r\n            }\r\n        }\r\n        let uiNode = this.getNodeByPath(\"ui\")\r\n\r\n        if (this._PageLayer[index] != \"\") {\r\n            resManager.loadAsset(constants.bundles.layer, this._PageLayer[index], Prefab, null, (err, prefab) => {\r\n                if (err) {\r\n                    myLog.e(\"LayerManager.openLayer error:\" + err.message, \"MainLayer\", err);\r\n                    return;\r\n                }\r\n                uiNode.removeAllChildren()\r\n                let layerNode = instantiate(prefab);\r\n                uiNode.addChild(layerNode)\r\n                if (this.jumpLayerData) {\r\n                    if (layerNode && layerNode.getComponent(BaseUILayer)) {\r\n                        layerNode.getComponent(BaseUILayer).layerData = this.jumpLayerData\r\n                    }\r\n                    switch (this.jumpLayerData.layerName) {\r\n                        case \"PatrolLayer\":\r\n                            layerNode.getComponent(MainLayer).onClickBtnPartol();\r\n                            break;\r\n                        case \"BlessLayer\":\r\n                            layerNode.getComponent(HeroLayer).openBless();\r\n                            break;\r\n                        case constants.layers.TowerFloorLayer:\r\n                            layerNode.getComponent(TowerLayer).openTowerFloorLayer(this.jumpLayerData.mapId);\r\n                            break;\r\n                        case constants.layers.DaySignLayer:\r\n                            layerNode.getComponent(MainLayer).onClickBtnDaySign();\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                    delete this.jumpLayerData;\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    jumpLayerRet(data: any) {\r\n        this.jumpLayerData = data;\r\n        switch (data.layerName) {\r\n            case \"ShopLayer\":\r\n                this.setPage(3);\r\n                break;\r\n            case \"MainLayer\":\r\n            case \"PatrolLayer\":\r\n            case constants.layers.DaySignLayer:\r\n                this.setPage(2);\r\n                break;\r\n            case \"BlessLayer\":\r\n                this.setPage(1);\r\n                break;\r\n            case \"RewardItemLayer\":\r\n                this.setPage(2);\r\n                find(\"TopUILayer\", this.node).getComponent(TopUILayer).showRewardItem(null, 2);\r\n                break;\r\n            case constants.layers.RewardSkinLayer:\r\n                this.setPage(2);\r\n                this.openLayer(constants.layers.RewardSkinLayer);\r\n                break;\r\n            case constants.layers.DaySignLayer:\r\n                this.setPage(2);\r\n                this.openLayer(constants.layers.DaySignLayer);\r\n                break;\r\n            case constants.layers.TowerFloorLayer:\r\n                this.setPage(0);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    mapEnterRet(data: any) {\r\n\r\n        // 显示加载进度\r\n        this.openLayer(constants.layers.TransLayer);\r\n        mapModel.loadMapRes((percent: number) => {\r\n            // TODO 刷新加载进度\r\n        }, () => {\r\n            this.openLayer(constants.layers.MapLayer, data, null, () => {\r\n                // 关闭加载进度\r\n                this.closeLayer(constants.layers.TransLayer);\r\n                this.closeLayer(constants.layers.TowerFloorLayer);\r\n                this.closeLayer();\r\n            });\r\n        });\r\n    }\r\n\r\n    homeHideMenuRet(data: any) {\r\n        if (data.hide) {\r\n            this.getNodeByPath(\"Layout\").active = false\r\n        } else {\r\n            this.getNodeByPath(\"Layout\").active = true\r\n        }\r\n    }\r\n\r\n    onClickBtnHit() {\r\n        let bodyNode = this.getNodeByPath(\"monster\");\r\n        // 闪白\r\n        let shineColor = bodyNode.getComponent(ShineColor);\r\n        if (!shineColor) {\r\n            shineColor = bodyNode.addComponent(ShineColor);\r\n        }\r\n        shineColor.startShine(constants.materials.shineColorSpine);\r\n    }\r\n\r\n}\r\n\r\n"]}